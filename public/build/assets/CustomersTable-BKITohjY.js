import{r as c,H as M,g as u,i as p,j as e,w as z,x as B,t as o,F,m as N}from"./vendor-vue-Db-AqoDh.js";import{a as y}from"./vendor-utils-Czy7fllw.js";import{a as I,t as S,p as V,c as q}from"./App-Btt0t-0g.js";import"./app-CEWwc3KD.js";import"./vendor-ui-DEm6YKEA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"p-4"},L={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},O={class:"w-full sm:max-w-md"},P={class:"flex items-center gap-3"},H=["disabled"],U={class:"text-sm text-slate-600 dark:text-slate-300"},G={key:0},J={key:1},K={class:"mt-4 overflow-x-auto rounded-lg border border-slate-200 bg-white dark:border-slate-800 dark:bg-slate-900"},Q={class:"min-w-full text-left text-sm text-slate-700 dark:text-slate-200"},R={class:"px-4 py-3 font-medium text-slate-900 dark:text-slate-100"},W={class:"px-4 py-3"},X={class:"px-4 py-3"},Y={class:"px-4 py-3"},Z={key:0},ee={key:1},te={class:"px-4 py-3"},ae={class:"px-4 py-3"},se={class:"px-4 py-3"},le={class:"flex items-center gap-2"},oe=["disabled","onClick"],re=["disabled","onClick"],de={class:"mt-4 flex items-center justify-between"},ne=["disabled"],ie={class:"text-sm text-slate-600 dark:text-slate-300"},ce=["disabled"],ve={__name:"CustomersTable",setup(ue){const x=c([]),_=c(!1),k=c(new Set),w=c(new Set),v=c(null),h=c(!1),f=c("");let C=null;const l=c({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),b=async(t=1)=>{_.value=!0;try{const{data:s}=await y.get("/customers/data",{params:{q:f.value||"",per_page:l.value.per_page,page:t}});x.value=s.customers||[],l.value={...l.value,...s.pagination||{}}}finally{_.value=!1}},E=()=>{var t,s;(s=(t=v.value)==null?void 0:t.click)==null||s.call(t)},j=async t=>{var a,n,d,r,i;const s=(n=(a=t==null?void 0:t.target)==null?void 0:a.files)==null?void 0:n[0];if(s){h.value=!0;try{const m=new FormData;m.append("csv",s);const{data:g}=await y.post("/customers/import",m,{headers:{"Content-Type":"multipart/form-data"}});I(((d=g==null?void 0:g.output)!=null&&d.trim(),"Importación finalizada")),await b(1)}catch(m){const g=((i=(r=m==null?void 0:m.response)==null?void 0:r.data)==null?void 0:i.message)??"No se pudo importar el CSV.";S(g)}finally{h.value=!1,v.value&&(v.value.value="")}}},$=async t=>{var a,n,d;if(!(t!=null&&t.id))return;const s=await V(t);if(s){k.value.add(t.id);try{const r=await y.put(`/customers/${t.id}`,s),i=(a=r==null?void 0:r.data)==null?void 0:a.data;i&&typeof i=="object"?Object.assign(t,i):Object.assign(t,s),I("Cliente actualizado")}catch(r){const i=((d=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:d.message)??"No se pudo actualizar el cliente.";S(i)}finally{k.value.delete(t.id)}}},D=async t=>{var a,n;if(!(!(t!=null&&t.id)||!await q({title:"Eliminar cliente",text:"Se eliminará el cliente. Los leads asociados quedarán sin cliente (se desvinculan).",confirmText:"Eliminar",cancelText:"Cancelar",icon:"warning"}))){w.value.add(t.id);try{await y.delete(`/customers/${t.id}`),x.value=x.value.filter(d=>d.id!==t.id),I("Cliente eliminado"),b(Math.min(l.value.current_page,l.value.last_page||1))}catch(d){const r=((n=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:n.message)??"No se pudo eliminar el cliente.";S(r)}finally{w.value.delete(t.id)}}},T=t=>{const s=Math.max(1,Math.min(l.value.last_page||1,t));b(s)};return M(f,()=>{C&&clearTimeout(C),C=setTimeout(()=>{b(1)},300)},{flush:"post"}),b(1),(t,s)=>(p(),u("div",A,[e("div",L,[e("div",O,[z(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>f.value=a),type:"text",class:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:border-sky-500 focus:ring-sky-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100",placeholder:"Buscar cliente (nombre, contacto, empresa, documento…)"},null,512),[[B,f.value]])]),e("div",P,[e("input",{ref_key:"importInput",ref:v,type:"file",accept:".csv,text/csv",class:"hidden",onChange:j},null,544),e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-60 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:h.value,onClick:E},o(h.value?"Importando…":"Importar CSV"),9,H),e("div",U,[l.value.total?(p(),u("span",G,"Mostrando "+o(l.value.from)+"–"+o(l.value.to)+" de "+o(l.value.total),1)):(p(),u("span",J,"Sin resultados"))])])]),e("div",K,[e("table",Q,[s[3]||(s[3]=e("thead",{class:"bg-slate-50 text-xs uppercase text-slate-600 dark:bg-slate-800 dark:text-slate-200"},[e("tr",null,[e("th",{class:"px-4 py-3"},"Cliente"),e("th",{class:"px-4 py-3"},"Contacto"),e("th",{class:"px-4 py-3"},"Empresa"),e("th",{class:"px-4 py-3"},"Documento"),e("th",{class:"px-4 py-3"},"Teléfono"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Acciones")])],-1)),e("tbody",null,[(p(!0),u(F,null,N(x.value,a=>(p(),u("tr",{key:a.id,class:"border-t border-slate-200 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800"},[e("td",R,o(a.name),1),e("td",W,o(a.contact_name||"—"),1),e("td",X,o(a.company_name||"—"),1),e("td",Y,[a.document_type||a.document_number?(p(),u("span",Z,o(a.document_type||"")+" "+o(a.document_number||""),1)):(p(),u("span",ee,"—"))]),e("td",te,o(a.contact_phone||"—"),1),e("td",ae,o(a.contact_email||"—"),1),e("td",se,[e("div",le,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-60 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:k.value.has(a.id),onClick:n=>$(a)}," Editar ",8,oe),e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-red-200 bg-white px-3 py-1.5 text-xs font-medium text-red-700 hover:bg-red-50 disabled:opacity-60 dark:border-red-900/40 dark:bg-slate-900 dark:text-red-300 dark:hover:bg-red-950/30",disabled:w.value.has(a.id),onClick:n=>D(a)}," Eliminar ",8,re)])])]))),128))])])]),e("div",de,[e("button",{class:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:l.value.current_page<=1||_.value,onClick:s[1]||(s[1]=a=>T(l.value.current_page-1))}," Anterior ",8,ne),e("div",ie," Página "+o(l.value.current_page)+" / "+o(l.value.last_page),1),e("button",{class:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:l.value.current_page>=l.value.last_page||_.value,onClick:s[2]||(s[2]=a=>T(l.value.current_page+1))}," Siguiente ",8,ce)])]))}};export{ve as default};
