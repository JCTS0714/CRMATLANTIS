import{a as R}from"./vendor-utils-Czy7fllw.js";import{S as O}from"./vendor-ui-DEm6YKEA.js";import{g as u,i as c,j as e,t as r,n as M,z as U,F as G,m as H,r as $,G as z,e as w,H as W,o as J,B as A,k as I,u as p,q as K}from"./vendor-vue-Db-AqoDh.js";const Q={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},X={class:"flex-1"},Y=["value"],Z={class:"flex items-center gap-2"},ee=["disabled"],te=["value"],ae={class:"mb-4 overflow-x-auto"},se={class:"inline-flex rounded-lg border border-gray-200 bg-white p-1 shadow-sm dark:border-slate-800 dark:bg-slate-900"},re={class:"ml-2 rounded bg-black/5 px-2 py-0.5 text-xs font-semibold text-gray-700 dark:bg-white/10 dark:text-slate-200"},oe=["onClick"],ne={class:"ml-2 rounded bg-black/5 px-2 py-0.5 text-xs font-semibold text-gray-700 dark:bg-white/10 dark:text-slate-200"},le={__name:"LeadsTableFilters",props:{modelValue:{type:String,required:!0},stages:{type:Array,required:!0},activeStageId:{type:[Number,null],default:null},totalCount:{type:Number,default:0},perPage:{type:Number,default:25},importing:{type:Boolean,default:!1}},emits:["update:modelValue","update:per-page","stage-filter","import-file"],setup(t){return(n,a)=>(c(),u("section",null,[e("div",Q,[e("div",X,[a[5]||(a[5]=e("label",{class:"sr-only",for:"leads-search"},"Buscar",-1)),e("input",{id:"leads-search",value:t.modelValue,type:"search",placeholder:"Buscar por nombre, empresa, contacto, email, teléfono, documento…",class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500",onInput:a[0]||(a[0]=s=>n.$emit("update:modelValue",s.target.value))},null,40,Y)]),e("div",Z,[e("input",{ref:"importInput",type:"file",accept:".csv,text/csv",class:"hidden",onChange:a[1]||(a[1]=s=>n.$emit("import-file",s))},null,544),e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:t.importing,onClick:a[2]||(a[2]=s=>n.$refs.importInput.click())},r(t.importing?"Importando…":"Importar CSV"),9,ee),e("select",{value:t.perPage,class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100",onChange:a[3]||(a[3]=s=>n.$emit("update:per-page",Number(s.target.value)))},[...a[6]||(a[6]=[e("option",{value:10},"10",-1),e("option",{value:15},"15",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1)])],40,te)])]),e("div",ae,[e("div",se,[e("button",{type:"button",class:M(["px-3 py-2 text-sm font-medium rounded-md transition",t.activeStageId===null?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-50 dark:text-slate-200 dark:hover:bg-slate-800"]),onClick:a[4]||(a[4]=s=>n.$emit("stage-filter",null))},[a[7]||(a[7]=U(" Todos ",-1)),e("span",re,r(t.totalCount),1)],2),(c(!0),u(G,null,H(t.stages,s=>(c(),u("button",{key:s.id,type:"button",class:M(["px-3 py-2 text-sm font-medium rounded-md transition",t.activeStageId===s.id?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-50 dark:text-slate-200 dark:hover:bg-slate-800"]),onClick:h=>n.$emit("stage-filter",s.id)},[U(r(s.name)+" ",1),e("span",ne,r(s.count??0),1)],10,oe))),128))])])]))}},de={class:"border-b border-gray-100 bg-white hover:bg-blue-50/40 transition-colors dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800/60"},ie={class:"px-4 py-3 font-medium text-gray-900 dark:text-slate-100"},ce={class:"px-4 py-3"},ue={class:"px-4 py-3 text-right"},ge={class:"px-4 py-3"},pe={class:"px-4 py-3"},me={class:"px-4 py-3"},be={class:"px-4 py-3"},ye={class:"px-4 py-3"},xe={class:"px-4 py-3"},he={class:"px-4 py-3"},fe={class:"px-4 py-3"},ve={class:"px-4 py-3"},ke={class:"px-4 py-3"},$e={class:"px-4 py-3"},we={class:"px-4 py-3"},_e={class:"px-4 py-3"},Pe={__name:"LeadsTableRow",props:{lead:{type:Object,required:!0}},setup(t){const n=(s,h="EUR")=>s?new Intl.NumberFormat("es-ES",{style:"currency",currency:h||"EUR"}).format(s):"",a=s=>s?new Date(s).toLocaleString("es-ES"):"";return(s,h)=>(c(),u("tr",de,[e("td",ie,r(t.lead.id),1),e("td",ce,r(t.lead.name??""),1),e("td",ue,r(n(t.lead.amount,t.lead.currency)),1),e("td",ge,r(t.lead.currency??""),1),e("td",pe,r(t.lead.contact_name??""),1),e("td",me,r(t.lead.contact_phone??""),1),e("td",be,r(t.lead.contact_email??""),1),e("td",ye,r(t.lead.company_name??""),1),e("td",xe,r(t.lead.company_address??""),1),e("td",he,r(t.lead.document_type??""),1),e("td",fe,r(t.lead.document_number??""),1),e("td",ve,r(t.lead.customer_id??""),1),e("td",ke,r(t.lead.created_by??""),1),e("td",$e,r(a(t.lead.won_at)),1),e("td",we,r(a(t.lead.created_at)),1),e("td",_e,r(a(t.lead.updated_at)),1)]))}},Ce={class:"p-4 flex items-center justify-between gap-3"},De=["disabled"],Se={class:"text-xs text-gray-600 dark:text-slate-300"},Ie=["disabled"],Te={__name:"LeadsTablePagination",props:{pagination:{type:Object,required:!0,default:()=>({current_page:1,last_page:1})},loading:{type:Boolean,default:!1}},emits:["page-change"],setup(t){return(n,a)=>(c(),u("div",Ce,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:t.loading||t.pagination.current_page<=1,onClick:a[0]||(a[0]=s=>n.$emit("page-change",t.pagination.current_page-1))}," Anterior ",8,De),e("div",Se," Página "+r(t.pagination.current_page)+" / "+r(t.pagination.last_page),1),e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:t.loading||t.pagination.current_page>=t.pagination.last_page,onClick:a[1]||(a[1]=s=>n.$emit("page-change",t.pagination.current_page+1))}," Siguiente ",8,Ie)]))}};function Ee(t={}){const{endpoint:n,defaultPerPage:a=25,defaultFilters:s={},searchDebounce:h=300}=t,b=$(!1),P=$(null),f=$([]),C=$([]),m=z({current_page:1,last_page:1,per_page:a,total:0,from:null,to:null}),_=z({q:"",page:1,per_page:a,...s}),T=w(()=>f.value.length>0),E=w(()=>!b.value&&f.value.length===0),F=w(()=>m.total||0),D=w(()=>{if(!m.total)return"";const o=m.from||0,k=m.to||0,g=m.total||0;return`${o}-${k} de ${g}`}),y=async(o={})=>{var k,g,B;if(!n){console.error("useTableData: endpoint is required");return}b.value=!0,P.value=null;try{const x={..._,...o},L=await R.get(n,{params:x}),l=((k=L.data)==null?void 0:k.data)||L.data;f.value=(l==null?void 0:l.items)||(l==null?void 0:l.leads)||[],l!=null&&l.stages&&(C.value=l.stages),l!=null&&l.pagination&&Object.assign(m,l.pagination)}catch(x){P.value=((B=(g=x.response)==null?void 0:g.data)==null?void 0:B.message)||"Error al cargar los datos",console.error("useTableData fetch error:",x)}finally{b.value=!1}},v=async(o={})=>{Object.assign(_,o),await y()},V=async o=>{await v({page:o})},q=async o=>{await v({per_page:o,page:1})},S=async o=>{await v({q:o,page:1})},N=async()=>{await y()},j=async()=>{Object.assign(_,{q:"",page:1,per_page:a,...s}),await y()};let d;return{loading:b,error:P,items:f,stagesData:C,pagination:m,filters:_,hasData:T,isEmpty:E,totalCount:F,paginationInfo:D,fetchData:y,applyFilters:v,changePage:V,changePerPage:q,search:S,debouncedSearch:o=>{clearTimeout(d),d=setTimeout(()=>{S(o)},h)},refresh:N,reset:j}}const Fe={key:0,class:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700 dark:border-red-900/40 dark:bg-red-950/30 dark:text-red-200"},Ve={class:"bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-slate-900 dark:border-slate-800"},qe={class:"p-4 border-b border-gray-200 dark:border-slate-800 flex items-center justify-between"},Ne={class:"mt-1 text-xs text-gray-600 dark:text-slate-300"},je={key:0},Be={key:0,class:"text-xs text-gray-600 dark:text-slate-300"},Le={class:"overflow-x-auto"},Oe={class:"min-w-[1400px] w-full text-sm text-left text-gray-700 dark:text-slate-200"},Me={key:0},Re={__name:"LeadsTable",setup(t){const{loading:n,error:a,items:s,stagesData:h,pagination:b,isEmpty:P,paginationInfo:f,fetchData:C,applyFilters:m,changePage:_,changePerPage:T,debouncedSearch:E}=Ee({endpoint:"/leads/data",defaultPerPage:25}),F=w(()=>h.value||[]),D=$(!1),y=$(""),v=$(null),V=w(()=>b.per_page),q=w(()=>b.total||0);W(y,d=>{E(d)});const S=d=>{T(d)},N=d=>{v.value=d,m({stage_id:d,page:1})},j=async d=>{var o,k;const i=d.target.files[0];if(i){D.value=!0;try{const g=new FormData;g.append("file",i);const x=(await R.post("/leads/import",g,{headers:{"Content-Type":"multipart/form-data"}})).data;O.fire({title:"¡Importación completada!",html:`
        <div class="text-left">
          <p><strong>Procesados:</strong> ${x.processed||0}</p>
          <p><strong>Importados:</strong> ${x.imported||0}</p>
          <p><strong>Errores:</strong> ${x.errors||0}</p>
        </div>
      `,icon:"success"}),await C()}catch(g){console.error(g),O.fire({title:"Error en la importación",text:((k=(o=g.response)==null?void 0:o.data)==null?void 0:k.message)||"Error desconocido",icon:"error"})}finally{D.value=!1,d.target.value=""}}};return J(async()=>{await C()}),(d,i)=>(c(),u("section",null,[A(le,{modelValue:y.value,"onUpdate:modelValue":i[0]||(i[0]=o=>y.value=o),stages:F.value,"active-stage-id":v.value,"total-count":q.value,"per-page":V.value,importing:D.value,"onUpdate:perPage":S,onStageFilter:N,onImportFile:j},null,8,["modelValue","stages","active-stage-id","total-count","per-page","importing"]),p(a)?(c(),u("div",Fe,r(p(a)),1)):I("",!0),e("div",Ve,[e("div",qe,[e("div",null,[i[1]||(i[1]=e("div",{class:"text-sm font-semibold text-gray-900 dark:text-slate-100"},"Leads",-1)),e("div",Ne,[p(f)?(c(),u("span",je,r(p(f)),1)):I("",!0)])]),p(n)?(c(),u("div",Be,"Cargando…")):I("",!0)]),e("div",Le,[e("table",Oe,[i[3]||(i[3]=e("thead",{class:"text-xs uppercase bg-gray-50 text-gray-700 dark:bg-slate-800 dark:text-slate-200"},[e("tr",null,[e("th",{class:"px-4 py-3"},"ID"),e("th",{class:"px-4 py-3"},"Nombre"),e("th",{class:"px-4 py-3 text-right"},"Monto"),e("th",{class:"px-4 py-3"},"Moneda"),e("th",{class:"px-4 py-3"},"Contacto"),e("th",{class:"px-4 py-3"},"Teléfono"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Empresa"),e("th",{class:"px-4 py-3"},"Dirección"),e("th",{class:"px-4 py-3"},"Doc. tipo"),e("th",{class:"px-4 py-3"},"Doc. nro"),e("th",{class:"px-4 py-3"},"Customer ID"),e("th",{class:"px-4 py-3"},"Creado por"),e("th",{class:"px-4 py-3"},"Won at"),e("th",{class:"px-4 py-3"},"Creado"),e("th",{class:"px-4 py-3"},"Actualizado")])],-1)),e("tbody",null,[(c(!0),u(G,null,H(p(s),o=>(c(),K(Pe,{key:o.id,lead:o},null,8,["lead"]))),128)),p(P)?(c(),u("tr",Me,[...i[2]||(i[2]=[e("td",{colspan:"16",class:"px-4 py-10 text-center text-sm text-gray-600 dark:text-slate-300"}," Sin leads. ",-1)])])):I("",!0)])])]),A(Te,{pagination:p(b),loading:p(n),onPageChange:p(_)},null,8,["pagination","loading","onPageChange"])])]))}};export{Re as default};
