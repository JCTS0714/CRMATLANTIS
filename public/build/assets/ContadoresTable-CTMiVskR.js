import{r as c,o as z,f as B,I as j,g as m,i as g,j as t,k as D,w as F,s as L,t as i,n as U,y as A,F as P,l as q}from"./vendor-vue-CzwclP9t.js";import{a as x}from"./vendor-utils-Czy7fllw.js";import{d as O,a as y,t as k,e as R,c as G}from"./App-D36-j_Pq.js";import"./app-DmesRmX-.js";import"./vendor-ui-E6c-3yld.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"p-4"},J={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},K={class:"w-full sm:max-w-md"},Q={class:"flex items-center gap-2"},W={class:"text-sm text-slate-600 dark:text-slate-300"},X={key:0},Y={key:1},Z={key:0,class:"mt-2 text-sm text-slate-600 dark:text-slate-300"},tt={class:"mt-4 overflow-x-auto rounded-lg border border-slate-200 bg-white dark:border-slate-800 dark:bg-slate-900"},et={class:"min-w-full text-left text-sm text-slate-700 dark:text-slate-200"},at={class:"px-4 py-3 font-medium text-slate-900 dark:text-slate-100"},st={class:"px-4 py-3"},ot={class:"px-4 py-3"},rt={class:"px-4 py-3"},lt={class:"px-4 py-3"},dt={class:"px-4 py-3"},nt={class:"px-4 py-3"},it={class:"flex items-center gap-2"},ct=["disabled","onClick"],ut=["disabled","onClick"],pt={class:"mt-4 flex items-center justify-between"},mt=["disabled"],gt={class:"text-sm text-slate-600 dark:text-slate-300"},bt=["disabled"],wt={__name:"ContadoresTable",setup(xt){const v=c([]),h=c(!1),w=c(new Set),C=c(new Set),_=c("");let S=null;const E=c(!1),b=c(""),o=c({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),p=async(e=1)=>{h.value=!0;try{const{data:s}=await x.get("/postventa/contadores/data",{params:{q:_.value||"",per_page:o.value.per_page,page:e}});v.value=s.contadores||[],o.value={...o.value,...s.pagination||{}}}finally{h.value=!1}},T=e=>{const s=Math.max(1,Math.min(o.value.last_page||1,e));p(s)},N=async e=>{var a,r,l,u;const s=(r=(a=e==null?void 0:e.target)==null?void 0:a.files)==null?void 0:r[0];if(e!=null&&e.target&&(e.target.value=""),!!s){E.value=!0,b.value="Importando...";try{const d=new FormData;d.append("csv",s);const{data:n}=await x.post("/postventa/contadores/import",d,{headers:{"Content-Type":"multipart/form-data"}}),f=((n==null?void 0:n.output)??"").trim();b.value=f!==""?f:"Importación finalizada.",y("Importación finalizada"),p(1)}catch(d){const n=((u=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:u.message)??"No se pudo importar el CSV.";b.value=n,k(n)}finally{E.value=!1}}},M=async()=>{var s,a;const e=await O();if(e)try{await x.post("/postventa/contadores",e),y("Contador creado"),p(1)}catch(r){const l=((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)??"No se pudo crear el contador.";k(l)}},V=async e=>{var a,r,l,u;if(!(e!=null&&e.id))return;const s=await R(e);if(s){w.value.add(e.id);try{const d=await x.put(`/postventa/contadores/${e.id}`,s),n=(a=d==null?void 0:d.data)==null?void 0:a.data,f=(r=n==null?void 0:n.customers)!=null&&r[0]?{id:n.customers[0].id,name:n.customers[0].name}:null;Object.assign(e,{...s,customer:f}),y("Contador actualizado")}catch(d){const n=((u=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:u.message)??"No se pudo actualizar el contador.";k(n)}finally{w.value.delete(e.id)}}},$=async e=>{var a,r;if(!(!(e!=null&&e.id)||!await G({title:"Eliminar contador",text:"Se eliminará el contador y su asignación a cliente (si existe).",confirmText:"Eliminar",cancelText:"Cancelar",icon:"warning"}))){C.value.add(e.id);try{await x.delete(`/postventa/contadores/${e.id}`),v.value=v.value.filter(l=>l.id!==e.id),y("Contador eliminado"),p(Math.min(o.value.current_page,o.value.last_page||1))}catch(l){const u=((r=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:r.message)??"No se pudo eliminar el contador.";k(u)}finally{C.value.delete(e.id)}}},I=()=>M();return z(()=>{window.addEventListener("contadores:create",I)}),B(()=>{window.removeEventListener("contadores:create",I)}),j(_,()=>{S&&clearTimeout(S),S=setTimeout(()=>{p(1)},300)},{flush:"post"}),p(1),(e,s)=>(g(),m("div",H,[t("div",J,[t("div",K,[F(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>_.value=a),type:"text",class:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:border-sky-500 focus:ring-sky-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100",placeholder:"Buscar contador (nro, comercio, nombre, usuario, servidor…)"},null,512),[[L,_.value]])]),t("div",Q,[t("div",W,[o.value.total?(g(),m("span",X,"Mostrando "+i(o.value.from)+"–"+i(o.value.to)+" de "+i(o.value.total),1)):(g(),m("span",Y,"Sin resultados"))]),t("label",{class:U(["inline-flex cursor-pointer items-center rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",E.value?"pointer-events-none opacity-50":""])},[t("input",{type:"file",class:"hidden",accept:".csv,.txt,text/csv",onChange:N},null,32),s[3]||(s[3]=A(" Importar CSV ",-1))],2)])]),b.value?(g(),m("div",Z,i(b.value),1)):D("",!0),t("div",tt,[t("table",et,[s[4]||(s[4]=t("thead",{class:"bg-slate-50 text-xs uppercase text-slate-600 dark:bg-slate-800 dark:text-slate-200"},[t("tr",null,[t("th",{class:"px-4 py-3"},"Nro"),t("th",{class:"px-4 py-3"},"Comercio"),t("th",{class:"px-4 py-3"},"Nombre"),t("th",{class:"px-4 py-3"},"Cliente"),t("th",{class:"px-4 py-3"},"Usuario"),t("th",{class:"px-4 py-3"},"Servidor"),t("th",{class:"px-4 py-3"},"Acciones")])],-1)),t("tbody",null,[(g(!0),m(P,null,q(v.value,a=>{var r;return g(),m("tr",{key:a.id,class:"border-t border-slate-200 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800"},[t("td",at,i(a.nro||"—"),1),t("td",st,i(a.comercio||"—"),1),t("td",ot,i(a.nom_contador||"—"),1),t("td",rt,i(((r=a.customer)==null?void 0:r.name)||"—"),1),t("td",lt,i(a.usuario||"—"),1),t("td",dt,i(a.servidor||"—"),1),t("td",nt,[t("div",it,[t("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-60 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:w.value.has(a.id),onClick:l=>V(a)}," Editar ",8,ct),t("button",{type:"button",class:"inline-flex items-center rounded-lg border border-red-200 bg-white px-3 py-1.5 text-xs font-medium text-red-700 hover:bg-red-50 disabled:opacity-60 dark:border-red-900/40 dark:bg-slate-900 dark:text-red-300 dark:hover:bg-red-950/30",disabled:C.value.has(a.id),onClick:l=>$(a)}," Eliminar ",8,ut)])])])}),128))])])]),t("div",pt,[t("button",{class:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:o.value.current_page<=1||h.value,onClick:s[1]||(s[1]=a=>T(o.value.current_page-1))}," Anterior ",8,mt),t("div",gt," Página "+i(o.value.current_page)+" / "+i(o.value.last_page),1),t("button",{class:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:o.value.current_page>=o.value.last_page||h.value,onClick:s[2]||(s[2]=a=>T(o.value.current_page+1))}," Siguiente ",8,bt)])]))}};export{wt as default};
