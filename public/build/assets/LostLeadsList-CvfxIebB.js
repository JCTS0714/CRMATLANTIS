import{r as x,e as ce,o as ue,g as p,i as m,j as e,A as L,w as N,z as q,L as pe,t as d,u as _,F as K,m as P,s as G,k as z,v as me,D as H,E as W,C as ve,y as be}from"./vendor-vue-Diyp6CFE.js";import{a as R}from"./vendor-utils-Czy7fllw.js";import{u as xe,a as ye,_ as ge,t as F,b as X}from"./App-DAC6HJ3v.js";import"./app-BDRZbfW-.js";import"./vendor-ui-BsDgRXDF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"space-y-4"},fe={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},he={class:"w-full sm:max-w-xl"},ke={class:"relative"},we={class:"mt-2 text-xs text-slate-300"},Ce={key:0},Se={key:1},Ie={class:"flex items-center gap-2"},Ee=["disabled"],Re=["disabled"],Te=["disabled"],Ve={class:"bg-slate-900/40 border border-slate-800 rounded-xl overflow-hidden"},$e={class:"divide-y divide-slate-800"},De={key:0},Le={key:1},Ne={class:"px-4 py-3"},ze={class:"font-semibold"},Fe={class:"text-xs text-slate-300"},Me={key:0,class:"mt-2 text-xs text-slate-300 line-clamp-2"},Be={class:"px-4 py-3 text-slate-200"},Oe={class:"px-4 py-3 text-slate-200"},Ae={key:0},je={key:1},Ue={class:"px-4 py-3 text-slate-200"},qe={class:"px-4 py-3 text-slate-200"},Ke={class:"break-all"},Pe={class:"px-4 py-3 text-slate-300 whitespace-nowrap"},Ge={class:"px-4 py-3"},He=["onClick"],We={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Xe={class:"relative w-full max-w-2xl rounded-xl bg-white shadow-xl dark:bg-slate-900"},Je={class:"p-5 border-b border-gray-200 dark:border-slate-800"},Qe={class:"mt-1 text-sm text-gray-600 dark:text-slate-300"},Ye={key:0},Ze={class:"p-5"},et={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},tt={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},st={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},at={class:"mt-1 text-sm text-gray-900 dark:text-slate-100 break-all"},ot={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},lt={key:0},nt={key:1},rt={class:"mt-4"},dt={class:"p-5 border-t border-gray-200 dark:border-slate-800 flex items-center justify-end gap-2"},it=["disabled"],ct=["disabled"],gt={__name:"LostLeadsList",setup(ut){const T=x(""),y=x([]),f=x(!1),S=x(null),I=x(!1),V=x(!1),i=x(null),g=x(""),h=x(!1),M=x(null),v=x({current_page:1,last_page:1,per_page:25,total:0}),$=[{key:"lead",label:"Lead"},{key:"company",label:"Empresa"},{key:"document",label:"Documento"},{key:"phone",label:"Teléfono"},{key:"email",label:"Email"},{key:"date",label:"Fecha"},{key:"actions",label:"Acciones"}],{tableRef:B,visibleKeys:J,isColumnVisible:Q,toggleColumn:Y,resetColumns:Z}=xe({tableId:"lost-leads-table",columns:$}),{tableScrollRef:ee,stickyScrollRef:te,stickyScrollWidth:se,showStickyXScroll:ae}=ye({tableRef:B}),oe=ce(()=>{const a=v.value.total||0;if(!a)return"";const t=v.value.current_page||1,s=v.value.per_page||25,l=(t-1)*s+1,o=Math.min(t*s,a);return`${l}-${o} de ${a}`}),k=async(a=1)=>{var t,s,l,o,r,n,u,b,w,C,E,A,j,U;f.value=!0;try{const c=await R.get("/desistidos/data",{params:{q:T.value,page:a,per_page:v.value.per_page}});y.value=((s=(t=c==null?void 0:c.data)==null?void 0:t.data)==null?void 0:s.items)??[],v.value={current_page:((r=(o=(l=c==null?void 0:c.data)==null?void 0:l.data)==null?void 0:o.pagination)==null?void 0:r.current_page)??1,last_page:((b=(u=(n=c==null?void 0:c.data)==null?void 0:n.data)==null?void 0:u.pagination)==null?void 0:b.last_page)??1,per_page:((E=(C=(w=c==null?void 0:c.data)==null?void 0:w.data)==null?void 0:C.pagination)==null?void 0:E.per_page)??v.value.per_page,total:((U=(j=(A=c==null?void 0:c.data)==null?void 0:A.data)==null?void 0:j.pagination)==null?void 0:U.total)??0}}catch(c){console.error(c),y.value=[],v.value={current_page:1,last_page:1,per_page:v.value.per_page,total:0}}finally{f.value=!1}},le=()=>{var a,t;(t=(a=S.value)==null?void 0:a.click)==null||t.call(a)},ne=async a=>{var s,l,o,r,n;const t=(l=(s=a==null?void 0:a.target)==null?void 0:s.files)==null?void 0:l[0];if(t){I.value=!0;try{const u=new FormData;u.append("csv",t);const{data:b}=await R.post("/desistidos/import",u,{headers:{"Content-Type":"multipart/form-data"}});X(((o=b==null?void 0:b.output)!=null&&o.trim(),"Importación finalizada")),await k(1)}catch(u){const b=((n=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:n.message)??"No se pudo importar el CSV.";F(b)}finally{I.value=!1,S.value&&(S.value.value="")}}},re=a=>a?new Date(a).toLocaleString():"",D=()=>{V.value=!1,i.value=null,g.value=""},de=async()=>{var s,l;new URLSearchParams(window.location.search).get("focus")==="observacion"&&(await be(),(l=(s=M.value)==null?void 0:s.focus)==null||l.call(s))},O=async a=>{var s,l,o,r;const t=Number(a);if(!(!Number.isFinite(t)||t<=0))try{const n=await R.get(`/desistidos/${t}`);i.value=((s=n==null?void 0:n.data)==null?void 0:s.data)??null,g.value=((l=i.value)==null?void 0:l.observacion)??"",V.value=!0,await de()}catch(n){const u=((r=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:r.message)??"No se pudo abrir el desistido.";F(u)}},ie=async()=>{var a,t,s,l;if((a=i.value)!=null&&a.id){h.value=!0;try{const o=await R.patch(`/desistidos/${i.value.id}`,{observacion:g.value||null}),r=(t=o==null?void 0:o.data)==null?void 0:t.data;if(r){i.value=r,g.value=r.observacion??"";const n=y.value.findIndex(u=>u.id===r.id);n!==-1&&y.value.splice(n,1,{...y.value[n],...r})}X("Observación guardada"),D()}catch(o){const r=((l=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:l.message)??"No se pudo guardar la observación.";F(r)}finally{h.value=!1}}};return ue(async()=>{await k(1);const t=new URLSearchParams(window.location.search).get("open");if(t){await O(t);try{window.history.replaceState({},"","/desistidos")}catch{}}}),(a,t)=>(m(),p("div",_e,[e("div",fe,[e("div",he,[t[6]||(t[6]=e("label",{class:"sr-only",for:"lostlead-search"},"Buscar",-1)),e("div",ke,[t[5]||(t[5]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"h-4 w-4 text-slate-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M9 3a6 6 0 104.472 10.03l2.249 2.248a1 1 0 001.414-1.414l-2.248-2.249A6 6 0 009 3zm-4 6a4 4 0 118 0 4 4 0 01-8 0z","clip-rule":"evenodd"})])],-1)),N(e("input",{id:"lostlead-search","onUpdate:modelValue":t[0]||(t[0]=s=>T.value=s),onKeyup:t[1]||(t[1]=pe(s=>k(1),["enter"])),placeholder:"Buscar (nombre, contacto, empresa, documento, observación...)",class:"block w-full rounded-lg border border-slate-700 bg-slate-900/40 pl-9 pr-3 py-2 text-sm text-slate-100 placeholder:text-slate-400 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20"},null,544),[[q,T.value]])]),e("div",we,[v.value.total?(m(),p("span",Ce,"Mostrando "+d(oe.value),1)):(m(),p("span",Se,"Sin resultados"))])]),e("div",Ie,[e("input",{ref_key:"importInput",ref:S,type:"file",accept:".csv,text/csv",class:"hidden",onChange:ne},null,544),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:I.value,onClick:le},d(I.value?"Importando…":"Importar CSV"),9,Ee),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:f.value||v.value.current_page<=1,onClick:t[2]||(t[2]=s=>k(v.value.current_page-1))}," Anterior ",8,Re),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:f.value||v.value.current_page>=v.value.last_page,onClick:t[3]||(t[3]=s=>k(v.value.current_page+1))}," Siguiente ",8,Te),L(ge,{columns:$,"visible-keys":_(J),onToggle:_(Y),onReset:_(Z)},null,8,["visible-keys","onToggle","onReset"])])]),e("div",Ve,[e("div",{ref_key:"tableScrollRef",ref:ee,class:"overflow-x-auto"},[e("table",{ref_key:"tableRef",ref:B,class:"min-w-full text-sm"},[e("colgroup",null,[(m(),p(K,null,P($,s=>e("col",{key:s.key,style:G({display:_(Q)(s.key)?"":"none"})},null,4)),64))]),t[9]||(t[9]=e("thead",{class:"bg-slate-900/70 border-b border-slate-800"},[e("tr",{class:"text-left text-xs font-semibold text-slate-300 uppercase tracking-wider"},[e("th",{class:"px-4 py-3"},"Lead"),e("th",{class:"px-4 py-3"},"Empresa"),e("th",{class:"px-4 py-3"},"Documento"),e("th",{class:"px-4 py-3"},"Teléfono"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Fecha"),e("th",{class:"px-4 py-3"},"Acciones")])],-1)),e("tbody",$e,[f.value?(m(),p("tr",De,[...t[7]||(t[7]=[e("td",{class:"px-4 py-6 text-slate-300",colspan:"7"},"Cargando desistidos…",-1)])])):y.value.length===0?(m(),p("tr",Le,[...t[8]||(t[8]=[e("td",{class:"px-4 py-10 text-slate-300",colspan:"7"}," No hay leads desistidos. ",-1)])])):(m(!0),p(K,{key:2},P(y.value,s=>(m(),p("tr",{key:s.id,class:"text-slate-100"},[e("td",Ne,[e("div",ze,d(s.name||"—"),1),e("div",Fe,d(s.contact_name||"—"),1),s.observacion?(m(),p("div",Me,d(s.observacion),1)):z("",!0)]),e("td",Be,d(s.company_name||"—"),1),e("td",Oe,[s.document_type||s.document_number?(m(),p("span",Ae,d(s.document_type||"")+" "+d(s.document_number||""),1)):(m(),p("span",je,"—"))]),e("td",Ue,d(s.contact_phone||"—"),1),e("td",qe,[e("span",Ke,d(s.contact_email||"—"),1)]),e("td",Pe,d(re(s.created_at)),1),e("td",Ge,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-700 bg-slate-900/40 px-3 py-2 text-xs font-medium text-slate-200 hover:bg-slate-800",onClick:l=>O(s.id)}," Ver / Observación ",8,He)])]))),128))])],512)],512),N(e("div",{ref_key:"stickyScrollRef",ref:te,class:"sticky bottom-0 z-20 mt-2 overflow-x-auto rounded-lg border border-slate-200 bg-white/95 dark:border-slate-700 dark:bg-slate-900/95"},[e("div",{style:G({width:`${_(se)}px`,height:"1px"})},null,4)],512),[[me,_(ae)]])]),L(W,{name:"fade"},{default:H(()=>[V.value?(m(),p("div",We,[e("div",{class:"absolute inset-0 bg-black/50",onClick:D}),L(W,{name:"pop"},{default:H(()=>{var s,l,o,r,n,u,b,w,C;return[e("div",Xe,[e("div",Je,[t[10]||(t[10]=e("div",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100"},"Desistido",-1)),e("div",Qe,[ve(d(((s=i.value)==null?void 0:s.name)||"—")+" ",1),(l=i.value)!=null&&l.company_name?(m(),p("span",Ye,"· "+d(i.value.company_name),1)):z("",!0)])]),e("div",Ze,[e("div",et,[e("div",null,[t[11]||(t[11]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Contacto",-1)),e("div",tt,d(((o=i.value)==null?void 0:o.contact_name)||"—"),1)]),e("div",null,[t[12]||(t[12]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Teléfono",-1)),e("div",st,d(((r=i.value)==null?void 0:r.contact_phone)||"—"),1)]),e("div",null,[t[13]||(t[13]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Email",-1)),e("div",at,d(((n=i.value)==null?void 0:n.contact_email)||"—"),1)]),e("div",null,[t[14]||(t[14]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Documento",-1)),e("div",ot,[(u=i.value)!=null&&u.document_type||(b=i.value)!=null&&b.document_number?(m(),p("span",lt,d(((w=i.value)==null?void 0:w.document_type)||"")+" "+d(((C=i.value)==null?void 0:C.document_number)||""),1)):(m(),p("span",nt,"—"))])])]),e("div",rt,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300"},"Observación",-1)),N(e("textarea",{ref_key:"observacionEl",ref:M,"onUpdate:modelValue":t[4]||(t[4]=E=>g.value=E),rows:"5",class:"mt-1 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-100",placeholder:"Escribe la observación..."},null,512),[[q,g.value]])])]),e("div",dt,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-4 focus:ring-blue-100 disabled:opacity-60 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:h.value,onClick:D}," Cerrar ",8,it),e("button",{type:"button",class:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-60",disabled:h.value||!i.value,onClick:ie},d(h.value?"Guardando…":"Guardar"),9,ct)])])]}),_:1})])):z("",!0)]),_:1})]))}};export{gt as default};
