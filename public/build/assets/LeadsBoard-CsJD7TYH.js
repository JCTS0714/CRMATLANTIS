import{r as g,e as fe,H as ie,o as Fe,f as qe,g as m,i as b,j as r,B as J,k as f,w as c,D as T,y as Be,x as v,t as _,n as ye,F as ue,m as xe,l as w,s as Oe,A as X,C as Z,v as ee,z as ce,I as Ye}from"./vendor-vue-Db-AqoDh.js";import{a as D}from"./vendor-utils-Czy7fllw.js";import{t as te,c as ae,a as F}from"./App-D_XY1sJF.js";import"./app-CglYj3fU.js";import"./vendor-ui-DEm6YKEA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ge={class:"mb-4 flex items-center gap-3"},Qe={class:"flex items-center gap-2"},He={class:"flex items-center gap-2"},Ke={key:0,class:"flex items-center gap-2"},We={key:1,class:"flex items-center gap-2"},Je={key:2,class:"flex items-center gap-2"},Xe={key:3,class:"flex items-center gap-2"},Ze={key:4,class:"flex items-center gap-2"},et={key:5,class:"flex items-center gap-2"},tt={key:0,class:"text-sm text-gray-600 dark:text-slate-300"},at={key:1,class:"mb-3 text-sm text-red-600"},rt=["data-stage-id","onDrop"],ot={class:"p-4 border-b border-gray-200 dark:border-slate-800"},st={class:"flex items-center justify-between gap-3"},lt={class:"text-sm font-semibold text-gray-900 dark:text-slate-100"},nt={class:"text-xs text-gray-600 dark:text-slate-300"},dt={class:"p-3 space-y-3 min-h-[140px]"},it={key:0,class:"text-sm text-gray-500 dark:text-slate-400 px-1"},ut=["data-lead-id"],ct={key:0,class:"h-1 bg-blue-500 rounded-full mx-3 mb-2 animate-pulse transition-all duration-200"},mt=["data-lead-id","draggable","onDragstart","onClick"],bt={class:"flex items-start justify-between gap-3"},gt={class:"text-sm font-semibold text-gray-900 dark:text-slate-100"},pt={key:0,class:"text-xs text-gray-600 dark:text-slate-300 mt-1"},vt={key:1,class:"text-xs text-gray-600 dark:text-slate-300 mt-1"},ft={key:0,class:"text-xs text-gray-700 dark:text-slate-200"},yt={key:0,class:"mt-2 text-xs text-gray-600 dark:text-slate-300"},xt={key:0},kt={key:1},_t={class:"mt-3 flex items-center justify-between gap-2"},ht=["onClick"],wt=["disabled","onClick"],Ct={key:1,class:"h-1 bg-blue-500 rounded-full mx-3 mt-2 animate-pulse transition-all duration-200"},Dt={class:"relative w-full max-w-lg"},Nt={class:"relative bg-white rounded-lg shadow dark:bg-slate-900"},Et={class:"grid gap-3"},Ut={class:"flex gap-3"},St={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Vt=["placeholder"],Lt={key:0,class:"text-sm text-red-600"},$t={class:"mt-5 flex items-center justify-between"},Mt=["disabled"],It={class:"relative w-full max-w-lg"},Tt={class:"relative bg-white rounded-lg shadow dark:bg-slate-900"},At={class:"grid gap-3"},Pt={class:"flex gap-3"},jt={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},zt={key:0,class:"text-sm text-red-600"},Rt={class:"mt-5 flex items-center justify-between"},Ft=["disabled"],qt={key:0,class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Bt={class:"flex items-center gap-2"},Ot=["disabled"],Yt=["disabled"],Zt={__name:"LeadsBoard",setup(Gt){const re=g(!0),k=g([]),q=g(20),y=g("last_week"),V=g(""),L=g(""),$=g(""),N=g(""),M=g(""),I=g(""),ke=g(!1),_e=()=>{V.value="",L.value="",$.value="",N.value="",M.value="",I.value=""},E=g(""),C=g(null),oe=g(null),B=g(null),O=g(null),he=fe(()=>{const a=k.value.length||1;return a<=1?"grid-cols-1":a===2?"grid-cols-1 md:grid-cols-2":a===3?"grid-cols-1 md:grid-cols-3":"grid-cols-1 md:grid-cols-2 xl:grid-cols-4"}),we=(a,e)=>{const t=Number(a);return Number.isNaN(t)?"":e==="USD"?`$${t.toFixed(2)}`:`S/ ${t.toFixed(2)}`},A=a=>String(a).padStart(2,"0"),me=a=>{const e=a.getFullYear(),t=A(a.getMonth()+1),s=A(a.getDate());return`${e}-${t}-${s}`},se=a=>{if(!a||!/^\d{4}-\d{2}$/.test(a))return{from:null,to:null};const[e,t]=a.split("-"),s=Number(e),l=Number(t);if(Number.isNaN(s)||Number.isNaN(l)||l<1||l>12)return{from:null,to:null};const o=new Date(s,l,0).getDate();return{from:`${s}-${A(l)}-01`,to:`${s}-${A(l)}-${A(o)}`}},be=(a,e)=>a&&e&&a>e?{from:e,to:a}:{from:a,to:e},Ce=()=>{switch(y.value){case"last_week":{const a=new Date,e=new Date(a);return e.setDate(e.getDate()-6),{from:me(e),to:me(a)}}case"month":{const{from:a,to:e}=se(V.value);return{from:a??void 0,to:e??void 0}}case"between_months":{const a=se(L.value),e=se($.value);return be(a.from??void 0,e.to??void 0)}case"date":return N.value?{from:N.value,to:N.value}:{from:void 0,to:void 0};case"between_dates":return be(M.value||void 0,I.value||void 0);default:return{from:void 0,to:void 0}}},De=()=>y.value==="all"||y.value==="last_week"?!0:y.value==="month"?!!V.value:y.value==="between_months"?!!L.value&&!!$.value:y.value==="date"?!!N.value:y.value==="between_dates"?!!M.value&&!!I.value:!1,U=async({showLoading:a=!0}={})=>{var e,t,s,l;a&&(re.value=!0);try{const o=Ce(),d={limit:q.value||void 0,date_from:o.from,date_to:o.to},u=await D.get("/leads/board-data",{params:d});k.value=((t=(e=u==null?void 0:u.data)==null?void 0:e.data)==null?void 0:t.stages)??[]}catch(o){k.value=[];const d=((l=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:l.message)??"No se pudo cargar el pipeline.";te(d),console.error("Leads board load error",o)}finally{a&&(re.value=!1)}};ie(q,async(a,e)=>{ke.value||a!==e&&await U({showLoading:!1})}),ie(y,async(a,e)=>{a!==e&&_e(),(a==="all"||a==="last_week")&&await U({showLoading:!1})}),ie([V,L,$,N,M,I],async()=>{De()&&await U({showLoading:!1})});const Y=g(new Set),P=(a,e)=>!!(a!=null&&a.archived_at||a!=null&&a.won_at||e!=null&&e.is_won),Ne=(a,e,t)=>{P(a,e)||(C.value=a,oe.value=k.value.find(s=>s.id===a.stage_id),t!=null&&t.target&&(t.target.style.transform="scale(1.02)",t.target.style.opacity="0.7",t.target.style.transition="transform 0.1s ease"))},Ee=a=>{a!=null&&a.target&&(a.target.style.transform="",a.target.style.opacity="",a.target.style.transition=""),B.value=null,O.value=null,C.value=null,oe.value=null},Ue=a=>{if(!C.value)return;a.preventDefault();const e=a.currentTarget.closest("section[data-stage-id]");if(!e)return;const t=parseInt(e.getAttribute("data-stage-id")),s=k.value.find(o=>o.id===t);if(!s)return;B.value=t;const l=a.clientY;O.value=le(s,l,C.value.id)},Se=async(a,e)=>{if(e.preventDefault(),!C.value||!a)return;const t=C.value,s=oe.value;if(P(t,s)){E.value="Este lead está bloqueado y no se puede mover.";return}if(!(a.is_won&&!t.customer_id&&!await ae({title:"Confirmar GANADO",text:"¿Marcar este lead como GANADO? Esto lo convertirá en cliente automáticamente.",confirmText:"Sí, marcar como ganado",cancelText:"Cancelar",icon:"warning"}))){E.value="";try{if(s.id===a.id){const o=e.clientY,d=le(a,o,t.id);Ve(a.id,t.id,d)}else{const o=e.clientY,d=le(a,o,t.id);pe(s.id,t.id),Le(a.id,{...t,stage_id:a.id},d),D.patch(`/leads/${t.id}/move-stage`,{stage_id:a.id}).then(()=>{const u=a.leads.map(p=>p.id);return D.patch("/leads/reorder",{stage_id:a.id,ordered_ids:u})}).catch(u=>{console.error("Error moving lead:",u),E.value="Error al mover el lead. Recargando...",U({showLoading:!1})})}}catch{E.value="Error al mover el lead. Inténtalo de nuevo.",await U({showLoading:!1})}}},ge=new Map,le=(a,e,t=null)=>{let s=ge.get(a.id);if(!s||!document.contains(s)){if(s=document.querySelector(`[data-stage-id="${a.id}"] .p-3`),!s)return 0;ge.set(a.id,s)}const l=s.querySelectorAll("article[data-lead-id]");let o=0;for(let d=0;d<l.length;d++){const u=l[d],p=parseInt(u.getAttribute("data-lead-id"));if(t&&p===t)continue;const x=u.getBoundingClientRect();if(e<x.top+x.height/2)return o;o++}return o},Ve=async(a,e,t)=>{const s=k.value.find(p=>p.id===a);if(!s||!Array.isArray(s.leads))return;const l=s.leads.findIndex(p=>p.id===e);if(l===-1||l===t)return;const[o]=s.leads.splice(l,1),d=Math.min(Math.max(0,t),s.leads.length);s.leads.splice(d,0,o),s.count=s.leads.length;const u=s.leads.map(p=>p.id);D.patch("/leads/reorder",{stage_id:a,ordered_ids:u}).catch(p=>{console.error("Error reordering leads:",p),U({showLoading:!1})})},pe=(a,e)=>{const t=k.value.find(l=>l.id===a);if(!(t!=null&&t.leads))return;const s=t.leads.findIndex(l=>l.id===e);s!==-1&&(t.leads.splice(s,1),t.count=t.leads.length)},Le=(a,e,t=0)=>{const s=k.value.find(d=>d.id===a);if(!s)return;Array.isArray(s.leads)||(s.leads=[]);const l=s.leads.findIndex(d=>d.id===e.id);l!==-1&&s.leads.splice(l,1);const o=Math.min(Math.max(0,t),s.leads.length);s.leads.splice(o,0,e),s.count=s.leads.length},$e=async(a,e)=>{var s,l;if(!(!(a!=null&&a.id)||!(e!=null&&e.is_won)&&!(a!=null&&a.won_at)||!await ae({title:"Archivar lead",text:"Se ocultará del pipeline, pero seguirá visible en la tabla (historial).",confirmText:"Archivar",cancelText:"Cancelar",icon:"warning"}))){Y.value.add(a.id),E.value="";try{await D.patch(`/leads/${a.id}/archive`);const o=pe(e.id,a.id);F("Lead archivado")}catch(o){const d=((l=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:l.message)??"No se pudo archivar el lead.";E.value=d,te(d)}finally{Y.value.delete(a.id)}}},Me=a=>{if(!(a!=null&&a.id))return;const e=a.name?`Seguimiento lead: ${a.name}`:"Seguimiento lead",t=[a.company_name?`Empresa: ${a.company_name}`:null,a.contact_name?`Contacto: ${a.contact_name}`:null,a.contact_phone?`Teléfono: ${a.contact_phone}`:null,a.contact_email?`Email: ${a.contact_email}`:null,a.observacion?`Observación: ${a.observacion}`:null].filter(Boolean),s=new URLSearchParams({related_type:"lead",related_id:String(a.id),title:e});t.length>0&&s.set("description",t.join(" | ")),window.location.assign(`/calendar?${s.toString()}`)},G=g(!1),Q=g(!1),j=g(""),i=g({name:"",amount:null,currency:"PEN",contact_name:"",contact_phone:"",contact_email:"",company_name:"",company_address:"",document_type:"",document_number:"",observacion:""}),Ie=fe(()=>i.value.document_type==="dni"?"Documento: DNI (8 dígitos)":i.value.document_type==="ruc"?"Documento: RUC (11 dígitos)":"Documento: Número (opcional)"),Te=()=>{j.value="",i.value={name:"",amount:null,currency:"PEN",contact_name:"",contact_phone:"",contact_email:"",company_name:"",company_address:"",document_type:"",document_number:"",observacion:""},G.value=!0},ne=()=>{G.value=!1},H=a=>{var l,o,d;const e=(o=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:o.errors;if(!e||typeof e!="object")return null;const t=Object.keys(e)[0],s=t?(d=e[t])==null?void 0:d[0]:null;return typeof s=="string"?s:null},Ae=async()=>{var e,t;Q.value=!0,j.value="";const a={name:i.value.name,amount:i.value.amount,currency:i.value.currency,contact_name:i.value.contact_name||null,contact_phone:i.value.contact_phone||null,contact_email:i.value.contact_email||null,company_name:i.value.company_name||null,company_address:i.value.company_address||null,document_type:i.value.document_type||null,document_number:i.value.document_number||null,observacion:i.value.observacion||null};try{const l=(await D.post("/leads",a)).data.data,o=k.value.find(d=>d.sort_order===10||d.key==="follow_up")||k.value[0];o&&(Array.isArray(o.leads)||(o.leads=[]),o.leads.unshift(l),o.count=o.leads.length),F("Lead creado exitosamente"),ne()}catch(s){j.value=H(s)??((t=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:t.message)??"No se pudo crear el lead."}finally{Q.value=!1}},K=g(!1),S=g(!1),z=g(""),W=g(null),n=g({id:null,name:"",amount:null,currency:"PEN",contact_name:"",contact_phone:"",contact_email:"",company_name:"",company_address:"",document_type:"",document_number:"",observacion:""}),Pe=a=>{z.value="",n.value={id:a.id,name:a.name||"",amount:a.amount??null,currency:a.currency??"PEN",contact_name:a.contact_name??"",contact_phone:a.contact_phone??"",contact_email:a.contact_email??"",company_name:a.company_name??"",company_address:a.company_address??"",document_type:a.document_type??"",document_number:a.document_number??"",observacion:a.observacion??""},K.value=!0,Ye(()=>{var e,t,s;(e=W.value)!=null&&e.focus&&(W.value.focus(),(s=(t=W.value).select)==null||s.call(t))})},je=async()=>{var e,t,s,l,o,d;if(!(!((e=n.value)!=null&&e.id)||!await ae({title:"Marcar como desistido",text:"¿Estás seguro? Esto archivará el lead y lo moverá a la lista de desistidos.",confirmText:"Sí, marcar",cancelText:"Cancelar",icon:"warning"})))try{const u=await D.post(`/leads/${n.value.id}/desist`,{observacion:n.value.observacion||""});R();for(const x of k.value){const h=((s=(t=x.leads)==null?void 0:t.findIndex)==null?void 0:s.call(t,de=>de.id===n.value.id))??-1;if(h!==-1){x.leads.splice(h,1),x.count=x.leads.length;break}}F("Lead marcado como desistido");const p=((l=u==null?void 0:u.data)==null?void 0:l.location)||"/desistidos";window.location.assign(p)}catch(u){const p=H(u)??((d=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:d.message)??"No se pudo marcar como desistido.";te(p)}},ze=async()=>{var e,t,s,l,o,d;if(!(!((e=n.value)!=null&&e.id)||!await ae({title:"Enviar a zona de espera",text:"¿Estás seguro? Esto archivará el lead y lo moverá a la zona de espera.",confirmText:"Sí, enviar",cancelText:"Cancelar",icon:"warning"})))try{const u=await D.post(`/leads/${n.value.id}/wait`,{observacion:n.value.observacion||""});R();for(const x of k.value){const h=((s=(t=x.leads)==null?void 0:t.findIndex)==null?void 0:s.call(t,de=>de.id===n.value.id))??-1;if(h!==-1){x.leads.splice(h,1),x.count=x.leads.length;break}}F("Lead enviado a zona de espera");const p=((l=u==null?void 0:u.data)==null?void 0:l.location)||"/espera";window.location.assign(p)}catch(u){const p=H(u)??((d=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:d.message)??"No se pudo enviar a zona de espera.";te(p)}},R=()=>{K.value=!1},Re=async()=>{var e,t,s;S.value=!0,z.value="";const a={name:n.value.name,amount:n.value.amount,currency:n.value.currency,observacion:n.value.observacion||null,contact_name:n.value.contact_name||null,contact_phone:n.value.contact_phone||null,contact_email:n.value.contact_email||null,company_name:n.value.company_name||null,company_address:n.value.company_address||null,document_type:n.value.document_type||null,document_number:n.value.document_number||null};try{const l=await D.put(`/leads/${n.value.id}`,a),o=(e=l==null?void 0:l.data)==null?void 0:e.data;if(o)for(const d of k.value){if(!Array.isArray(d.leads))continue;const u=d.leads.findIndex(p=>p.id===o.id);if(u!==-1){d.leads.splice(u,1,o);break}}F("Lead actualizado"),R()}catch(l){z.value=H(l)??((s=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:s.message)??"No se pudo actualizar el lead."}finally{S.value=!1}},ve=()=>Te();return Fe(async()=>{window.addEventListener("leads:create-quick",ve),await U()}),qe(()=>{window.removeEventListener("leads:create-quick",ve)}),(a,e)=>(b(),m(ue,null,[r("div",null,[e[40]||(e[40]=r("div",{class:"mb-4 text-sm text-gray-600 dark:text-slate-300"}," Arrastra un lead entre columnas para cambiar su etapa. ",-1)),r("div",Ge,[r("div",Qe,[e[31]||(e[31]=r("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Limite:",-1)),c(r("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>q.value=t),class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:focus:ring-blue-900/30"},[...e[30]||(e[30]=[r("option",{value:20},"20",-1),r("option",{value:50},"50",-1)])],512),[[T,q.value,void 0,{number:!0}]])]),r("div",He,[e[33]||(e[33]=r("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Periodo:",-1)),c(r("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:focus:ring-blue-900/30"},[...e[32]||(e[32]=[Be('<option value="all">Todos</option><option value="last_week">Última semana</option><option value="month">Por mes</option><option value="between_months">Entre meses</option><option value="date">Por fecha</option><option value="between_dates">Entre fechas</option>',6)])],512),[[T,y.value]])]),y.value==="month"?(b(),m("div",Ke,[e[34]||(e[34]=r("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Mes:",-1)),c(r("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>V.value=t),type:"month",class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 placeholder:text-gray-400 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500 dark:focus:ring-blue-900/30 dark:[color-scheme:dark]"},null,512),[[v,V.value]])])):f("",!0),y.value==="between_months"?(b(),m("div",We,[e[35]||(e[35]=r("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Desde mes:",-1)),c(r("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>L.value=t),type:"month",class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 placeholder:text-gray-400 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500 dark:focus:ring-blue-900/30 dark:[color-scheme:dark]"},null,512),[[v,L.value]])])):f("",!0),y.value==="between_months"?(b(),m("div",Je,[e[36]||(e[36]=r("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Hasta mes:",-1)),c(r("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>$.value=t),type:"month",class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 placeholder:text-gray-400 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500 dark:focus:ring-blue-900/30 dark:[color-scheme:dark]"},null,512),[[v,$.value]])])):f("",!0),y.value==="date"?(b(),m("div",Xe,[e[37]||(e[37]=r("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Fecha:",-1)),c(r("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>N.value=t),type:"date",class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 placeholder:text-gray-400 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500 dark:focus:ring-blue-900/30 dark:[color-scheme:dark]"},null,512),[[v,N.value]])])):f("",!0),y.value==="between_dates"?(b(),m("div",Ze,[e[38]||(e[38]=r("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Desde:",-1)),c(r("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>M.value=t),type:"date",class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 placeholder:text-gray-400 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500 dark:focus:ring-blue-900/30 dark:[color-scheme:dark]"},null,512),[[v,M.value]])])):f("",!0),y.value==="between_dates"?(b(),m("div",et,[e[39]||(e[39]=r("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Hasta:",-1)),c(r("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>I.value=t),type:"date",class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 placeholder:text-gray-400 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500 dark:focus:ring-blue-900/30 dark:[color-scheme:dark]"},null,512),[[v,I.value]])])):f("",!0)]),re.value?(b(),m("div",tt,"Cargando...")):E.value?(b(),m("div",at,_(E.value),1)):(b(),m("div",{key:2,class:ye(["grid gap-4",he.value])},[(b(!0),m(ue,null,xe(k.value,t=>{var s,l;return b(),m("section",{key:t.id,"data-stage-id":t.id,class:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden dark:bg-slate-900 dark:border-slate-800",onDragover:w(Ue,["prevent"]),onDrop:w(o=>Se(t,o),["prevent"])},[r("div",ot,[r("div",st,[r("div",lt,_(t.name),1),r("div",nt,_(t.count),1)])]),r("div",dt,[(((s=t.leads)==null?void 0:s.length)??0)===0?(b(),m("div",it," Sin leads. ")):f("",!0),(b(!0),m(ue,null,xe(t.leads,(o,d)=>{var u,p,x;return b(),m("div",{key:o.id,"data-lead-id":o.id},[B.value===t.id&&O.value===d&&((u=C.value)==null?void 0:u.id)!==o.id?(b(),m("div",ct)):f("",!0),r("article",{"data-lead-id":o.id,class:ye(["select-none bg-gray-50 border border-gray-200 rounded-lg p-3 mb-3 dark:bg-slate-800 dark:border-slate-700 will-change-transform",{"opacity-60 scale-95 shadow-lg":((p=C.value)==null?void 0:p.id)===o.id,"cursor-not-allowed opacity-80":P(o,t),"cursor-grab hover:bg-blue-50/30 dark:hover:bg-slate-800/50 hover:shadow-md":!P(o,t)}]),style:Oe(((x=C.value)==null?void 0:x.id)===o.id?"transition: none !important; transform: scale(1.02);":"transition: transform 0.1s ease, opacity 0.1s ease;"),draggable:!P(o,t),onDragstart:h=>Ne(o,t,h),onDragend:Ee,onClick:h=>Pe(o)},[r("div",bt,[r("div",null,[r("div",gt,_(o.name),1),o.company_name?(b(),m("div",pt,_(o.company_name),1)):o.contact_name?(b(),m("div",vt,_(o.contact_name),1)):f("",!0)]),o.amount!==null&&o.amount!==void 0?(b(),m("div",ft,_(we(o.amount,o.currency)),1)):f("",!0)]),o.contact_phone||o.contact_email?(b(),m("div",yt,[o.contact_phone?(b(),m("div",xt,_(o.contact_phone),1)):f("",!0),o.contact_email?(b(),m("div",kt,_(o.contact_email),1)):f("",!0)])):f("",!0),r("div",_t,[r("button",{type:"button",class:"inline-flex items-center rounded-lg border border-blue-200 bg-blue-50 px-3 py-1.5 text-xs font-medium text-blue-700 shadow-sm hover:bg-blue-100 dark:border-blue-800 dark:bg-blue-950 dark:text-blue-300 dark:hover:bg-blue-900",onClick:w(h=>Me(o),["stop","prevent"])}," Agendar ",8,ht),t.is_won?(b(),m("button",{key:0,type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-60 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:Y.value.has(o.id),onClick:w(h=>$e(o,t),["stop","prevent"])},_(Y.value.has(o.id)?"Archivando…":"Archivar"),9,wt)):f("",!0)])],46,mt)],8,ut)}),128)),B.value===t.id&&O.value>=(((l=t.leads)==null?void 0:l.length)||0)?(b(),m("div",Ct)):f("",!0)])],40,rt)}),128))],2))]),J(Z,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:X(()=>[c(r("div",{class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/50",role:"dialog","aria-modal":"true",onClick:w(ne,["self"])},[J(Z,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:X(()=>[c(r("div",Dt,[r("div",Nt,[e[43]||(e[43]=r("div",{class:"p-4 md:p-5 border-b rounded-t dark:border-slate-800"},[r("div",{class:"text-xs font-semibold text-gray-500 dark:text-slate-300 uppercase tracking-wider"},"Contacto inicial"),r("div",{class:"mt-1 text-sm text-gray-600 dark:text-slate-300"}," 0 Clientes potenciales: 0 S/ "),r("div",{class:"mt-3 text-lg font-semibold text-gray-900 dark:text-slate-100 text-center"},"Lead rápido")],-1)),r("form",{class:"p-4 md:p-5",onSubmit:w(Ae,["prevent"])},[r("div",Et,[c(r("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>i.value.name=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Nombre",required:""},null,512),[[v,i.value.name,void 0,{trim:!0}]]),r("div",Ut,[c(r("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>i.value.amount=t),type:"number",min:"0",step:"0.01",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"0"},null,512),[[v,i.value.amount,void 0,{number:!0}]]),c(r("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>i.value.currency=t),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100"},[...e[41]||(e[41]=[r("option",{value:"PEN"},"S/",-1),r("option",{value:"USD"},"USD",-1)])],512),[[T,i.value.currency]])]),c(r("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>i.value.contact_name=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Contacto: Nombre"},null,512),[[v,i.value.contact_name,void 0,{trim:!0}]]),c(r("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>i.value.contact_phone=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Contacto: Teléfono"},null,512),[[v,i.value.contact_phone,void 0,{trim:!0}]]),c(r("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>i.value.contact_email=t),type:"email",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Contacto: Correo"},null,512),[[v,i.value.contact_email,void 0,{trim:!0}]]),c(r("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>i.value.company_name=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Compañía: Nombre"},null,512),[[v,i.value.company_name,void 0,{trim:!0}]]),c(r("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>i.value.company_address=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Compañía: Dirección"},null,512),[[v,i.value.company_address,void 0,{trim:!0}]]),r("div",St,[c(r("select",{"onUpdate:modelValue":e[16]||(e[16]=t=>i.value.document_type=t),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100"},[...e[42]||(e[42]=[r("option",{value:""},"Documento: (opcional)",-1),r("option",{value:"dni"},"DNI",-1),r("option",{value:"ruc"},"RUC",-1)])],512),[[T,i.value.document_type]]),c(r("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>i.value.document_number=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:Ie.value},null,8,Vt),[[v,i.value.document_number,void 0,{trim:!0}]])]),c(r("textarea",{"onUpdate:modelValue":e[18]||(e[18]=t=>i.value.observacion=t),rows:"3",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Observación (opcional)"},null,512),[[v,i.value.observacion,void 0,{trim:!0}]]),j.value?(b(),m("p",Lt,_(j.value),1)):f("",!0)]),r("div",$t,[r("button",{type:"submit",class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300",disabled:Q.value},_(Q.value?"Creando...":"Crear"),9,Mt),r("div",{class:"flex items-center gap-3"},[r("button",{type:"button",class:"text-sm font-medium text-gray-600 hover:text-gray-900 dark:text-slate-300 dark:hover:text-slate-100",onClick:ne}," Cancelar ")])])],32)])],512),[[ee,G.value]])]),_:1})],512),[[ee,G.value]])]),_:1}),J(Z,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:X(()=>[c(r("div",{class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/50",role:"dialog","aria-modal":"true",onClick:w(R,["self"])},[J(Z,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:X(()=>[c(r("div",It,[r("div",Tt,[e[49]||(e[49]=r("div",{class:"p-4 md:p-5 border-b rounded-t dark:border-slate-800"},[r("div",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100 text-center"},"Editar lead")],-1)),r("form",{class:"p-4 md:p-5",onSubmit:w(Re,["prevent"])},[r("div",At,[c(r("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>n.value.name=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Nombre",required:""},null,512),[[v,n.value.name,void 0,{trim:!0}]]),r("div",Pt,[c(r("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>n.value.amount=t),type:"number",min:"0",step:"0.01",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"0"},null,512),[[v,n.value.amount,void 0,{number:!0}]]),c(r("select",{"onUpdate:modelValue":e[21]||(e[21]=t=>n.value.currency=t),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100"},[...e[44]||(e[44]=[r("option",{value:"PEN"},"S/",-1),r("option",{value:"USD"},"USD",-1)])],512),[[T,n.value.currency]])]),c(r("input",{"onUpdate:modelValue":e[22]||(e[22]=t=>n.value.contact_name=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Contacto: Nombre"},null,512),[[v,n.value.contact_name,void 0,{trim:!0}]]),c(r("input",{"onUpdate:modelValue":e[23]||(e[23]=t=>n.value.contact_phone=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Contacto: Teléfono"},null,512),[[v,n.value.contact_phone,void 0,{trim:!0}]]),c(r("input",{"onUpdate:modelValue":e[24]||(e[24]=t=>n.value.contact_email=t),type:"email",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Contacto: Correo"},null,512),[[v,n.value.contact_email,void 0,{trim:!0}]]),c(r("input",{"onUpdate:modelValue":e[25]||(e[25]=t=>n.value.company_name=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Compañía: Nombre"},null,512),[[v,n.value.company_name,void 0,{trim:!0}]]),c(r("input",{"onUpdate:modelValue":e[26]||(e[26]=t=>n.value.company_address=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Compañía: Dirección"},null,512),[[v,n.value.company_address,void 0,{trim:!0}]]),r("div",jt,[c(r("select",{"onUpdate:modelValue":e[27]||(e[27]=t=>n.value.document_type=t),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100"},[...e[45]||(e[45]=[r("option",{value:""},"Documento: (opcional)",-1),r("option",{value:"dni"},"DNI",-1),r("option",{value:"ruc"},"RUC",-1)])],512),[[T,n.value.document_type]]),c(r("input",{"onUpdate:modelValue":e[28]||(e[28]=t=>n.value.document_number=t),type:"text",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100",placeholder:"Documento: Número (opcional)"},null,512),[[v,n.value.document_number,void 0,{trim:!0}]]),c(r("textarea",{ref_key:"observacionInput",ref:W,"onUpdate:modelValue":e[29]||(e[29]=t=>n.value.observacion=t),rows:"3",placeholder:"Observación (motivo de desistimiento o notas)",class:"mt-2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100"},null,512),[[v,n.value.observacion,void 0,{trim:!0}]])]),z.value?(b(),m("p",zt,_(z.value),1)):f("",!0)]),r("div",Rt,[r("button",{type:"submit",class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300",disabled:S.value},[S.value?f("",!0):(b(),m("svg",qt,[...e[46]||(e[46]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),ce(" "+_(S.value?"Guardando...":"Guardar"),1)],8,Ft),r("div",Bt,[r("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 dark:border-blue-800 dark:bg-blue-950 dark:text-blue-300 dark:hover:bg-blue-900",disabled:S.value,onClick:w(ze,["prevent"])},[...e[47]||(e[47]=[r("svg",{class:"w-3.5 h-3.5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),ce(" En Espera ",-1)])],8,Ot),r("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-red-700 bg-red-50 border border-red-200 rounded-lg hover:bg-red-100 dark:border-red-800 dark:bg-red-950 dark:text-red-300 dark:hover:bg-red-900",disabled:S.value,onClick:w(je,["prevent"])},[...e[48]||(e[48]=[r("svg",{class:"w-3.5 h-3.5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ce(" Desistir ",-1)])],8,Yt),r("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700",onClick:R}," Cancelar ")])])],32)])],512),[[ee,K.value]])]),_:1})],512),[[ee,K.value]])]),_:1})],64))}};export{Zt as default};
