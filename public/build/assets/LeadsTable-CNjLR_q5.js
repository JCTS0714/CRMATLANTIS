import{r as $,x as re,g as m,i as u,j as e,t as i,k as R,w as B,G as he,B as ke,z as W,n as ue,C as ce,F as ee,m as te,I as ge,e as q,o as we,A as se,u as k,s as me,q as _e,v as $e}from"./vendor-vue-Diyp6CFE.js";import{a as ne}from"./vendor-utils-Czy7fllw.js";import{S as oe}from"./vendor-ui-BsDgRXDF.js";import{u as Se,a as Ce,_ as De}from"./App-BLINciIY.js";import"./app-D0PWajC2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Pe={class:"flex-1"},Ie=["value"],Fe={class:"flex items-center gap-2"},Te=["disabled"],Ee=["value"],Re={class:"mb-4 flex flex-wrap items-center gap-2"},Ve={class:"flex items-center gap-2"},Me={key:0,class:"flex items-center gap-2"},je={key:1,class:"flex items-center gap-2"},Le={key:2,class:"flex items-center gap-2"},Ue={key:3,class:"flex items-center gap-2"},Be={key:4,class:"flex items-center gap-2"},qe={key:5,class:"flex items-center gap-2"},Ae={class:"mb-4 overflow-x-auto"},ze={class:"inline-flex rounded-lg border border-gray-200 bg-white p-1 shadow-sm dark:border-slate-800 dark:bg-slate-900"},Oe={class:"ml-2 rounded bg-black/5 px-2 py-0.5 text-xs font-semibold text-gray-700 dark:bg-white/10 dark:text-slate-200"},He=["onClick"],We={class:"ml-2 rounded bg-black/5 px-2 py-0.5 text-xs font-semibold text-gray-700 dark:bg-white/10 dark:text-slate-200"},Ge={__name:"LeadsTableFilters",props:{modelValue:{type:String,required:!0},stages:{type:Array,required:!0},activeStageId:{type:[Number,null],default:null},totalCount:{type:Number,default:0},perPage:{type:Number,default:25},importing:{type:Boolean,default:!1}},emits:["update:modelValue","update:per-page","stage-filter","import-file","period-filter"],setup(a,{emit:D}){const f=D,n=$("last_week"),C=$(""),l=$(""),S=$(""),p=$(""),r=$(""),d=$(""),b=()=>{C.value="",l.value="",S.value="",p.value="",r.value="",d.value=""},w=o=>String(o).padStart(2,"0"),A=o=>{const t=o.getFullYear(),s=w(o.getMonth()+1),P=w(o.getDate());return`${t}-${s}-${P}`},V=o=>{if(!o||!/^\d{4}-\d{2}$/.test(o))return{from:null,to:null};const[t,s]=o.split("-"),P=Number(t),F=Number(s);if(Number.isNaN(P)||Number.isNaN(F)||F<1||F>12)return{from:null,to:null};const X=new Date(P,F,0).getDate();return{from:`${P}-${w(F)}-01`,to:`${P}-${w(F)}-${w(X)}`}},U=(o,t)=>o&&t&&o>t?{from:t,to:o}:{from:o,to:t},N=()=>{switch(n.value){case"last_week":{const o=new Date,t=new Date(o);return t.setDate(t.getDate()-6),{from:A(t),to:A(o)}}case"month":{const{from:o,to:t}=V(C.value);return{from:o??void 0,to:t??void 0}}case"between_months":{const o=V(l.value),t=V(S.value);return U(o.from??void 0,t.to??void 0)}case"date":return p.value?{from:p.value,to:p.value}:{from:void 0,to:void 0};case"between_dates":return U(r.value||void 0,d.value||void 0);default:return{from:void 0,to:void 0}}},T=()=>n.value==="all"||n.value==="last_week"?!0:n.value==="month"?!!C.value:n.value==="between_months"?!!l.value&&!!S.value:n.value==="date"?!!p.value:n.value==="between_dates"?!!r.value&&!!d.value:!1;re(n,(o,t)=>{if(o!==t&&b(),o==="all"||o==="last_week"){const s=N();f("period-filter",{date_from:s.from,date_to:s.to})}});const M=N();return f("period-filter",{date_from:M.from,date_to:M.to}),re([C,l,S,p,r,d],()=>{if(!T())return;const o=N();f("period-filter",{date_from:o.from,date_to:o.to})}),(o,t)=>(u(),m("section",null,[e("div",Ne,[e("div",Pe,[t[12]||(t[12]=e("label",{class:"sr-only",for:"leads-search"},"Buscar",-1)),e("input",{id:"leads-search",value:a.modelValue,type:"search",placeholder:"Buscar por nombre, empresa, contacto, email, teléfono, documento…",class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500",onInput:t[0]||(t[0]=s=>o.$emit("update:modelValue",s.target.value))},null,40,Ie)]),e("div",Fe,[e("input",{ref:"importInput",type:"file",accept:".csv,text/csv",class:"hidden",onChange:t[1]||(t[1]=s=>o.$emit("import-file",s))},null,544),e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:a.importing,onClick:t[2]||(t[2]=s=>o.$refs.importInput.click())},i(a.importing?"Importando…":"Importar CSV"),9,Te),e("select",{value:a.perPage,class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100",onChange:t[3]||(t[3]=s=>o.$emit("update:per-page",Number(s.target.value)))},[...t[13]||(t[13]=[e("option",{value:10},"10",-1),e("option",{value:15},"15",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1)])],40,Ee)])]),e("div",Re,[e("div",Ve,[t[15]||(t[15]=e("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Periodo:",-1)),B(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.value=s),class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[...t[14]||(t[14]=[ke('<option value="all">Todos</option><option value="last_week">Última semana</option><option value="month">Por mes</option><option value="between_months">Entre meses</option><option value="date">Por fecha</option><option value="between_dates">Entre fechas</option>',6)])],512),[[he,n.value]])]),n.value==="month"?(u(),m("div",Me,[t[16]||(t[16]=e("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Mes:",-1)),B(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>C.value=s),type:"month",class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:scheme-dark"},null,512),[[W,C.value]])])):R("",!0),n.value==="between_months"?(u(),m("div",je,[t[17]||(t[17]=e("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Desde mes:",-1)),B(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.value=s),type:"month",class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:scheme-dark"},null,512),[[W,l.value]])])):R("",!0),n.value==="between_months"?(u(),m("div",Le,[t[18]||(t[18]=e("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Hasta mes:",-1)),B(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>S.value=s),type:"month",class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:scheme-dark"},null,512),[[W,S.value]])])):R("",!0),n.value==="date"?(u(),m("div",Ue,[t[19]||(t[19]=e("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Fecha:",-1)),B(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>p.value=s),type:"date",class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:scheme-dark"},null,512),[[W,p.value]])])):R("",!0),n.value==="between_dates"?(u(),m("div",Be,[t[20]||(t[20]=e("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Desde:",-1)),B(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>r.value=s),type:"date",class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:scheme-dark"},null,512),[[W,r.value]])])):R("",!0),n.value==="between_dates"?(u(),m("div",qe,[t[21]||(t[21]=e("label",{class:"text-xs text-gray-600 dark:text-slate-300"},"Hasta:",-1)),B(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>d.value=s),type:"date",class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:scheme-dark"},null,512),[[W,d.value]])])):R("",!0)]),e("div",Ae,[e("div",ze,[e("button",{type:"button",class:ue(["px-3 py-2 text-sm font-medium rounded-md transition",a.activeStageId===null?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-50 dark:text-slate-200 dark:hover:bg-slate-800"]),onClick:t[11]||(t[11]=s=>o.$emit("stage-filter",null))},[t[22]||(t[22]=ce(" Todos ",-1)),e("span",Oe,i(a.totalCount),1)],2),(u(!0),m(ee,null,te(a.stages,s=>(u(),m("button",{key:s.id,type:"button",class:ue(["px-3 py-2 text-sm font-medium rounded-md transition",a.activeStageId===s.id?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-50 dark:text-slate-200 dark:hover:bg-slate-800"]),onClick:P=>o.$emit("stage-filter",s.id)},[ce(i(s.name)+" ",1),e("span",We,i(s.count??0),1)],10,He))),128))])])]))}},Ke={class:"border-b border-gray-100 bg-white hover:bg-blue-50/40 transition-colors dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800/60"},Xe={class:"px-4 py-3 font-medium text-gray-900 dark:text-slate-100"},Ye={class:"px-4 py-3"},Je={class:"flex flex-col gap-1"},Qe={class:"px-4 py-3 text-right"},Ze={class:"px-4 py-3"},et={class:"px-4 py-3"},tt={class:"px-4 py-3"},at={class:"px-4 py-3"},st={class:"px-4 py-3"},ot={class:"px-4 py-3"},rt={class:"px-4 py-3"},nt={class:"px-4 py-3"},lt={class:"px-4 py-3"},dt={class:"px-4 py-3"},it=["value","disabled"],ut=["value"],ct={class:"px-4 py-3"},gt={class:"px-4 py-3"},mt={class:"px-4 py-3"},pt={class:"px-4 py-3"},bt={__name:"LeadsTableRow",props:{lead:{type:Object,required:!0},stages:{type:Array,default:()=>[]},isMoving:{type:Boolean,default:!1}},emits:["change-stage"],setup(a,{emit:D}){const f=D,n=a,C=(r,d="EUR")=>r?new Intl.NumberFormat("es-ES",{style:"currency",currency:d||"EUR"}).format(r):"",l=r=>r?new Date(r).toLocaleString("es-ES"):"",S=()=>{const r=n.lead||{},d=r.name?`Seguimiento lead: ${r.name}`:"Seguimiento lead",b=[r.company_name?`Empresa: ${r.company_name}`:null,r.contact_name?`Contacto: ${r.contact_name}`:null,r.contact_phone?`Teléfono: ${r.contact_phone}`:null,r.contact_email?`Email: ${r.contact_email}`:null,r.observacion?`Observación: ${r.observacion}`:null].filter(Boolean),w=new URLSearchParams({related_type:"lead",related_id:String(r.id??""),title:d});b.length>0&&w.set("description",b.join(" | ")),window.location.assign(`/calendar?${w.toString()}`)},p=r=>{var b,w;const d=Number(r.target.value);!Number.isFinite(d)||d<=0||d!==Number((b=n.lead)==null?void 0:b.stage_id)&&f("change-stage",{leadId:(w=n.lead)==null?void 0:w.id,stageId:d})};return(r,d)=>(u(),m("tr",Ke,[e("td",Xe,i(a.lead.id),1),e("td",Ye,[e("div",Je,[e("span",null,i(a.lead.name??""),1),e("button",{type:"button",class:"inline-flex w-fit items-center rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 hover:bg-blue-100 dark:border-blue-800 dark:bg-blue-950 dark:text-blue-300 dark:hover:bg-blue-900",onClick:S}," Agendar ")])]),e("td",Qe,i(C(a.lead.amount,a.lead.currency)),1),e("td",Ze,i(a.lead.currency??""),1),e("td",et,i(a.lead.contact_name??""),1),e("td",tt,i(a.lead.contact_phone??""),1),e("td",at,i(a.lead.contact_email??""),1),e("td",st,i(a.lead.company_name??""),1),e("td",ot,i(a.lead.company_address??""),1),e("td",rt,i(a.lead.document_type??""),1),e("td",nt,i(a.lead.document_number??""),1),e("td",lt,i(a.lead.customer_id??""),1),e("td",dt,[e("select",{class:"w-full rounded-lg border border-gray-200 bg-white px-2 py-1.5 text-xs text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100",value:a.lead.stage_id??"",disabled:a.isMoving||!Array.isArray(a.stages)||a.stages.length===0,onChange:p},[(u(!0),m(ee,null,te(a.stages,b=>(u(),m("option",{key:b.id,value:b.id},i(b.name),9,ut))),128))],40,it)]),e("td",ct,i(a.lead.created_by_name||a.lead.created_by||""),1),e("td",gt,i(l(a.lead.won_at)),1),e("td",mt,i(l(a.lead.created_at)),1),e("td",pt,i(l(a.lead.updated_at)),1)]))}},yt={class:"p-4 flex items-center justify-between gap-3"},ft=["disabled"],xt={class:"text-xs text-gray-600 dark:text-slate-300"},vt=["disabled"],ht={__name:"LeadsTablePagination",props:{pagination:{type:Object,required:!0,default:()=>({current_page:1,last_page:1})},loading:{type:Boolean,default:!1}},emits:["page-change"],setup(a){return(D,f)=>(u(),m("div",yt,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:a.loading||a.pagination.current_page<=1,onClick:f[0]||(f[0]=n=>D.$emit("page-change",a.pagination.current_page-1))}," Anterior ",8,ft),e("div",xt," Página "+i(a.pagination.current_page)+" / "+i(a.pagination.last_page),1),e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:a.loading||a.pagination.current_page>=a.pagination.last_page,onClick:f[1]||(f[1]=n=>D.$emit("page-change",a.pagination.current_page+1))}," Siguiente ",8,vt)]))}};function kt(a={}){const{endpoint:D,defaultPerPage:f=25,defaultFilters:n={},searchDebounce:C=300}=a,l=$(!1),S=$(null),p=$([]),r=$([]),d=ge({current_page:1,last_page:1,per_page:f,total:0,from:null,to:null}),b=ge({q:"",page:1,per_page:f,...n}),w=q(()=>p.value.length>0),A=q(()=>!l.value&&p.value.length===0),V=q(()=>d.total||0),U=q(()=>{if(!d.total)return"";const _=d.from||0,z=d.to||0,O=d.total||0;return`${_}-${z} de ${O}`}),N=async(_={})=>{var z,O,Y;if(!D){console.error("useTableData: endpoint is required");return}l.value=!0,S.value=null;try{const H={...b,..._},J=await ne.get(D,{params:H}),v=((z=J.data)==null?void 0:z.data)||J.data;p.value=(v==null?void 0:v.items)||(v==null?void 0:v.leads)||[],v!=null&&v.stages&&(r.value=v.stages),v!=null&&v.pagination&&Object.assign(d,v.pagination)}catch(H){S.value=((Y=(O=H.response)==null?void 0:O.data)==null?void 0:Y.message)||"Error al cargar los datos",console.error("useTableData fetch error:",H)}finally{l.value=!1}},T=async(_={})=>{Object.assign(b,_),await N()},M=async _=>{await T({page:_})},o=async _=>{await T({per_page:_,page:1})},t=async _=>{await T({q:_,page:1})},s=async()=>{await N()},P=async()=>{Object.assign(b,{q:"",page:1,per_page:f,...n}),await N()};let F;return{loading:l,error:S,items:p,stagesData:r,pagination:d,filters:b,hasData:w,isEmpty:A,totalCount:V,paginationInfo:U,fetchData:N,applyFilters:T,changePage:M,changePerPage:o,search:t,debouncedSearch:_=>{clearTimeout(F),F=setTimeout(()=>{t(_)},C)},refresh:s,reset:P}}const wt={key:0,class:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700 dark:border-red-900/40 dark:bg-red-950/30 dark:text-red-200"},_t={class:"bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-slate-900 dark:border-slate-800"},$t={class:"p-4 border-b border-gray-200 dark:border-slate-800 flex items-center justify-between"},St={class:"mt-1 text-xs text-gray-600 dark:text-slate-300"},Ct={key:0},Dt={class:"flex items-center gap-3"},Nt={key:0,class:"text-xs text-gray-600 dark:text-slate-300"},Pt={key:0},Mt={__name:"LeadsTable",setup(a){const{loading:D,error:f,items:n,stagesData:C,pagination:l,isEmpty:S,paginationInfo:p,fetchData:r,applyFilters:d,changePage:b,changePerPage:w,debouncedSearch:A}=kt({endpoint:"/leads/data",defaultPerPage:25}),V=q(()=>C.value||[]),U=$(!1),N=$(new Set),T=$(""),M=$(null),o=q(()=>l.per_page),t=q(()=>l.total||0),s=[{key:"id",label:"ID"},{key:"name",label:"Nombre"},{key:"amount",label:"Monto"},{key:"currency",label:"Moneda"},{key:"contact_name",label:"Contacto"},{key:"contact_phone",label:"Teléfono"},{key:"contact_email",label:"Email"},{key:"company_name",label:"Empresa"},{key:"company_address",label:"Dirección"},{key:"document_type",label:"Doc. tipo"},{key:"document_number",label:"Doc. nro"},{key:"customer_id",label:"Customer ID"},{key:"stage",label:"Estado"},{key:"created_by",label:"Creado por"},{key:"won_at",label:"Won at"},{key:"created_at",label:"Creado"},{key:"updated_at",label:"Actualizado"}],{tableRef:P,visibleKeys:F,isColumnVisible:X,toggleColumn:_,resetColumns:z}=Se({tableId:"leads-table",columns:s}),{tableScrollRef:O,stickyScrollRef:Y,stickyScrollWidth:H,showStickyXScroll:J}=Ce({tableRef:P});re(T,c=>{A(c)});const v=c=>{w(c)},pe=c=>{M.value=c,d({stage_id:c,page:1})},be=({date_from:c,date_to:y}={})=>{d({date_from:c||void 0,date_to:y||void 0,page:1})},Q=(c,y)=>{const g=Number(c);if(!Number.isFinite(g))return;const h=C.value.find(E=>Number(E.id)===g);if(!h)return;const I=Number(h.count||0);h.count=Math.max(0,I+y)},ye=()=>{Number.isFinite(l.total)&&l.total>0&&(l.total-=1),Number.isFinite(l.to)&&l.to>0&&(l.to-=1)},fe=()=>{Number.isFinite(l.total)&&(l.total+=1),Number.isFinite(l.to)&&(l.to+=1)},xe=async({leadId:c,stageId:y})=>{var le,de,ie;if(!c||!y)return;const g=n.value.findIndex(L=>L.id===c),h=g!==-1?n.value[g]:null;if(!h)return;const I=Number(h.stage_id),E=Number(y);if(I===E)return;const x=V.value.find(L=>Number(L.id)===E),j=h.stage_name,Z=M.value===null?null:Number(M.value),G=Z!==null&&Z!==E,ae={...h};N.value.add(c),h.stage_id=E,x!=null&&x.name&&(h.stage_name=x.name),Q(I,-1),Q(E,1),G&&g!==-1&&(n.value.splice(g,1),ye());try{const L=await ne.patch(`/leads/${c}/move-stage`,{stage_id:E}),K=(le=L==null?void 0:L.data)==null?void 0:le.data;!G&&K&&typeof K=="object"&&Object.assign(h,K)}catch(L){if(h.stage_id=I,h.stage_name=j,Q(E,-1),Q(I,1),G){const K=Math.min(g,n.value.length);n.value.splice(K,0,ae),fe()}oe.fire({title:"No se pudo cambiar de etapa",text:((ie=(de=L.response)==null?void 0:de.data)==null?void 0:ie.message)||"Error desconocido",icon:"error"})}finally{N.value.delete(c)}},ve=async c=>{var g,h;const y=c.target.files[0];if(y){U.value=!0;try{const I=new FormData;I.append("file",y);const x=(await ne.post("/leads/import/prospectos",I,{headers:{"Content-Type":"multipart/form-data"}})).data,j=(x==null?void 0:x.data)??{},Z=(x==null?void 0:x.processed)??(j.created||0)+(j.updated||0)+(j.skipped||0)+(j.invalid||0),G=(x==null?void 0:x.imported)??(j.created||0)+(j.updated||0),ae=(x==null?void 0:x.errors)??(j.invalid||0);oe.fire({title:"¡Importación completada!",html:`
        <div class="text-left">
          <p><strong>Procesados:</strong> ${Z}</p>
          <p><strong>Importados:</strong> ${G}</p>
          <p><strong>Errores:</strong> ${ae}</p>
        </div>
      `,icon:"success"}),await r()}catch(I){console.error(I),oe.fire({title:"Error en la importación",text:((h=(g=I.response)==null?void 0:g.data)==null?void 0:h.message)||"Error desconocido",icon:"error"})}finally{U.value=!1,c.target.value=""}}};return we(async()=>{await r()}),(c,y)=>(u(),m("section",null,[se(Ge,{modelValue:T.value,"onUpdate:modelValue":y[0]||(y[0]=g=>T.value=g),stages:V.value,"active-stage-id":M.value,"total-count":t.value,"per-page":o.value,importing:U.value,"onUpdate:perPage":v,onStageFilter:pe,onImportFile:ve,onPeriodFilter:be},null,8,["modelValue","stages","active-stage-id","total-count","per-page","importing"]),k(f)?(u(),m("div",wt,i(k(f)),1)):R("",!0),e("div",_t,[e("div",$t,[e("div",null,[y[1]||(y[1]=e("div",{class:"text-sm font-semibold text-gray-900 dark:text-slate-100"},"Leads",-1)),e("div",St,[k(p)?(u(),m("span",Ct,i(k(p)),1)):R("",!0)])]),e("div",Dt,[se(De,{columns:s,"visible-keys":k(F),onToggle:k(_),onReset:k(z)},null,8,["visible-keys","onToggle","onReset"]),k(D)?(u(),m("div",Nt,"Cargando…")):R("",!0)])]),e("div",{ref_key:"tableScrollRef",ref:O,class:"overflow-x-auto"},[e("table",{ref_key:"tableRef",ref:P,class:"min-w-[1400px] w-full text-sm text-left text-gray-700 dark:text-slate-200"},[e("colgroup",null,[(u(),m(ee,null,te(s,g=>e("col",{key:g.key,style:me({display:k(X)(g.key)?"":"none"})},null,4)),64))]),y[3]||(y[3]=e("thead",{class:"text-xs uppercase bg-gray-50 text-gray-700 dark:bg-slate-800 dark:text-slate-200"},[e("tr",null,[e("th",{class:"px-4 py-3"},"ID"),e("th",{class:"px-4 py-3"},"Nombre"),e("th",{class:"px-4 py-3 text-right"},"Monto"),e("th",{class:"px-4 py-3"},"Moneda"),e("th",{class:"px-4 py-3"},"Contacto"),e("th",{class:"px-4 py-3"},"Teléfono"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Empresa"),e("th",{class:"px-4 py-3"},"Dirección"),e("th",{class:"px-4 py-3"},"Doc. tipo"),e("th",{class:"px-4 py-3"},"Doc. nro"),e("th",{class:"px-4 py-3"},"Customer ID"),e("th",{class:"px-4 py-3"},"Estado"),e("th",{class:"px-4 py-3"},"Creado por"),e("th",{class:"px-4 py-3"},"Won at"),e("th",{class:"px-4 py-3"},"Creado"),e("th",{class:"px-4 py-3"},"Actualizado")])],-1)),e("tbody",null,[(u(!0),m(ee,null,te(k(n),g=>(u(),_e(bt,{key:g.id,lead:g,stages:V.value,"is-moving":N.value.has(g.id),onChangeStage:xe},null,8,["lead","stages","is-moving"]))),128)),k(S)?(u(),m("tr",Pt,[...y[2]||(y[2]=[e("td",{colspan:"17",class:"px-4 py-10 text-center text-sm text-gray-600 dark:text-slate-300"}," Sin leads. ",-1)])])):R("",!0)])],512)],512),B(e("div",{ref_key:"stickyScrollRef",ref:Y,class:"sticky bottom-0 z-20 mt-2 overflow-x-auto rounded-lg border border-slate-200 bg-white/95 dark:border-slate-700 dark:bg-slate-900/95"},[e("div",{style:me({width:`${k(H)}px`,height:"1px"})},null,4)],512),[[$e,k(J)]]),se(ht,{pagination:k(l),loading:k(D),onPageChange:k(b)},null,8,["pagination","loading","onPageChange"])])]))}};export{Mt as default};
