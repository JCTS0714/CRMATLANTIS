import{r as m,e as X,o as Y,g as v,i as x,j as e,B as O,w as j,x as A,L as ee,t as d,F as te,m as ae,k as z,A as U,C as P,z as se,I as oe}from"./vendor-vue-Db-AqoDh.js";import{a as C}from"./vendor-utils-Czy7fllw.js";import{t as E,a as D,c as le}from"./App-Btt0t-0g.js";import"./app-CEWwc3KD.js";import"./vendor-ui-DEm6YKEA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"space-y-4"},re={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},de={class:"w-full sm:max-w-xl"},ie={class:"relative"},ce={class:"mt-2 text-xs text-slate-300"},ue={key:0},pe={key:1},ve={class:"flex items-center gap-2"},xe=["disabled"],me=["disabled"],ge=["disabled"],be={class:"bg-slate-900/40 border border-slate-800 rounded-xl overflow-hidden"},_e={class:"overflow-x-auto"},fe={class:"min-w-full text-sm"},ye={class:"divide-y divide-slate-800"},he={key:0},ke={key:1},we={class:"px-4 py-3"},Ce={class:"font-semibold"},Ie={class:"text-xs text-slate-300"},Se={key:0,class:"mt-2 text-xs text-slate-300 line-clamp-2"},Le={class:"px-4 py-3 text-slate-200"},$e={class:"px-4 py-3 text-slate-200"},Ee={key:0},Ne={key:1},Te={class:"px-4 py-3 text-slate-200"},Ve={class:"px-4 py-3 text-slate-200"},ze={class:"break-all"},De={class:"px-4 py-3 text-slate-300 whitespace-nowrap"},Me={class:"px-4 py-3"},Be={class:"flex gap-2"},Fe=["onClick"],Re=["disabled","onClick"],qe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Oe={class:"relative w-full max-w-2xl rounded-xl bg-white shadow-xl dark:bg-slate-900"},je={class:"p-5 border-b border-gray-200 dark:border-slate-800"},Ae={class:"mt-1 text-sm text-gray-600 dark:text-slate-300"},Ue={key:0},Pe={class:"p-5"},Ge={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},Ke={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},We={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},Ze={class:"mt-1 text-sm text-gray-900 dark:text-slate-100 break-all"},He={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},Je={key:0},Qe={key:1},Xe={class:"mt-4"},Ye={class:"p-5 border-t border-gray-200 dark:border-slate-800 flex items-center justify-end gap-2"},et=["disabled"],tt=["disabled"],it={__name:"WaitingLeadsList",setup(at){const N=m(""),b=m([]),f=m(!1),I=m(new Set),S=m(null),L=m(!1),T=m(!1),i=m(null),_=m(""),y=m(!1),M=m(null),u=m({current_page:1,last_page:1,per_page:25,total:0}),G=X(()=>{const s=u.value.total||0;if(!s)return"";const t=u.value.current_page||1,a=u.value.per_page||25,l=(t-1)*a+1,o=Math.min(t*a,s);return`${l}-${o} de ${s}`}),h=async(s=1)=>{var t,a,l,o,n,r,p,g,k,w,$,F,R,q;f.value=!0;try{const c=await C.get("/espera/data",{params:{q:N.value,page:s,per_page:u.value.per_page}});b.value=((a=(t=c==null?void 0:c.data)==null?void 0:t.data)==null?void 0:a.items)??[],u.value={current_page:((n=(o=(l=c==null?void 0:c.data)==null?void 0:l.data)==null?void 0:o.pagination)==null?void 0:n.current_page)??1,last_page:((g=(p=(r=c==null?void 0:c.data)==null?void 0:r.data)==null?void 0:p.pagination)==null?void 0:g.last_page)??1,per_page:(($=(w=(k=c==null?void 0:c.data)==null?void 0:k.data)==null?void 0:w.pagination)==null?void 0:$.per_page)??u.value.per_page,total:((q=(R=(F=c==null?void 0:c.data)==null?void 0:F.data)==null?void 0:R.pagination)==null?void 0:q.total)??0}}catch(c){console.error(c),b.value=[],u.value={current_page:1,last_page:1,per_page:u.value.per_page,total:0}}finally{f.value=!1}},K=()=>{var s,t;(t=(s=S.value)==null?void 0:s.click)==null||t.call(s)},W=async s=>{var a,l,o,n,r;const t=(l=(a=s==null?void 0:s.target)==null?void 0:a.files)==null?void 0:l[0];if(t){L.value=!0;try{const p=new FormData;p.append("csv",t);const{data:g}=await C.post("/espera/import",p,{headers:{"Content-Type":"multipart/form-data"}});D(((o=g==null?void 0:g.output)!=null&&o.trim(),"Importación finalizada")),await h(1)}catch(p){const g=((r=(n=p==null?void 0:p.response)==null?void 0:n.data)==null?void 0:r.message)??"No se pudo importar el CSV.";E(g)}finally{L.value=!1,S.value&&(S.value.value="")}}},Z=s=>s?new Date(s).toLocaleString():"",V=()=>{T.value=!1,i.value=null,_.value=""},H=async()=>{var a,l;new URLSearchParams(window.location.search).get("focus")==="observacion"&&(await oe(),(l=(a=M.value)==null?void 0:a.focus)==null||l.call(a))},B=async s=>{var a,l,o,n;const t=Number(s);if(!(!Number.isFinite(t)||t<=0))try{const r=await C.get(`/espera/${t}`);i.value=((a=r==null?void 0:r.data)==null?void 0:a.data)??null,_.value=((l=i.value)==null?void 0:l.observacion)??"",T.value=!0,await H()}catch(r){const p=((n=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:n.message)??"No se pudo abrir el registro.";E(p)}},J=async()=>{var s,t,a,l;if((s=i.value)!=null&&s.id){y.value=!0;try{const o=await C.patch(`/espera/${i.value.id}`,{observacion:_.value||null}),n=(t=o==null?void 0:o.data)==null?void 0:t.data;if(n){i.value=n,_.value=n.observacion??"";const r=b.value.findIndex(p=>p.id===n.id);r!==-1&&b.value.splice(r,1,{...b.value[r],...n})}D("Observación guardada"),V()}catch(o){const n=((l=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:l.message)??"No se pudo guardar la observación.";E(n)}finally{y.value=!1}}},Q=async s=>{var a,l;if(!(!(s!=null&&s.id)||!await le({title:"Reactivar lead",text:`¿Estás seguro que deseas reactivar el lead "${s.name}"? Esto lo moverá de vuelta al pipeline de leads.`,confirmText:"Sí, reactivar",cancelText:"Cancelar",icon:"question"}))){I.value.add(s.id);try{const o=await C.post(`/espera/${s.id}/reactivate`),n=b.value.findIndex(r=>r.id===s.id);n!==-1&&(b.value.splice(n,1),u.value.total=Math.max(0,u.value.total-1)),D("Lead reactivado exitosamente"),setTimeout(()=>{window.location.assign("/leads")},1500)}catch(o){console.error("Error reactivating lead:",o);const n=((l=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:l.message)??"No se pudo reactivar el lead";E(n)}finally{I.value.delete(s.id)}}};return Y(async()=>{console.log("WaitingLeadsList mounted - reactivation functionality loaded"),await h(1);const t=new URLSearchParams(window.location.search).get("open");if(t){await B(t);try{window.history.replaceState({},"","/espera")}catch{}}}),(s,t)=>(x(),v("div",ne,[e("div",re,[e("div",de,[t[6]||(t[6]=e("label",{class:"sr-only",for:"waitinglead-search"},"Buscar",-1)),e("div",ie,[t[5]||(t[5]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"h-4 w-4 text-slate-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M9 3a6 6 0 104.472 10.03l2.249 2.248a1 1 0 001.414-1.414l-2.248-2.249A6 6 0 009 3zm-4 6a4 4 0 118 0 4 4 0 01-8 0z","clip-rule":"evenodd"})])],-1)),j(e("input",{id:"waitinglead-search","onUpdate:modelValue":t[0]||(t[0]=a=>N.value=a),onKeyup:t[1]||(t[1]=ee(a=>h(1),["enter"])),placeholder:"Buscar (nombre, contacto, empresa, documento, observación...)",class:"block w-full rounded-lg border border-slate-700 bg-slate-900/40 pl-9 pr-3 py-2 text-sm text-slate-100 placeholder:text-slate-400 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20"},null,544),[[A,N.value]])]),e("div",ce,[u.value.total?(x(),v("span",ue,"Mostrando "+d(G.value),1)):(x(),v("span",pe,"Sin resultados"))])]),e("div",ve,[e("input",{ref_key:"importInput",ref:S,type:"file",accept:".csv,text/csv",class:"hidden",onChange:W},null,544),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:L.value,onClick:K},d(L.value?"Importando…":"Importar CSV"),9,xe),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:f.value||u.value.current_page<=1,onClick:t[2]||(t[2]=a=>h(u.value.current_page-1))}," Anterior ",8,me),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:f.value||u.value.current_page>=u.value.last_page,onClick:t[3]||(t[3]=a=>h(u.value.current_page+1))}," Siguiente ",8,ge)])]),e("div",be,[e("div",_e,[e("table",fe,[t[9]||(t[9]=e("thead",{class:"bg-slate-900/70 border-b border-slate-800"},[e("tr",{class:"text-left text-xs font-semibold text-slate-300 uppercase tracking-wider"},[e("th",{class:"px-4 py-3"},"Lead"),e("th",{class:"px-4 py-3"},"Empresa"),e("th",{class:"px-4 py-3"},"Documento"),e("th",{class:"px-4 py-3"},"Teléfono"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Fecha"),e("th",{class:"px-4 py-3"},"Acciones")])],-1)),e("tbody",ye,[f.value?(x(),v("tr",he,[...t[7]||(t[7]=[e("td",{class:"px-4 py-6 text-slate-300",colspan:"7"},"Cargando zona de espera…",-1)])])):b.value.length===0?(x(),v("tr",ke,[...t[8]||(t[8]=[e("td",{class:"px-4 py-10 text-slate-300",colspan:"7"}," No hay leads en zona de espera. ",-1)])])):(x(!0),v(te,{key:2},ae(b.value,a=>(x(),v("tr",{key:a.id,class:"text-slate-100"},[e("td",we,[e("div",Ce,d(a.name||"—"),1),e("div",Ie,d(a.contact_name||"—"),1),a.observacion?(x(),v("div",Se,d(a.observacion),1)):z("",!0)]),e("td",Le,d(a.company_name||"—"),1),e("td",$e,[a.document_type||a.document_number?(x(),v("span",Ee,d(a.document_type||"")+" "+d(a.document_number||""),1)):(x(),v("span",Ne,"—"))]),e("td",Te,d(a.contact_phone||"—"),1),e("td",Ve,[e("span",ze,d(a.contact_email||"—"),1)]),e("td",De,d(Z(a.created_at)),1),e("td",Me,[e("div",Be,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-700 bg-slate-900/40 px-3 py-2 text-xs font-medium text-slate-200 hover:bg-slate-800",onClick:l=>B(a.id)}," Ver ",8,Fe),e("button",{type:"button",class:"inline-flex items-center rounded-lg bg-green-600 px-3 py-2 text-xs font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 disabled:opacity-60",disabled:I.value.has(a.id),onClick:l=>Q(a)},d(I.value.has(a.id)?"Reactivando...":"Reactivar"),9,Re)])])]))),128))])])])]),O(P,{name:"fade"},{default:U(()=>[T.value?(x(),v("div",qe,[e("div",{class:"absolute inset-0 bg-black/50",onClick:V}),O(P,{name:"pop"},{default:U(()=>{var a,l,o,n,r,p,g,k,w;return[e("div",Oe,[e("div",je,[t[10]||(t[10]=e("div",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100"},"Zona de espera",-1)),e("div",Ae,[se(d(((a=i.value)==null?void 0:a.name)||"—")+" ",1),(l=i.value)!=null&&l.company_name?(x(),v("span",Ue,"· "+d(i.value.company_name),1)):z("",!0)])]),e("div",Pe,[e("div",Ge,[e("div",null,[t[11]||(t[11]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Contacto",-1)),e("div",Ke,d(((o=i.value)==null?void 0:o.contact_name)||"—"),1)]),e("div",null,[t[12]||(t[12]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Teléfono",-1)),e("div",We,d(((n=i.value)==null?void 0:n.contact_phone)||"—"),1)]),e("div",null,[t[13]||(t[13]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Email",-1)),e("div",Ze,d(((r=i.value)==null?void 0:r.contact_email)||"—"),1)]),e("div",null,[t[14]||(t[14]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Documento",-1)),e("div",He,[(p=i.value)!=null&&p.document_type||(g=i.value)!=null&&g.document_number?(x(),v("span",Je,d(((k=i.value)==null?void 0:k.document_type)||"")+" "+d(((w=i.value)==null?void 0:w.document_number)||""),1)):(x(),v("span",Qe,"—"))])])]),e("div",Xe,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300"},"Observación",-1)),j(e("textarea",{ref_key:"observacionEl",ref:M,"onUpdate:modelValue":t[4]||(t[4]=$=>_.value=$),rows:"5",class:"mt-1 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-100",placeholder:"Escribe la observación..."},null,512),[[A,_.value]])])]),e("div",Ye,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-4 focus:ring-blue-100 disabled:opacity-60 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:y.value,onClick:V}," Cerrar ",8,et),e("button",{type:"button",class:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-60",disabled:y.value||!i.value,onClick:J},d(y.value?"Guardando…":"Guardar"),9,tt)])])]}),_:1})])):z("",!0)]),_:1})]))}};export{it as default};
