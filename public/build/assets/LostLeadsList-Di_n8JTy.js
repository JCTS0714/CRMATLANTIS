import{r as b,e as W,o as X,g as m,i as v,j as t,B as O,w as j,x as A,L as Y,t as r,F as Z,m as tt,k as D,A as U,C as q,z as et,I as st}from"./vendor-vue-Db-AqoDh.js";import{a as N}from"./vendor-utils-Czy7fllw.js";import{t as E,a as P}from"./App-Bt9-hbAg.js";import"./app-DjmpOHxG.js";import"./vendor-ui-DEm6YKEA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const at={class:"space-y-4"},ot={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},lt={class:"w-full sm:max-w-xl"},nt={class:"relative"},dt={class:"mt-2 text-xs text-slate-300"},rt={key:0},it={key:1},ct={class:"flex items-center gap-2"},ut=["disabled"],pt=["disabled"],mt=["disabled"],vt={class:"bg-slate-900/40 border border-slate-800 rounded-xl overflow-hidden"},xt={class:"overflow-x-auto"},bt={class:"min-w-full text-sm"},gt={class:"divide-y divide-slate-800"},_t={key:0},yt={key:1},ft={class:"px-4 py-3"},ht={class:"font-semibold"},kt={class:"text-xs text-slate-300"},wt={key:0,class:"mt-2 text-xs text-slate-300 line-clamp-2"},Ct={class:"px-4 py-3 text-slate-200"},It={class:"px-4 py-3 text-slate-200"},St={key:0},Nt={key:1},Lt={class:"px-4 py-3 text-slate-200"},Vt={class:"px-4 py-3 text-slate-200"},$t={class:"break-all"},Dt={class:"px-4 py-3 text-slate-300 whitespace-nowrap"},Et={class:"px-4 py-3"},Tt=["onClick"],Bt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Mt={class:"relative w-full max-w-2xl rounded-xl bg-white shadow-xl dark:bg-slate-900"},zt={class:"p-5 border-b border-gray-200 dark:border-slate-800"},Ft={class:"mt-1 text-sm text-gray-600 dark:text-slate-300"},Ot={key:0},jt={class:"p-5"},At={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},Ut={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},qt={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},Pt={class:"mt-1 text-sm text-gray-900 dark:text-slate-100 break-all"},Rt={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},Gt={key:0},Kt={key:1},Ht={class:"mt-4"},Jt={class:"p-5 border-t border-gray-200 dark:border-slate-800 flex items-center justify-end gap-2"},Qt=["disabled"],Wt=["disabled"],oe={__name:"LostLeadsList",setup(Xt){const L=b(""),g=b([]),y=b(!1),C=b(null),I=b(!1),V=b(!1),i=b(null),_=b(""),f=b(!1),T=b(null),p=b({current_page:1,last_page:1,per_page:25,total:0}),R=W(()=>{const a=p.value.total||0;if(!a)return"";const e=p.value.current_page||1,s=p.value.per_page||25,l=(e-1)*s+1,o=Math.min(e*s,a);return`${l}-${o} de ${a}`}),h=async(a=1)=>{var e,s,l,o,d,n,u,x,k,w,S,M,z,F;y.value=!0;try{const c=await N.get("/desistidos/data",{params:{q:L.value,page:a,per_page:p.value.per_page}});g.value=((s=(e=c==null?void 0:c.data)==null?void 0:e.data)==null?void 0:s.items)??[],p.value={current_page:((d=(o=(l=c==null?void 0:c.data)==null?void 0:l.data)==null?void 0:o.pagination)==null?void 0:d.current_page)??1,last_page:((x=(u=(n=c==null?void 0:c.data)==null?void 0:n.data)==null?void 0:u.pagination)==null?void 0:x.last_page)??1,per_page:((S=(w=(k=c==null?void 0:c.data)==null?void 0:k.data)==null?void 0:w.pagination)==null?void 0:S.per_page)??p.value.per_page,total:((F=(z=(M=c==null?void 0:c.data)==null?void 0:M.data)==null?void 0:z.pagination)==null?void 0:F.total)??0}}catch(c){console.error(c),g.value=[],p.value={current_page:1,last_page:1,per_page:p.value.per_page,total:0}}finally{y.value=!1}},G=()=>{var a,e;(e=(a=C.value)==null?void 0:a.click)==null||e.call(a)},K=async a=>{var s,l,o,d,n;const e=(l=(s=a==null?void 0:a.target)==null?void 0:s.files)==null?void 0:l[0];if(e){I.value=!0;try{const u=new FormData;u.append("csv",e);const{data:x}=await N.post("/desistidos/import",u,{headers:{"Content-Type":"multipart/form-data"}});P(((o=x==null?void 0:x.output)!=null&&o.trim(),"Importación finalizada")),await h(1)}catch(u){const x=((n=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:n.message)??"No se pudo importar el CSV.";E(x)}finally{I.value=!1,C.value&&(C.value.value="")}}},H=a=>a?new Date(a).toLocaleString():"",$=()=>{V.value=!1,i.value=null,_.value=""},J=async()=>{var s,l;new URLSearchParams(window.location.search).get("focus")==="observacion"&&(await st(),(l=(s=T.value)==null?void 0:s.focus)==null||l.call(s))},B=async a=>{var s,l,o,d;const e=Number(a);if(!(!Number.isFinite(e)||e<=0))try{const n=await N.get(`/desistidos/${e}`);i.value=((s=n==null?void 0:n.data)==null?void 0:s.data)??null,_.value=((l=i.value)==null?void 0:l.observacion)??"",V.value=!0,await J()}catch(n){const u=((d=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:d.message)??"No se pudo abrir el desistido.";E(u)}},Q=async()=>{var a,e,s,l;if((a=i.value)!=null&&a.id){f.value=!0;try{const o=await N.patch(`/desistidos/${i.value.id}`,{observacion:_.value||null}),d=(e=o==null?void 0:o.data)==null?void 0:e.data;if(d){i.value=d,_.value=d.observacion??"";const n=g.value.findIndex(u=>u.id===d.id);n!==-1&&g.value.splice(n,1,{...g.value[n],...d})}P("Observación guardada"),$()}catch(o){const d=((l=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:l.message)??"No se pudo guardar la observación.";E(d)}finally{f.value=!1}}};return X(async()=>{await h(1);const e=new URLSearchParams(window.location.search).get("open");if(e){await B(e);try{window.history.replaceState({},"","/desistidos")}catch{}}}),(a,e)=>(v(),m("div",at,[t("div",ot,[t("div",lt,[e[6]||(e[6]=t("label",{class:"sr-only",for:"lostlead-search"},"Buscar",-1)),t("div",nt,[e[5]||(e[5]=t("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[t("svg",{class:"h-4 w-4 text-slate-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[t("path",{"fill-rule":"evenodd",d:"M9 3a6 6 0 104.472 10.03l2.249 2.248a1 1 0 001.414-1.414l-2.248-2.249A6 6 0 009 3zm-4 6a4 4 0 118 0 4 4 0 01-8 0z","clip-rule":"evenodd"})])],-1)),j(t("input",{id:"lostlead-search","onUpdate:modelValue":e[0]||(e[0]=s=>L.value=s),onKeyup:e[1]||(e[1]=Y(s=>h(1),["enter"])),placeholder:"Buscar (nombre, contacto, empresa, documento, observación...)",class:"block w-full rounded-lg border border-slate-700 bg-slate-900/40 pl-9 pr-3 py-2 text-sm text-slate-100 placeholder:text-slate-400 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20"},null,544),[[A,L.value]])]),t("div",dt,[p.value.total?(v(),m("span",rt,"Mostrando "+r(R.value),1)):(v(),m("span",it,"Sin resultados"))])]),t("div",ct,[t("input",{ref_key:"importInput",ref:C,type:"file",accept:".csv,text/csv",class:"hidden",onChange:K},null,544),t("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:I.value,onClick:G},r(I.value?"Importando…":"Importar CSV"),9,ut),t("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:y.value||p.value.current_page<=1,onClick:e[2]||(e[2]=s=>h(p.value.current_page-1))}," Anterior ",8,pt),t("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:y.value||p.value.current_page>=p.value.last_page,onClick:e[3]||(e[3]=s=>h(p.value.current_page+1))}," Siguiente ",8,mt)])]),t("div",vt,[t("div",xt,[t("table",bt,[e[9]||(e[9]=t("thead",{class:"bg-slate-900/70 border-b border-slate-800"},[t("tr",{class:"text-left text-xs font-semibold text-slate-300 uppercase tracking-wider"},[t("th",{class:"px-4 py-3"},"Lead"),t("th",{class:"px-4 py-3"},"Empresa"),t("th",{class:"px-4 py-3"},"Documento"),t("th",{class:"px-4 py-3"},"Teléfono"),t("th",{class:"px-4 py-3"},"Email"),t("th",{class:"px-4 py-3"},"Fecha"),t("th",{class:"px-4 py-3"},"Acciones")])],-1)),t("tbody",gt,[y.value?(v(),m("tr",_t,[...e[7]||(e[7]=[t("td",{class:"px-4 py-6 text-slate-300",colspan:"7"},"Cargando desistidos…",-1)])])):g.value.length===0?(v(),m("tr",yt,[...e[8]||(e[8]=[t("td",{class:"px-4 py-10 text-slate-300",colspan:"7"}," No hay leads desistidos. ",-1)])])):(v(!0),m(Z,{key:2},tt(g.value,s=>(v(),m("tr",{key:s.id,class:"text-slate-100"},[t("td",ft,[t("div",ht,r(s.name||"—"),1),t("div",kt,r(s.contact_name||"—"),1),s.observacion?(v(),m("div",wt,r(s.observacion),1)):D("",!0)]),t("td",Ct,r(s.company_name||"—"),1),t("td",It,[s.document_type||s.document_number?(v(),m("span",St,r(s.document_type||"")+" "+r(s.document_number||""),1)):(v(),m("span",Nt,"—"))]),t("td",Lt,r(s.contact_phone||"—"),1),t("td",Vt,[t("span",$t,r(s.contact_email||"—"),1)]),t("td",Dt,r(H(s.created_at)),1),t("td",Et,[t("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-700 bg-slate-900/40 px-3 py-2 text-xs font-medium text-slate-200 hover:bg-slate-800",onClick:l=>B(s.id)}," Ver / Observación ",8,Tt)])]))),128))])])])]),O(q,{name:"fade"},{default:U(()=>[V.value?(v(),m("div",Bt,[t("div",{class:"absolute inset-0 bg-black/50",onClick:$}),O(q,{name:"pop"},{default:U(()=>{var s,l,o,d,n,u,x,k,w;return[t("div",Mt,[t("div",zt,[e[10]||(e[10]=t("div",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100"},"Desistido",-1)),t("div",Ft,[et(r(((s=i.value)==null?void 0:s.name)||"—")+" ",1),(l=i.value)!=null&&l.company_name?(v(),m("span",Ot,"· "+r(i.value.company_name),1)):D("",!0)])]),t("div",jt,[t("div",At,[t("div",null,[e[11]||(e[11]=t("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Contacto",-1)),t("div",Ut,r(((o=i.value)==null?void 0:o.contact_name)||"—"),1)]),t("div",null,[e[12]||(e[12]=t("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Teléfono",-1)),t("div",qt,r(((d=i.value)==null?void 0:d.contact_phone)||"—"),1)]),t("div",null,[e[13]||(e[13]=t("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Email",-1)),t("div",Pt,r(((n=i.value)==null?void 0:n.contact_email)||"—"),1)]),t("div",null,[e[14]||(e[14]=t("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Documento",-1)),t("div",Rt,[(u=i.value)!=null&&u.document_type||(x=i.value)!=null&&x.document_number?(v(),m("span",Gt,r(((k=i.value)==null?void 0:k.document_type)||"")+" "+r(((w=i.value)==null?void 0:w.document_number)||""),1)):(v(),m("span",Kt,"—"))])])]),t("div",Ht,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300"},"Observación",-1)),j(t("textarea",{ref_key:"observacionEl",ref:T,"onUpdate:modelValue":e[4]||(e[4]=S=>_.value=S),rows:"5",class:"mt-1 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-100",placeholder:"Escribe la observación..."},null,512),[[A,_.value]])])]),t("div",Jt,[t("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-4 focus:ring-blue-100 disabled:opacity-60 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:f.value,onClick:$}," Cerrar ",8,Qt),t("button",{type:"button",class:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-60",disabled:f.value||!i.value,onClick:Q},r(f.value?"Guardando…":"Guardar"),9,Wt)])])]}),_:1})])):D("",!0)]),_:1})]))}};export{oe as default};
