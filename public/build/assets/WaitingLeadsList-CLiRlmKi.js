import{r as b,e as J,o as Q,g as m,i as v,j as e,B as O,w as j,x as A,L as X,t as d,F as Y,m as ee,k as z,A as U,C as q,z as te,I as ae}from"./vendor-vue-Db-AqoDh.js";import{a as N}from"./vendor-utils-Czy7fllw.js";import{t as E,a as P}from"./App-3tNeg2y1.js";import"./app-CLTdK2m3.js";import"./vendor-ui-DEm6YKEA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"space-y-4"},oe={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},le={class:"w-full sm:max-w-xl"},ne={class:"relative"},re={class:"mt-2 text-xs text-slate-300"},de={key:0},ie={key:1},ce={class:"flex items-center gap-2"},ue=["disabled"],pe=["disabled"],me=["disabled"],ve={class:"bg-slate-900/40 border border-slate-800 rounded-xl overflow-hidden"},xe={class:"overflow-x-auto"},be={class:"min-w-full text-sm"},ge={class:"divide-y divide-slate-800"},_e={key:0},ye={key:1},fe={class:"px-4 py-3"},he={class:"font-semibold"},ke={class:"text-xs text-slate-300"},we={key:0,class:"mt-2 text-xs text-slate-300 line-clamp-2"},Ce={class:"px-4 py-3 text-slate-200"},Ie={class:"px-4 py-3 text-slate-200"},Se={key:0},Ne={key:1},Ve={class:"px-4 py-3 text-slate-200"},$e={class:"px-4 py-3 text-slate-200"},ze={class:"break-all"},Ee={class:"px-4 py-3 text-slate-300 whitespace-nowrap"},Le={class:"px-4 py-3"},Te=["onClick"],Be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},De={class:"relative w-full max-w-2xl rounded-xl bg-white shadow-xl dark:bg-slate-900"},Me={class:"p-5 border-b border-gray-200 dark:border-slate-800"},Fe={class:"mt-1 text-sm text-gray-600 dark:text-slate-300"},Oe={key:0},je={class:"p-5"},Ae={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},Ue={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},qe={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},Pe={class:"mt-1 text-sm text-gray-900 dark:text-slate-100 break-all"},Re={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},Ge={key:0},Ke={key:1},We={class:"mt-4"},Ze={class:"p-5 border-t border-gray-200 dark:border-slate-800 flex items-center justify-end gap-2"},He=["disabled"],Je=["disabled"],ot={__name:"WaitingLeadsList",setup(Qe){const V=b(""),g=b([]),y=b(!1),C=b(null),I=b(!1),$=b(!1),i=b(null),_=b(""),f=b(!1),L=b(null),p=b({current_page:1,last_page:1,per_page:25,total:0}),R=J(()=>{const s=p.value.total||0;if(!s)return"";const t=p.value.current_page||1,a=p.value.per_page||25,l=(t-1)*a+1,o=Math.min(t*a,s);return`${l}-${o} de ${s}`}),h=async(s=1)=>{var t,a,l,o,r,n,u,x,k,w,S,D,M,F;y.value=!0;try{const c=await N.get("/espera/data",{params:{q:V.value,page:s,per_page:p.value.per_page}});g.value=((a=(t=c==null?void 0:c.data)==null?void 0:t.data)==null?void 0:a.items)??[],p.value={current_page:((r=(o=(l=c==null?void 0:c.data)==null?void 0:l.data)==null?void 0:o.pagination)==null?void 0:r.current_page)??1,last_page:((x=(u=(n=c==null?void 0:c.data)==null?void 0:n.data)==null?void 0:u.pagination)==null?void 0:x.last_page)??1,per_page:((S=(w=(k=c==null?void 0:c.data)==null?void 0:k.data)==null?void 0:w.pagination)==null?void 0:S.per_page)??p.value.per_page,total:((F=(M=(D=c==null?void 0:c.data)==null?void 0:D.data)==null?void 0:M.pagination)==null?void 0:F.total)??0}}catch(c){console.error(c),g.value=[],p.value={current_page:1,last_page:1,per_page:p.value.per_page,total:0}}finally{y.value=!1}},G=()=>{var s,t;(t=(s=C.value)==null?void 0:s.click)==null||t.call(s)},K=async s=>{var a,l,o,r,n;const t=(l=(a=s==null?void 0:s.target)==null?void 0:a.files)==null?void 0:l[0];if(t){I.value=!0;try{const u=new FormData;u.append("csv",t);const{data:x}=await N.post("/espera/import",u,{headers:{"Content-Type":"multipart/form-data"}});P(((o=x==null?void 0:x.output)!=null&&o.trim(),"Importación finalizada")),await h(1)}catch(u){const x=((n=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:n.message)??"No se pudo importar el CSV.";E(x)}finally{I.value=!1,C.value&&(C.value.value="")}}},W=s=>s?new Date(s).toLocaleString():"",T=()=>{$.value=!1,i.value=null,_.value=""},Z=async()=>{var a,l;new URLSearchParams(window.location.search).get("focus")==="observacion"&&(await ae(),(l=(a=L.value)==null?void 0:a.focus)==null||l.call(a))},B=async s=>{var a,l,o,r;const t=Number(s);if(!(!Number.isFinite(t)||t<=0))try{const n=await N.get(`/espera/${t}`);i.value=((a=n==null?void 0:n.data)==null?void 0:a.data)??null,_.value=((l=i.value)==null?void 0:l.observacion)??"",$.value=!0,await Z()}catch(n){const u=((r=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:r.message)??"No se pudo abrir el registro.";E(u)}},H=async()=>{var s,t,a,l;if((s=i.value)!=null&&s.id){f.value=!0;try{const o=await N.patch(`/espera/${i.value.id}`,{observacion:_.value||null}),r=(t=o==null?void 0:o.data)==null?void 0:t.data;if(r){i.value=r,_.value=r.observacion??"";const n=g.value.findIndex(u=>u.id===r.id);n!==-1&&g.value.splice(n,1,{...g.value[n],...r})}P("Observación guardada")}catch(o){const r=((l=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:l.message)??"No se pudo guardar la observación.";E(r)}finally{f.value=!1}}};return Q(async()=>{await h(1);const t=new URLSearchParams(window.location.search).get("open");if(t){await B(t);try{window.history.replaceState({},"","/espera")}catch{}}}),(s,t)=>(v(),m("div",se,[e("div",oe,[e("div",le,[t[6]||(t[6]=e("label",{class:"sr-only",for:"waitinglead-search"},"Buscar",-1)),e("div",ne,[t[5]||(t[5]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"h-4 w-4 text-slate-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M9 3a6 6 0 104.472 10.03l2.249 2.248a1 1 0 001.414-1.414l-2.248-2.249A6 6 0 009 3zm-4 6a4 4 0 118 0 4 4 0 01-8 0z","clip-rule":"evenodd"})])],-1)),j(e("input",{id:"waitinglead-search","onUpdate:modelValue":t[0]||(t[0]=a=>V.value=a),onKeyup:t[1]||(t[1]=X(a=>h(1),["enter"])),placeholder:"Buscar (nombre, contacto, empresa, documento, observación...)",class:"block w-full rounded-lg border border-slate-700 bg-slate-900/40 pl-9 pr-3 py-2 text-sm text-slate-100 placeholder:text-slate-400 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20"},null,544),[[A,V.value]])]),e("div",re,[p.value.total?(v(),m("span",de,"Mostrando "+d(R.value),1)):(v(),m("span",ie,"Sin resultados"))])]),e("div",ce,[e("input",{ref_key:"importInput",ref:C,type:"file",accept:".csv,text/csv",class:"hidden",onChange:K},null,544),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:I.value,onClick:G},d(I.value?"Importando…":"Importar CSV"),9,ue),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:y.value||p.value.current_page<=1,onClick:t[2]||(t[2]=a=>h(p.value.current_page-1))}," Anterior ",8,pe),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:y.value||p.value.current_page>=p.value.last_page,onClick:t[3]||(t[3]=a=>h(p.value.current_page+1))}," Siguiente ",8,me)])]),e("div",ve,[e("div",xe,[e("table",be,[t[9]||(t[9]=e("thead",{class:"bg-slate-900/70 border-b border-slate-800"},[e("tr",{class:"text-left text-xs font-semibold text-slate-300 uppercase tracking-wider"},[e("th",{class:"px-4 py-3"},"Lead"),e("th",{class:"px-4 py-3"},"Empresa"),e("th",{class:"px-4 py-3"},"Documento"),e("th",{class:"px-4 py-3"},"Teléfono"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Fecha"),e("th",{class:"px-4 py-3"},"Acciones")])],-1)),e("tbody",ge,[y.value?(v(),m("tr",_e,[...t[7]||(t[7]=[e("td",{class:"px-4 py-6 text-slate-300",colspan:"7"},"Cargando zona de espera…",-1)])])):g.value.length===0?(v(),m("tr",ye,[...t[8]||(t[8]=[e("td",{class:"px-4 py-10 text-slate-300",colspan:"7"}," No hay leads en zona de espera. ",-1)])])):(v(!0),m(Y,{key:2},ee(g.value,a=>(v(),m("tr",{key:a.id,class:"text-slate-100"},[e("td",fe,[e("div",he,d(a.name||"—"),1),e("div",ke,d(a.contact_name||"—"),1),a.observacion?(v(),m("div",we,d(a.observacion),1)):z("",!0)]),e("td",Ce,d(a.company_name||"—"),1),e("td",Ie,[a.document_type||a.document_number?(v(),m("span",Se,d(a.document_type||"")+" "+d(a.document_number||""),1)):(v(),m("span",Ne,"—"))]),e("td",Ve,d(a.contact_phone||"—"),1),e("td",$e,[e("span",ze,d(a.contact_email||"—"),1)]),e("td",Ee,d(W(a.created_at)),1),e("td",Le,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-700 bg-slate-900/40 px-3 py-2 text-xs font-medium text-slate-200 hover:bg-slate-800",onClick:l=>B(a.id)}," Ver / Observación ",8,Te)])]))),128))])])])]),O(q,{name:"fade"},{default:U(()=>[$.value?(v(),m("div",Be,[e("div",{class:"absolute inset-0 bg-black/50",onClick:T}),O(q,{name:"pop"},{default:U(()=>{var a,l,o,r,n,u,x,k,w;return[e("div",De,[e("div",Me,[t[10]||(t[10]=e("div",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100"},"Zona de espera",-1)),e("div",Fe,[te(d(((a=i.value)==null?void 0:a.name)||"—")+" ",1),(l=i.value)!=null&&l.company_name?(v(),m("span",Oe,"· "+d(i.value.company_name),1)):z("",!0)])]),e("div",je,[e("div",Ae,[e("div",null,[t[11]||(t[11]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Contacto",-1)),e("div",Ue,d(((o=i.value)==null?void 0:o.contact_name)||"—"),1)]),e("div",null,[t[12]||(t[12]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Teléfono",-1)),e("div",qe,d(((r=i.value)==null?void 0:r.contact_phone)||"—"),1)]),e("div",null,[t[13]||(t[13]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Email",-1)),e("div",Pe,d(((n=i.value)==null?void 0:n.contact_email)||"—"),1)]),e("div",null,[t[14]||(t[14]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Documento",-1)),e("div",Re,[(u=i.value)!=null&&u.document_type||(x=i.value)!=null&&x.document_number?(v(),m("span",Ge,d(((k=i.value)==null?void 0:k.document_type)||"")+" "+d(((w=i.value)==null?void 0:w.document_number)||""),1)):(v(),m("span",Ke,"—"))])])]),e("div",We,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300"},"Observación",-1)),j(e("textarea",{ref_key:"observacionEl",ref:L,"onUpdate:modelValue":t[4]||(t[4]=S=>_.value=S),rows:"5",class:"mt-1 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-100",placeholder:"Escribe la observación..."},null,512),[[A,_.value]])])]),e("div",Ze,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-4 focus:ring-blue-100 disabled:opacity-60 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:f.value,onClick:T}," Cerrar ",8,He),e("button",{type:"button",class:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-60",disabled:f.value||!i.value,onClick:H},d(f.value?"Guardando…":"Guardar"),9,Je)])])]}),_:1})])):z("",!0)]),_:1})]))}};export{ot as default};
