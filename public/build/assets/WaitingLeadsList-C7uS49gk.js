import{r as b,e as pe,o as ve,g as v,i as m,j as e,A as D,w as M,z as P,L as me,t as d,u as f,F as W,m as G,s as H,k as F,v as be,D as X,E as Z,C as ge,y as xe}from"./vendor-vue-Diyp6CFE.js";import{a as S}from"./vendor-utils-Czy7fllw.js";import{u as ye,a as fe,_ as _e,t as $,b as B,c as he}from"./App-DAC6HJ3v.js";import"./app-BDRZbfW-.js";import"./vendor-ui-BsDgRXDF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ke={class:"space-y-4"},we={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Ce={class:"w-full sm:max-w-xl"},Se={class:"relative"},Ee={class:"mt-2 text-xs text-slate-300"},Ie={key:0},Re={key:1},Te={class:"flex items-center gap-2"},$e=["disabled"],Le=["disabled"],ze=["disabled"],Ne={class:"bg-slate-900/40 border border-slate-800 rounded-xl overflow-hidden"},Ve={class:"divide-y divide-slate-800"},De={key:0},Me={key:1},Fe={class:"px-4 py-3"},Be={class:"font-semibold"},qe={class:"text-xs text-slate-300"},Ae={key:0,class:"mt-2 text-xs text-slate-300 line-clamp-2"},Oe={class:"px-4 py-3 text-slate-200"},je={class:"px-4 py-3 text-slate-200"},Ue={key:0},Ke={key:1},Pe={class:"px-4 py-3 text-slate-200"},We={class:"px-4 py-3 text-slate-200"},Ge={class:"break-all"},He={class:"px-4 py-3 text-slate-300 whitespace-nowrap"},Xe={class:"px-4 py-3"},Ze={class:"flex gap-2"},Je=["onClick"],Qe=["disabled","onClick"],Ye={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},et={class:"relative w-full max-w-2xl rounded-xl bg-white shadow-xl dark:bg-slate-900"},tt={class:"p-5 border-b border-gray-200 dark:border-slate-800"},at={class:"mt-1 text-sm text-gray-600 dark:text-slate-300"},st={key:0},ot={class:"p-5"},lt={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},nt={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},rt={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},dt={class:"mt-1 text-sm text-gray-900 dark:text-slate-100 break-all"},it={class:"mt-1 text-sm text-gray-900 dark:text-slate-100"},ct={key:0},ut={key:1},pt={class:"mt-4"},vt={class:"p-5 border-t border-gray-200 dark:border-slate-800 flex items-center justify-end gap-2"},mt=["disabled"],bt=["disabled"],wt={__name:"WaitingLeadsList",setup(gt){const L=b(""),x=b([]),_=b(!1),E=b(new Set),I=b(null),R=b(!1),z=b(!1),i=b(null),y=b(""),h=b(!1),q=b(null),u=b({current_page:1,last_page:1,per_page:25,total:0}),N=[{key:"lead",label:"Lead"},{key:"company",label:"Empresa"},{key:"document",label:"Documento"},{key:"phone",label:"Teléfono"},{key:"email",label:"Email"},{key:"date",label:"Fecha"},{key:"actions",label:"Acciones"}],{tableRef:A,visibleKeys:J,isColumnVisible:Q,toggleColumn:Y,resetColumns:ee}=ye({tableId:"waiting-leads-table",columns:N}),{tableScrollRef:te,stickyScrollRef:ae,stickyScrollWidth:se,showStickyXScroll:oe}=fe({tableRef:A}),le=pe(()=>{const s=u.value.total||0;if(!s)return"";const t=u.value.current_page||1,a=u.value.per_page||25,l=(t-1)*a+1,o=Math.min(t*a,s);return`${l}-${o} de ${s}`}),k=async(s=1)=>{var t,a,l,o,n,r,p,g,w,C,T,j,U,K;_.value=!0;try{const c=await S.get("/espera/data",{params:{q:L.value,page:s,per_page:u.value.per_page}});x.value=((a=(t=c==null?void 0:c.data)==null?void 0:t.data)==null?void 0:a.items)??[],u.value={current_page:((n=(o=(l=c==null?void 0:c.data)==null?void 0:l.data)==null?void 0:o.pagination)==null?void 0:n.current_page)??1,last_page:((g=(p=(r=c==null?void 0:c.data)==null?void 0:r.data)==null?void 0:p.pagination)==null?void 0:g.last_page)??1,per_page:((T=(C=(w=c==null?void 0:c.data)==null?void 0:w.data)==null?void 0:C.pagination)==null?void 0:T.per_page)??u.value.per_page,total:((K=(U=(j=c==null?void 0:c.data)==null?void 0:j.data)==null?void 0:U.pagination)==null?void 0:K.total)??0}}catch(c){console.error(c),x.value=[],u.value={current_page:1,last_page:1,per_page:u.value.per_page,total:0}}finally{_.value=!1}},ne=()=>{var s,t;(t=(s=I.value)==null?void 0:s.click)==null||t.call(s)},re=async s=>{var a,l,o,n,r;const t=(l=(a=s==null?void 0:s.target)==null?void 0:a.files)==null?void 0:l[0];if(t){R.value=!0;try{const p=new FormData;p.append("csv",t);const{data:g}=await S.post("/espera/import",p,{headers:{"Content-Type":"multipart/form-data"}});B(((o=g==null?void 0:g.output)!=null&&o.trim(),"Importación finalizada")),await k(1)}catch(p){const g=((r=(n=p==null?void 0:p.response)==null?void 0:n.data)==null?void 0:r.message)??"No se pudo importar el CSV.";$(g)}finally{R.value=!1,I.value&&(I.value.value="")}}},de=s=>s?new Date(s).toLocaleString():"",V=()=>{z.value=!1,i.value=null,y.value=""},ie=async()=>{var a,l;new URLSearchParams(window.location.search).get("focus")==="observacion"&&(await xe(),(l=(a=q.value)==null?void 0:a.focus)==null||l.call(a))},O=async s=>{var a,l,o,n;const t=Number(s);if(!(!Number.isFinite(t)||t<=0))try{const r=await S.get(`/espera/${t}`);i.value=((a=r==null?void 0:r.data)==null?void 0:a.data)??null,y.value=((l=i.value)==null?void 0:l.observacion)??"",z.value=!0,await ie()}catch(r){const p=((n=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:n.message)??"No se pudo abrir el registro.";$(p)}},ce=async()=>{var s,t,a,l;if((s=i.value)!=null&&s.id){h.value=!0;try{const o=await S.patch(`/espera/${i.value.id}`,{observacion:y.value||null}),n=(t=o==null?void 0:o.data)==null?void 0:t.data;if(n){i.value=n,y.value=n.observacion??"";const r=x.value.findIndex(p=>p.id===n.id);r!==-1&&x.value.splice(r,1,{...x.value[r],...n})}B("Observación guardada"),V()}catch(o){const n=((l=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:l.message)??"No se pudo guardar la observación.";$(n)}finally{h.value=!1}}},ue=async s=>{var a,l;if(!(!(s!=null&&s.id)||!await he({title:"Reactivar lead",text:`¿Estás seguro que deseas reactivar el lead "${s.name}"? Esto lo moverá de vuelta al pipeline de leads.`,confirmText:"Sí, reactivar",cancelText:"Cancelar",icon:"question"}))){E.value.add(s.id);try{const o=await S.post(`/espera/${s.id}/reactivate`),n=x.value.findIndex(r=>r.id===s.id);n!==-1&&(x.value.splice(n,1),u.value.total=Math.max(0,u.value.total-1)),B("Lead reactivado exitosamente"),setTimeout(()=>{window.location.assign("/leads")},1500)}catch(o){console.error("Error reactivating lead:",o);const n=((l=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:l.message)??"No se pudo reactivar el lead";$(n)}finally{E.value.delete(s.id)}}};return ve(async()=>{console.log("WaitingLeadsList mounted - reactivation functionality loaded"),await k(1);const t=new URLSearchParams(window.location.search).get("open");if(t){await O(t);try{window.history.replaceState({},"","/espera")}catch{}}}),(s,t)=>(m(),v("div",ke,[e("div",we,[e("div",Ce,[t[6]||(t[6]=e("label",{class:"sr-only",for:"waitinglead-search"},"Buscar",-1)),e("div",Se,[t[5]||(t[5]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"h-4 w-4 text-slate-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M9 3a6 6 0 104.472 10.03l2.249 2.248a1 1 0 001.414-1.414l-2.248-2.249A6 6 0 009 3zm-4 6a4 4 0 118 0 4 4 0 01-8 0z","clip-rule":"evenodd"})])],-1)),M(e("input",{id:"waitinglead-search","onUpdate:modelValue":t[0]||(t[0]=a=>L.value=a),onKeyup:t[1]||(t[1]=me(a=>k(1),["enter"])),placeholder:"Buscar (nombre, contacto, empresa, documento, observación...)",class:"block w-full rounded-lg border border-slate-700 bg-slate-900/40 pl-9 pr-3 py-2 text-sm text-slate-100 placeholder:text-slate-400 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20"},null,544),[[P,L.value]])]),e("div",Ee,[u.value.total?(m(),v("span",Ie,"Mostrando "+d(le.value),1)):(m(),v("span",Re,"Sin resultados"))])]),e("div",Te,[e("input",{ref_key:"importInput",ref:I,type:"file",accept:".csv,text/csv",class:"hidden",onChange:re},null,544),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:R.value,onClick:ne},d(R.value?"Importando…":"Importar CSV"),9,$e),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:_.value||u.value.current_page<=1,onClick:t[2]||(t[2]=a=>k(u.value.current_page-1))}," Anterior ",8,Le),e("button",{type:"button",class:"px-3 py-2 text-sm font-medium rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800 disabled:opacity-50",disabled:_.value||u.value.current_page>=u.value.last_page,onClick:t[3]||(t[3]=a=>k(u.value.current_page+1))}," Siguiente ",8,ze),D(_e,{columns:N,"visible-keys":f(J),onToggle:f(Y),onReset:f(ee)},null,8,["visible-keys","onToggle","onReset"])])]),e("div",Ne,[e("div",{ref_key:"tableScrollRef",ref:te,class:"overflow-x-auto"},[e("table",{ref_key:"tableRef",ref:A,class:"min-w-full text-sm"},[e("colgroup",null,[(m(),v(W,null,G(N,a=>e("col",{key:a.key,style:H({display:f(Q)(a.key)?"":"none"})},null,4)),64))]),t[9]||(t[9]=e("thead",{class:"bg-slate-900/70 border-b border-slate-800"},[e("tr",{class:"text-left text-xs font-semibold text-slate-300 uppercase tracking-wider"},[e("th",{class:"px-4 py-3"},"Lead"),e("th",{class:"px-4 py-3"},"Empresa"),e("th",{class:"px-4 py-3"},"Documento"),e("th",{class:"px-4 py-3"},"Teléfono"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Fecha"),e("th",{class:"px-4 py-3"},"Acciones")])],-1)),e("tbody",Ve,[_.value?(m(),v("tr",De,[...t[7]||(t[7]=[e("td",{class:"px-4 py-6 text-slate-300",colspan:"7"},"Cargando zona de espera…",-1)])])):x.value.length===0?(m(),v("tr",Me,[...t[8]||(t[8]=[e("td",{class:"px-4 py-10 text-slate-300",colspan:"7"}," No hay leads en zona de espera. ",-1)])])):(m(!0),v(W,{key:2},G(x.value,a=>(m(),v("tr",{key:a.id,class:"text-slate-100"},[e("td",Fe,[e("div",Be,d(a.name||"—"),1),e("div",qe,d(a.contact_name||"—"),1),a.observacion?(m(),v("div",Ae,d(a.observacion),1)):F("",!0)]),e("td",Oe,d(a.company_name||"—"),1),e("td",je,[a.document_type||a.document_number?(m(),v("span",Ue,d(a.document_type||"")+" "+d(a.document_number||""),1)):(m(),v("span",Ke,"—"))]),e("td",Pe,d(a.contact_phone||"—"),1),e("td",We,[e("span",Ge,d(a.contact_email||"—"),1)]),e("td",He,d(de(a.created_at)),1),e("td",Xe,[e("div",Ze,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-700 bg-slate-900/40 px-3 py-2 text-xs font-medium text-slate-200 hover:bg-slate-800",onClick:l=>O(a.id)}," Ver ",8,Je),e("button",{type:"button",class:"inline-flex items-center rounded-lg bg-green-600 px-3 py-2 text-xs font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 disabled:opacity-60",disabled:E.value.has(a.id),onClick:l=>ue(a)},d(E.value.has(a.id)?"Reactivando...":"Reactivar"),9,Qe)])])]))),128))])],512)],512),M(e("div",{ref_key:"stickyScrollRef",ref:ae,class:"sticky bottom-0 z-20 mt-2 overflow-x-auto rounded-lg border border-slate-200 bg-white/95 dark:border-slate-700 dark:bg-slate-900/95"},[e("div",{style:H({width:`${f(se)}px`,height:"1px"})},null,4)],512),[[be,f(oe)]])]),D(Z,{name:"fade"},{default:X(()=>[z.value?(m(),v("div",Ye,[e("div",{class:"absolute inset-0 bg-black/50",onClick:V}),D(Z,{name:"pop"},{default:X(()=>{var a,l,o,n,r,p,g,w,C;return[e("div",et,[e("div",tt,[t[10]||(t[10]=e("div",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100"},"Zona de espera",-1)),e("div",at,[ge(d(((a=i.value)==null?void 0:a.name)||"—")+" ",1),(l=i.value)!=null&&l.company_name?(m(),v("span",st,"· "+d(i.value.company_name),1)):F("",!0)])]),e("div",ot,[e("div",lt,[e("div",null,[t[11]||(t[11]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Contacto",-1)),e("div",nt,d(((o=i.value)==null?void 0:o.contact_name)||"—"),1)]),e("div",null,[t[12]||(t[12]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Teléfono",-1)),e("div",rt,d(((n=i.value)==null?void 0:n.contact_phone)||"—"),1)]),e("div",null,[t[13]||(t[13]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Email",-1)),e("div",dt,d(((r=i.value)==null?void 0:r.contact_email)||"—"),1)]),e("div",null,[t[14]||(t[14]=e("div",{class:"text-xs font-medium text-gray-600 dark:text-slate-300"},"Documento",-1)),e("div",it,[(p=i.value)!=null&&p.document_type||(g=i.value)!=null&&g.document_number?(m(),v("span",ct,d(((w=i.value)==null?void 0:w.document_type)||"")+" "+d(((C=i.value)==null?void 0:C.document_number)||""),1)):(m(),v("span",ut,"—"))])])]),e("div",pt,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300"},"Observación",-1)),M(e("textarea",{ref_key:"observacionEl",ref:q,"onUpdate:modelValue":t[4]||(t[4]=T=>y.value=T),rows:"5",class:"mt-1 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-100",placeholder:"Escribe la observación..."},null,512),[[P,y.value]])])]),e("div",vt,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-4 focus:ring-blue-100 disabled:opacity-60 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:h.value,onClick:V}," Cerrar ",8,mt),e("button",{type:"button",class:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-60",disabled:h.value||!i.value,onClick:ce},d(h.value?"Guardando…":"Guardar"),9,bt)])])]}),_:1})])):F("",!0)]),_:1})]))}};export{wt as default};
