import{g as c,i as u,j as e,n as V,t as f,k,C,B as D,w as F,J as q,F as H,m as I,r as l,o as G,f as K,l as E,A as Z}from"./vendor-vue-Diyp6CFE.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={name:"NotificationSettings",data(){return{requesting:!1,testing:!1,notificationStatus:{supported:!1,permission:"default",serviceWorkerReady:!1},preferences:{calendar_notifications:!0,sound_enabled:!0,reminder_minutes:[15,5]},reminderOptions:[{value:5,label:"5 minutos antes"},{value:10,label:"10 minutos antes"},{value:15,label:"15 minutos antes"},{value:30,label:"30 minutos antes"},{value:60,label:"1 hora antes"},{value:120,label:"2 horas antes"}]}},async mounted(){await this.checkNotificationStatus(),await this.loadPreferences()},methods:{async checkNotificationStatus(){window.NotificationManager?this.notificationStatus=window.NotificationManager.getStatus():setTimeout(()=>{window.NotificationManager&&(this.notificationStatus=window.NotificationManager.getStatus())},1e3)},async requestPermission(){if(!window.NotificationManager){alert("Sistema de notificaciones no disponible");return}this.requesting=!0;try{const i=await window.NotificationManager.requestPermission();this.notificationStatus.permission=i,i==="granted"&&(this.preferences.calendar_notifications=!0,await this.updatePreferences())}catch(i){console.error("Error solicitando permisos:",i)}finally{this.requesting=!1}},async testNotification(){var i;this.testing=!0;try{window.NotificationManager&&await window.NotificationManager.showNotification("üß™ Notificaci√≥n de prueba","Si puedes ver esto, ¬°las notificaciones est√°n funcionando correctamente!",{tag:`test-notification-${Date.now()}`,renotify:!0,requireInteraction:!1}),await fetch("/api/notifications/test",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content")},body:JSON.stringify({title:"üß™ Notificaci√≥n de prueba",body:"Si puedes ver esto, ¬°las notificaciones est√°n funcionando correctamente!",type:"test"})})}catch(t){console.error("Error enviando notificaci√≥n de prueba:",t),alert("Error enviando notificaci√≥n de prueba")}finally{this.testing=!1}},async loadPreferences(){try{const t=await(await fetch("/api/notifications/preferences")).json(),v=localStorage.getItem("notification-sound-enabled");this.preferences={...t.preferences,sound_enabled:v!==null?v==="true":t.preferences.sound_enabled},console.log("Preferencias cargadas:",this.preferences)}catch(i){console.error("Error cargando preferencias:",i);const t=localStorage.getItem("notification-sound-enabled");t!==null&&(this.preferences.sound_enabled=t==="true")}},async updatePreferences(){var i;try{localStorage.setItem("notification-sound-enabled",this.preferences.sound_enabled.toString()),await fetch("/api/notifications/preferences",{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content")},body:JSON.stringify(this.preferences)}),window.NotificationManager&&window.NotificationManager.setSoundEnabled(this.preferences.sound_enabled),window.CalendarNotifications&&window.CalendarNotifications.setReminderTimes(this.preferences.reminder_minutes),console.log("Preferencias actualizadas:",this.preferences)}catch(t){console.error("Error actualizando preferencias:",t),localStorage.setItem("notification-sound-enabled",this.preferences.sound_enabled.toString())}},getPermissionText(){switch(this.notificationStatus.permission){case"granted":return"‚úÖ Permitido";case"denied":return"‚ùå Denegado";case"default":return"‚ö†Ô∏è Sin configurar";default:return"‚ùì Desconocido"}}}},W={class:"notification-settings-integrated"},Q={key:0,class:"text-center py-8"},Y={class:"flex items-center justify-center space-x-4 mb-4"},$=["disabled"],ee={key:0,class:"mr-2"},te={key:1,class:"space-y-6"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},se={class:"rounded-lg border border-slate-200 dark:border-slate-800 p-4 bg-slate-50 dark:bg-slate-950/50"},re={class:"flex items-center justify-between"},oe={class:"relative inline-flex items-center cursor-pointer"},ne={class:"rounded-lg border border-slate-200 dark:border-slate-800 p-4 bg-slate-50 dark:bg-slate-950/50"},ie={class:"flex items-center justify-between"},le=["disabled"],de={key:0,class:"mr-2"},ce={class:"rounded-lg border border-slate-200 dark:border-slate-800 p-4 bg-slate-50 dark:bg-slate-950/50"},ue={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},fe=["id","value"],ge=["for"];function me(i,t,v,h,r,n){return u(),c("div",W,[r.notificationStatus.permission!=="granted"?(u(),c("div",Q,[t[7]||(t[7]=e("div",{class:"mb-4"},[e("div",{class:"mx-auto w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center"}," üîî ")],-1)),t[8]||(t[8]=e("h4",{class:"text-lg font-medium text-gray-900 dark:text-slate-100 mb-2"}," Activa las notificaciones ",-1)),t[9]||(t[9]=e("p",{class:"text-sm text-gray-500 dark:text-slate-400 mb-4"}," Recibe alertas de tus eventos del calendario directamente en tu dispositivo ",-1)),e("div",Y,[e("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r.notificationStatus.supported?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"])},f(r.notificationStatus.supported?"‚úÖ Soportado":"‚ùå No soportado"),3),e("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r.notificationStatus.permission==="granted"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":r.notificationStatus.permission==="denied"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"])},f(n.getPermissionText()),3)]),e("button",{onClick:t[0]||(t[0]=(...o)=>n.requestPermission&&n.requestPermission(...o)),disabled:r.requesting||!r.notificationStatus.supported,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:ring-offset-slate-900"},[r.requesting?(u(),c("span",ee,[...t[6]||(t[6]=[e("svg",{class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):k("",!0),C(" "+f(r.requesting?"Solicitando...":"Activar Notificaciones"),1)],8,$)])):(u(),c("div",te,[t[16]||(t[16]=D('<div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4" data-v-76d02dd9><div class="flex" data-v-76d02dd9><div class="flex-shrink-0" data-v-76d02dd9><svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20" data-v-76d02dd9><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" data-v-76d02dd9></path></svg></div><div class="ml-3" data-v-76d02dd9><h3 class="text-sm font-medium text-green-800 dark:text-green-200" data-v-76d02dd9> ¬°Notificaciones activadas! </h3><div class="mt-1 text-sm text-green-700 dark:text-green-300" data-v-76d02dd9> Recibir√°s alertas de tus eventos del calendario. </div></div></div></div>',1)),e("div",ae,[e("div",se,[e("div",re,[t[11]||(t[11]=e("div",{class:"flex items-center"},[e("span",{class:"text-2xl mr-3"},"üîä"),e("div",null,[e("label",{class:"text-sm font-medium text-gray-900 dark:text-slate-100"}," Sonido de notificaci√≥n "),e("p",{class:"text-xs text-gray-500 dark:text-slate-400"}," Reproducir sonido cuando lleguen notificaciones ")])],-1)),e("label",oe,[F(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=o=>r.preferences.sound_enabled=o),onChange:t[2]||(t[2]=(...o)=>n.updatePreferences&&n.updatePreferences(...o)),class:"sr-only peer"},null,544),[[q,r.preferences.sound_enabled]]),t[10]||(t[10]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])])]),e("div",ne,[e("div",ie,[t[13]||(t[13]=e("div",{class:"flex items-center"},[e("span",{class:"text-2xl mr-3"},"üß™"),e("div",null,[e("label",{class:"text-sm font-medium text-gray-900 dark:text-slate-100"}," Probar notificaci√≥n "),e("p",{class:"text-xs text-gray-500 dark:text-slate-400"}," Enviar una notificaci√≥n de prueba ")])],-1)),e("button",{onClick:t[3]||(t[3]=(...o)=>n.testNotification&&n.testNotification(...o)),disabled:r.testing,class:"inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-slate-700 text-sm font-medium rounded-md text-gray-700 dark:text-slate-200 bg-white dark:bg-slate-900 hover:bg-gray-50 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:ring-offset-slate-900 disabled:opacity-50"},[r.testing?(u(),c("span",de,[...t[12]||(t[12]=[e("svg",{class:"animate-spin h-3 w-3",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):k("",!0),C(" "+f(r.testing?"Enviando...":"Probar"),1)],8,le)])])]),e("div",ce,[t[14]||(t[14]=e("div",{class:"flex items-center mb-4"},[e("span",{class:"text-2xl mr-3"},"‚è∞"),e("div",null,[e("label",{class:"text-sm font-medium text-gray-900 dark:text-slate-100"}," Recordatorios por defecto "),e("p",{class:"text-xs text-gray-500 dark:text-slate-400"}," Cu√°ndo recibir notificaciones si el evento no tiene recordatorio espec√≠fico ")])],-1)),e("div",ue,[(u(!0),c(H,null,I(r.reminderOptions,o=>(u(),c("div",{key:o.value,class:"flex items-center"},[F(e("input",{id:`reminder-${o.value}`,type:"checkbox",value:o.value,"onUpdate:modelValue":t[4]||(t[4]=g=>r.preferences.reminder_minutes=g),onChange:t[5]||(t[5]=(...g)=>n.updatePreferences&&n.updatePreferences(...g)),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-slate-600 dark:bg-slate-700 rounded"},null,40,fe),[[q,r.preferences.reminder_minutes]]),e("label",{for:`reminder-${o.value}`,class:"ml-2 text-sm text-gray-700 dark:text-slate-300"},f(o.label),9,ge)]))),128))]),t[15]||(t[15]=e("div",{class:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md"},[e("p",{class:"text-xs text-blue-800 dark:text-blue-200"},[e("strong",null,"Nota:"),C(" Si un evento tiene su propio recordatorio configurado, se usar√° ese tiempo en lugar de estos valores por defecto. ")])],-1))])]))])}const pe=J(X,[["render",me],["__scopeId","data-v-76d02dd9"]]),be={class:"max-w-3xl mx-auto"},ve={class:"bg-white dark:bg-slate-900 shadow sm:rounded-lg p-6"},xe={key:0,class:"mb-4 text-sm text-green-600"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ke={class:"rounded-lg border border-slate-200/60 dark:border-slate-800 p-4"},ye={class:"mt-4"},we=["src"],_e={class:"mt-2 text-xs text-slate-500 break-all"},Se={key:0,class:"text-sm text-red-600"},Ne={class:"rounded-lg border border-slate-200/60 dark:border-slate-800 p-4"},Pe={class:"mt-4"},Ce=["src"],Re={class:"mt-2 text-xs text-slate-500 break-all"},Le={key:0,class:"text-sm text-red-600"},Me={class:"bg-white dark:bg-slate-900 shadow sm:rounded-lg p-6 mt-6"},Ve={__name:"SettingsView",setup(i){const t=l(""),v=l(""),h=l(""),r=l("/images/logo_alta_calidad.png"),n=l("/images/logo_alta_calidad.png"),o=l(r.value),g=l(n.value),m=l(""),p=l(""),y=l(null),w=l(null),_=l(""),S=l("");G(async()=>{try{const s=await fetch("/configuracion/logo-paths");if(s.ok){const a=await s.json();a.mark&&(r.value=a.mark),a.full&&(n.value=a.full||n.value),o.value=r.value,g.value=n.value}}catch{}}),K(()=>{m.value&&URL.revokeObjectURL(m.value),p.value&&URL.revokeObjectURL(p.value)});const A=s=>{var d,x;v.value="";const a=(x=(d=s==null?void 0:s.target)==null?void 0:d.files)==null?void 0:x[0];if(_.value=(a==null?void 0:a.name)??"",!a){o.value=r.value;return}m.value&&URL.revokeObjectURL(m.value),m.value=URL.createObjectURL(a),o.value=m.value},T=s=>{var d,x;h.value="";const a=(x=(d=s==null?void 0:s.target)==null?void 0:d.files)==null?void 0:x[0];if(S.value=(a==null?void 0:a.name)??"",!a){g.value=n.value;return}p.value&&URL.revokeObjectURL(p.value),p.value=URL.createObjectURL(a),g.value=p.value},R=async({endpoint:s,inputRef:a,setError:d,onSuccess:x})=>{var M,U;d(""),t.value="";const N=a.value;if(!N||!N.files||N.files.length===0){d("Selecciona una imagen.");return}const L=new FormData;L.append("logo",N.files[0]);try{const O=((M=document.querySelector('meta[name="csrf-token"]'))==null?void 0:M.getAttribute("content"))??"",P=await fetch(s,{method:"POST",headers:{"X-CSRF-TOKEN":O,Accept:"application/json"},body:L});if(P.ok){const b=await P.json().catch(()=>null);t.value=(b==null?void 0:b.message)??"Actualizado correctamente.",x(b);return}if(P.status===422){const b=await P.json().catch(()=>null),j=b!=null&&b.errors?(U=Object.values(b.errors).flat())==null?void 0:U[0]:null;d(j??"La imagen no es v√°lida.");return}d("Error al subir imagen.")}catch{d("Error de conexi√≥n.")}},z=async()=>{await R({endpoint:"/configuracion/logo-mark",inputRef:y,setError:s=>v.value=s,onSuccess:s=>{r.value=((s==null?void 0:s.path)??"/storage/settings/logo_mark.png")+"?ts="+Date.now(),o.value=r.value,m.value&&(URL.revokeObjectURL(m.value),m.value=""),window.__APP_LOGO_MARK__=(s==null?void 0:s.path)??"/storage/settings/logo_mark.png",_.value="",y.value&&(y.value.value="")}})},B=async()=>{await R({endpoint:"/configuracion/logo-full",inputRef:w,setError:s=>h.value=s,onSuccess:s=>{n.value=((s==null?void 0:s.path)??"/storage/settings/logo_full.png")+"?ts="+Date.now(),g.value=n.value,p.value&&(URL.revokeObjectURL(p.value),p.value=""),window.__APP_LOGO_FULL__=(s==null?void 0:s.path)??"/storage/settings/logo_full.png",S.value="",w.value&&(w.value.value="")}})};return(s,a)=>(u(),c("div",be,[e("div",ve,[a[10]||(a[10]=e("h2",{class:"text-lg font-semibold mb-4"},"Personalizaci√≥n",-1)),t.value?(u(),c("div",xe,f(t.value),1)):k("",!0),e("div",he,[e("section",ke,[a[2]||(a[2]=e("h3",{class:"font-medium"},"√çcono (logo puro)",-1)),a[3]||(a[3]=e("p",{class:"text-sm text-slate-500"},"Se usa en el login y en el men√∫ contra√≠do.",-1)),a[4]||(a[4]=e("p",{class:"mt-1 text-xs text-slate-500"}," Recomendado: PNG con fondo transparente, 256√ó256 (m√≠n. 128√ó128). Se mostrar√° aprox. a 56√ó56 en el men√∫ y 56√ó56 en login. ",-1)),e("div",ye,[e("img",{src:o.value,alt:"√çcono actual",class:"w-28 h-28 object-contain rounded-md border bg-white p-2"},null,8,we)]),e("form",{onSubmit:E(z,["prevent"]),class:"mt-4"},[e("input",{id:"file-logo-mark",type:"file",ref_key:"fileMark",ref:y,accept:"image/*",class:"sr-only",onChange:A},null,544),a[0]||(a[0]=e("label",{for:"file-logo-mark",class:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-white/90 dark:bg-slate-950 text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-900 cursor-pointer"},[e("svg",{class:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{d:"M3 4a2 2 0 0 1 2-2h6a1 1 0 1 1 0 2H5v12h10V9a1 1 0 1 1 2 0v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4Z"}),e("path",{d:"M14 2a1 1 0 0 1 1 1v2h2a1 1 0 1 1 0 2h-2v2a1 1 0 1 1-2 0V7h-2a1 1 0 1 1 0-2h2V3a1 1 0 0 1 1-1Z"})]),e("span",null,"Seleccionar archivo")],-1)),e("p",_e,f(_.value?_.value:"Ning√∫n archivo seleccionado"),1),v.value?(u(),c("div",Se,f(v.value),1)):k("",!0),a[1]||(a[1]=e("div",{class:"mt-4"},[e("button",{type:"submit",class:"inline-flex items-center justify-center px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 disabled:opacity-60"}," Subir √≠cono ")],-1))],32)]),e("section",Ne,[a[7]||(a[7]=e("h3",{class:"font-medium"},"Logo grande (√≠cono + nombre)",-1)),a[8]||(a[8]=e("p",{class:"text-sm text-slate-500"},"Se usa en el men√∫ expandido.",-1)),a[9]||(a[9]=e("p",{class:"mt-1 text-xs text-slate-500"}," Recomendado: PNG transparente, proporci√≥n 4:1 (ej. 640√ó160 o 800√ó200). Se mostrar√° aprox. a 224√ó56 en el men√∫. ",-1)),e("div",Pe,[e("img",{src:g.value,alt:"Logo grande actual",class:"w-full h-24 object-contain rounded-md border bg-white p-2"},null,8,Ce)]),e("form",{onSubmit:E(B,["prevent"]),class:"mt-4"},[e("input",{id:"file-logo-full",type:"file",ref_key:"fileFull",ref:w,accept:"image/*",class:"sr-only",onChange:T},null,544),a[5]||(a[5]=e("label",{for:"file-logo-full",class:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-white/90 dark:bg-slate-950 text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-900 cursor-pointer"},[e("svg",{class:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{d:"M3 4a2 2 0 0 1 2-2h6a1 1 0 1 1 0 2H5v12h10V9a1 1 0 1 1 2 0v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4Z"}),e("path",{d:"M14 2a1 1 0 0 1 1 1v2h2a1 1 0 1 1 0 2h-2v2a1 1 0 1 1-2 0V7h-2a1 1 0 1 1 0-2h2V3a1 1 0 0 1 1-1Z"})]),e("span",null,"Seleccionar archivo")],-1)),e("p",Re,f(S.value?S.value:"Ning√∫n archivo seleccionado"),1),h.value?(u(),c("div",Le,f(h.value),1)):k("",!0),a[6]||(a[6]=e("div",{class:"mt-4"},[e("button",{type:"submit",class:"inline-flex items-center justify-center px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 disabled:opacity-60"}," Subir logo grande ")],-1))],32)])])]),e("div",Me,[a[11]||(a[11]=e("div",{class:"border-l-4 border-blue-600 pl-4 mb-6"},[e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100"},"üîî Notificaciones"),e("p",{class:"text-sm text-gray-600 dark:text-slate-300"},"Configura las notificaciones del calendario y recordatorios")],-1)),Z(pe)])]))}};export{Ve as default};
