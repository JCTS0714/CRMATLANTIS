import{r as c,I as M,g as u,i as p,j as t,w as V,s as q,t as o,F as z,l as B}from"./vendor-vue-DArGLcBM.js";import{a as y}from"./vendor-utils-Czy7fllw.js";import{a as I,t as S,p as L,c as N}from"./App-B11a4pqF.js";import"./app-C29UHuqU.js";import"./vendor-ui-CyZqwBXe.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"p-4"},A={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},O={class:"w-full sm:max-w-md"},U={class:"flex items-center gap-3"},R=["disabled"],G={class:"text-sm text-slate-600 dark:text-slate-300"},H={key:0},J={key:1},K={class:"mt-4 overflow-x-auto rounded-lg border border-slate-200 bg-white dark:border-slate-800 dark:bg-slate-900"},Q={class:"min-w-full text-left text-sm text-slate-700 dark:text-slate-200"},W={class:"px-4 py-3 font-medium text-slate-900 dark:text-slate-100"},X={class:"px-4 py-3"},Y={class:"px-4 py-3"},Z={class:"px-4 py-3"},ee={key:0},te={key:1},ae={class:"px-4 py-3"},se={class:"px-4 py-3"},le={class:"px-4 py-3"},oe={class:"flex items-center gap-2"},re=["href"],de=["disabled","onClick"],ne=["disabled","onClick"],ie={class:"mt-4 flex items-center justify-between"},ce=["disabled"],ue={class:"text-sm text-slate-600 dark:text-slate-300"},pe=["disabled"],fe={__name:"CustomersTable",setup(me){const x=c([]),_=c(!1),k=c(new Set),w=c(new Set),h=c(null),v=c(!1),f=c("");let C=null;const l=c({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),b=async(e=1)=>{_.value=!0;try{const{data:s}=await y.get("/customers/data",{params:{q:f.value||"",per_page:l.value.per_page,page:e}});x.value=s.customers||[],l.value={...l.value,...s.pagination||{}}}finally{_.value=!1}},E=()=>{var e,s;(s=(e=h.value)==null?void 0:e.click)==null||s.call(e)},j=async e=>{var a,n,d,r,i;const s=(n=(a=e==null?void 0:e.target)==null?void 0:a.files)==null?void 0:n[0];if(s){v.value=!0;try{const m=new FormData;m.append("csv",s);const{data:g}=await y.post("/customers/import",m,{headers:{"Content-Type":"multipart/form-data"}});I(((d=g==null?void 0:g.output)!=null&&d.trim(),"Importación finalizada")),await b(1)}catch(m){const g=((i=(r=m==null?void 0:m.response)==null?void 0:r.data)==null?void 0:i.message)??"No se pudo importar el CSV.";S(g)}finally{v.value=!1,h.value&&(h.value.value="")}}},$=e=>{const s=(e==null?void 0:e.document_number)||(e==null?void 0:e.name)||"",a=new URL(window.location.origin+"/leads/list");return s&&a.searchParams.set("q",s),a.pathname+a.search},D=async e=>{var a,n,d;if(!(e!=null&&e.id))return;const s=await L(e);if(s){k.value.add(e.id);try{const r=await y.put(`/customers/${e.id}`,s),i=(a=r==null?void 0:r.data)==null?void 0:a.data;i&&typeof i=="object"?Object.assign(e,i):Object.assign(e,s),I("Cliente actualizado")}catch(r){const i=((d=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:d.message)??"No se pudo actualizar el cliente.";S(i)}finally{k.value.delete(e.id)}}},F=async e=>{var a,n;if(!(!(e!=null&&e.id)||!await N({title:"Eliminar cliente",text:"Se eliminará el cliente. Los leads asociados quedarán sin cliente (se desvinculan).",confirmText:"Eliminar",cancelText:"Cancelar",icon:"warning"}))){w.value.add(e.id);try{await y.delete(`/customers/${e.id}`),x.value=x.value.filter(d=>d.id!==e.id),I("Cliente eliminado"),b(Math.min(l.value.current_page,l.value.last_page||1))}catch(d){const r=((n=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:n.message)??"No se pudo eliminar el cliente.";S(r)}finally{w.value.delete(e.id)}}},T=e=>{const s=Math.max(1,Math.min(l.value.last_page||1,e));b(s)};return M(f,()=>{C&&clearTimeout(C),C=setTimeout(()=>{b(1)},300)},{flush:"post"}),b(1),(e,s)=>(p(),u("div",P,[t("div",A,[t("div",O,[V(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>f.value=a),type:"text",class:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:border-sky-500 focus:ring-sky-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100",placeholder:"Buscar cliente (nombre, contacto, empresa, documento…)"},null,512),[[q,f.value]])]),t("div",U,[t("input",{ref_key:"importInput",ref:h,type:"file",accept:".csv,text/csv",class:"hidden",onChange:j},null,544),t("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-60 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:v.value,onClick:E},o(v.value?"Importando…":"Importar CSV"),9,R),t("div",G,[l.value.total?(p(),u("span",H,"Mostrando "+o(l.value.from)+"–"+o(l.value.to)+" de "+o(l.value.total),1)):(p(),u("span",J,"Sin resultados"))])])]),t("div",K,[t("table",Q,[s[3]||(s[3]=t("thead",{class:"bg-slate-50 text-xs uppercase text-slate-600 dark:bg-slate-800 dark:text-slate-200"},[t("tr",null,[t("th",{class:"px-4 py-3"},"Cliente"),t("th",{class:"px-4 py-3"},"Contacto"),t("th",{class:"px-4 py-3"},"Empresa"),t("th",{class:"px-4 py-3"},"Documento"),t("th",{class:"px-4 py-3"},"Teléfono"),t("th",{class:"px-4 py-3"},"Email"),t("th",{class:"px-4 py-3"},"Acciones")])],-1)),t("tbody",null,[(p(!0),u(z,null,B(x.value,a=>(p(),u("tr",{key:a.id,class:"border-t border-slate-200 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800"},[t("td",W,o(a.name),1),t("td",X,o(a.contact_name||"—"),1),t("td",Y,o(a.company_name||"—"),1),t("td",Z,[a.document_type||a.document_number?(p(),u("span",ee,o(a.document_type||"")+" "+o(a.document_number||""),1)):(p(),u("span",te,"—"))]),t("td",ae,o(a.contact_phone||"—"),1),t("td",se,o(a.contact_email||"—"),1),t("td",le,[t("div",oe,[t("a",{class:"inline-flex items-center rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",href:$(a)}," Ver leads ",8,re),t("button",{type:"button",class:"inline-flex items-center rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-60 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:k.value.has(a.id),onClick:n=>D(a)}," Editar ",8,de),t("button",{type:"button",class:"inline-flex items-center rounded-lg border border-red-200 bg-white px-3 py-1.5 text-xs font-medium text-red-700 hover:bg-red-50 disabled:opacity-60 dark:border-red-900/40 dark:bg-slate-900 dark:text-red-300 dark:hover:bg-red-950/30",disabled:w.value.has(a.id),onClick:n=>F(a)}," Eliminar ",8,ne)])])]))),128))])])]),t("div",ie,[t("button",{class:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:l.value.current_page<=1||_.value,onClick:s[1]||(s[1]=a=>T(l.value.current_page-1))}," Anterior ",8,ce),t("div",ue," Página "+o(l.value.current_page)+" / "+o(l.value.last_page),1),t("button",{class:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:l.value.current_page>=l.value.last_page||_.value,onClick:s[2]||(s[2]=a=>T(l.value.current_page+1))}," Siguiente ",8,pe)])]))}};export{fe as default};
