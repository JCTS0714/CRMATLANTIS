import{_ as xe}from"./app-BDRZbfW-.js";import{e as M,g as m,i as f,k as S,j as e,H as j,t as $,n as ie,q as ye,D as A,w as se,A as R,u as k,F as N,m as te,s as be,C as D,v as ke,r as E,I as me,x as ve,y as he,o as we,l as $e,z as pe,G as Ce}from"./vendor-vue-Diyp6CFE.js";import{a as H}from"./vendor-utils-Czy7fllw.js";import{S as X}from"./vendor-ui-BsDgRXDF.js";import{_ as J,c as Se,g as Be,a as Ae}from"./BaseModal-Coysbt3i.js";import{u as Pe,a as _e,_ as Te}from"./App-DAC6HJ3v.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-slate-900 dark:border-slate-800"},De={key:0,class:"p-4 border-b border-gray-200 dark:border-slate-800"},Ie={class:"flex items-center justify-between"},je={class:"text-sm font-semibold text-gray-900 dark:text-slate-100"},ze={key:0,class:"mt-1 text-xs text-gray-600 dark:text-slate-300"},Fe={key:1,class:"p-4 border-t border-gray-200 dark:border-slate-800"},Re={__name:"BaseCard",props:{title:{type:String,default:""},subtitle:{type:String,default:""},padding:{type:Boolean,default:!0},noPadding:{type:Boolean,default:!1}},setup(a){const t=a,l=M(()=>t.noPadding||!t.padding?"":"p-4");return(n,i)=>(f(),m("div",Ee,[n.$slots.header||a.title?(f(),m("div",De,[j(n.$slots,"header",{},()=>[e("div",Ie,[e("div",null,[e("h3",je,$(a.title),1),a.subtitle?(f(),m("p",ze,$(a.subtitle),1)):S("",!0)]),j(n.$slots,"headerActions")])])])):S("",!0),e("div",{class:ie(l.value)},[j(n.$slots,"default")],2),n.$slots.footer?(f(),m("div",Fe,[j(n.$slots,"footer")])):S("",!0)]))}},Me={class:"flex items-center justify-between"},Ue={class:"text-sm font-semibold text-gray-900 dark:text-slate-100"},qe={key:0,class:"mt-1 text-xs text-gray-600 dark:text-slate-300"},Ve={class:"flex items-center gap-3"},Oe={key:0,class:"text-xs text-gray-600 dark:text-slate-300"},Le={key:0,class:"p-4 border-b border-gray-200 dark:border-slate-800"},Qe={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Ge={key:0,class:"flex-1"},Ke=["for"],He=["id","value","placeholder"],Je={class:"flex items-center gap-2"},We=["value"],Xe=["value"],Ne={key:0,class:"mt-4"},Ye={key:1,class:"p-4 border-b border-red-200 bg-red-50 dark:border-red-900/40 dark:bg-red-950/30"},Ze={class:"text-sm text-red-700 dark:text-red-200"},et={class:"text-xs uppercase bg-gray-50 text-gray-700 dark:bg-slate-800 dark:text-slate-200"},tt={class:"flex items-center gap-2"},at=["onClick"],st={key:0},rt=["colspan"],ot={key:1},lt=["colspan"],nt={key:2,class:"p-4 border-t border-gray-200 dark:border-slate-800"},it={class:"flex items-center justify-between gap-3"},ct={class:"text-xs text-gray-600 dark:text-slate-300"},dt={__name:"GenericTable",props:{tableId:{type:String,default:()=>`table-${Date.now()}`},title:{type:String,required:!0},subtitle:{type:String,default:""},columns:{type:Array,required:!0,validator:a=>a.every(t=>t.key&&t.label)},items:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:()=>({current_page:1,last_page:1,total:0,from:null,to:null})},showPagination:{type:Boolean,default:!0},paginationInfo:{type:String,default:""},searchable:{type:Boolean,default:!0},searchQuery:{type:String,default:""},searchPlaceholder:{type:String,default:"Buscar..."},sortable:{type:Boolean,default:!1},showFilters:{type:Boolean,default:!0},showPerPageSelector:{type:Boolean,default:!0},perPage:{type:Number,default:25},perPageOptions:{type:Array,default:()=>[10,15,25,50]},tableClass:{type:String,default:""},emptyMessage:{type:String,default:"No hay datos para mostrar"},rowKey:{type:[String,Function],default:"id"}},emits:["search","sort","page-change","per-page-change"],setup(a){const t=a,l=M(()=>!t.loading&&t.items.length===0),{tableRef:n,visibleKeys:i,isColumnVisible:c,toggleColumn:b,resetColumns:I}=Pe({tableId:t.tableId,columns:M(()=>t.columns)}),{tableScrollRef:U,stickyScrollRef:L,stickyScrollWidth:Q,showStickyXScroll:B}=_e({tableRef:n}),P=(h,p)=>typeof t.rowKey=="function"?t.rowKey(h,p):h[t.rowKey]||p;return(h,p)=>(f(),ye(Re,{title:a.title,subtitle:a.subtitle,"no-padding":""},{header:A(()=>[e("div",Me,[e("div",null,[e("h3",Ue,$(a.title),1),a.paginationInfo?(f(),m("p",qe,$(a.paginationInfo),1)):S("",!0)]),e("div",Ve,[j(h.$slots,"headerActions"),a.loading?(f(),m("div",Oe,"Cargando…")):S("",!0)])])]),default:A(()=>[a.showFilters?(f(),m("div",Le,[e("div",Qe,[a.searchable?(f(),m("div",Ge,[e("label",{class:"sr-only",for:`${a.tableId}-search`},"Buscar",8,Ke),e("input",{id:`${a.tableId}-search`,value:a.searchQuery,type:"search",placeholder:a.searchPlaceholder,class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500",onInput:p[0]||(p[0]=d=>h.$emit("search",d.target.value))},null,40,He)])):S("",!0),e("div",Je,[j(h.$slots,"filters"),R(Te,{columns:a.columns,"visible-keys":k(i),onToggle:k(b),onReset:k(I)},null,8,["columns","visible-keys","onToggle","onReset"]),a.showPerPageSelector?(f(),m("select",{key:0,value:a.perPage,class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100",onChange:p[1]||(p[1]=d=>h.$emit("per-page-change",Number(d.target.value)))},[(f(!0),m(N,null,te(a.perPageOptions,d=>(f(),m("option",{key:d,value:d},$(d),9,Xe))),128))],40,We)):S("",!0)])]),h.$slots.secondaryFilters?(f(),m("div",Ne,[j(h.$slots,"secondaryFilters")])):S("",!0)])):S("",!0),a.error?(f(),m("div",Ye,[e("div",Ze,$(a.error),1)])):S("",!0),e("div",{ref_key:"tableScrollRef",ref:U,class:"overflow-x-auto"},[e("table",{ref_key:"tableRef",ref:n,class:ie(["w-full text-sm text-left text-gray-700 dark:text-slate-200",a.tableClass])},[e("colgroup",null,[(f(!0),m(N,null,te(a.columns,d=>(f(),m("col",{key:d.key,style:be({display:k(c)(d.key)?"":"none"})},null,4))),128))]),e("thead",et,[e("tr",null,[(f(!0),m(N,null,te(a.columns,d=>(f(),m("th",{key:d.key,class:ie(["px-4 py-3",d.headerClass])},[e("div",tt,[D($(d.label)+" ",1),d.sortable&&a.sortable?(f(),m("button",{key:0,type:"button",class:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-300",onClick:z=>h.$emit("sort",d.key)},[...p[4]||(p[4]=[e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M5 12l5 5 5-5H5z"})],-1)])],8,at)):S("",!0)])],2))),128))])]),e("tbody",null,[(f(!0),m(N,null,te(a.items,(d,z)=>j(h.$slots,"row",{key:P(d,z),item:d,index:z,columns:a.columns})),128)),l.value?(f(),m("tr",st,[e("td",{colspan:a.columns.length,class:"px-4 py-10 text-center text-sm text-gray-600 dark:text-slate-300"},[j(h.$slots,"empty",{},()=>[D($(a.emptyMessage),1)])],8,rt)])):S("",!0),a.loading&&a.items.length===0?(f(),m("tr",ot,[e("td",{colspan:a.columns.length,class:"px-4 py-10 text-center text-sm text-gray-600 dark:text-slate-300"},[...p[5]||(p[5]=[e("div",{class:"flex items-center justify-center gap-2"},[e("svg",{class:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),D(" Cargando… ")],-1)])],8,lt)])):S("",!0)])],2)],512),se(e("div",{ref_key:"stickyScrollRef",ref:L,class:"sticky bottom-0 z-20 mt-2 overflow-x-auto rounded-lg border border-slate-200 bg-white/95 dark:border-slate-700 dark:bg-slate-900/95"},[e("div",{style:be({width:`${k(Q)}px`,height:"1px"})},null,4)],512),[[ke,k(B)]]),a.showPagination&&a.pagination&&a.pagination.last_page>1?(f(),m("div",nt,[e("div",it,[R(J,{variant:"secondary",size:"sm",disabled:a.loading||a.pagination.current_page<=1,onClick:p[2]||(p[2]=d=>h.$emit("page-change",a.pagination.current_page-1))},{default:A(()=>[...p[6]||(p[6]=[D(" Anterior ",-1)])]),_:1},8,["disabled"]),e("div",ct,[j(h.$slots,"paginationInfo",{},()=>[D(" Página "+$(a.pagination.current_page)+" / "+$(a.pagination.last_page),1)])]),R(J,{variant:"secondary",size:"sm",disabled:a.loading||a.pagination.current_page>=a.pagination.last_page,onClick:p[3]||(p[3]=d=>h.$emit("page-change",a.pagination.current_page+1))},{default:A(()=>[...p[7]||(p[7]=[D(" Siguiente ",-1)])]),_:1},8,["disabled"])])])):S("",!0)]),_:3},8,["title","subtitle"]))}},ut={__name:"BaseBadge",props:{variant:{type:String,default:"secondary",validator:a=>["primary","secondary","success","warning","danger","info"].includes(a)},size:{type:String,default:"sm",validator:a=>["xs","sm","md"].includes(a)},rounded:{type:Boolean,default:!1}},setup(a){const t=a,l=M(()=>{const n={xs:"px-1.5 py-0.5 text-xs",sm:"px-2 py-1 text-xs",md:"px-2.5 py-1.5 text-sm"};return Se("inline-flex items-center font-medium",t.rounded?"rounded-full":"rounded-md",n[t.size],Be("badge",t.variant))});return(n,i)=>(f(),m("span",{class:ie(l.value)},[j(n.$slots,"default")],2))}};function ft(a={}){const{endpoint:t,columns:l=[],defaultFilters:n={},actions:i={},defaultPerPage:c=25,searchDebounce:b=300,transformData:I=null,onError:U=null}=a,L=E(!1),Q=E(null),B=E([]),P=E([]),h=me({current_page:1,last_page:1,per_page:c,total:0,from:null,to:null}),p=me({q:"",page:1,per_page:c,sort_by:null,sort_direction:"asc",...n}),d=me({sortColumn:null,sortDirection:"asc",searchQuery:"",processing:new Set}),z=M(()=>B.value.length>0),C=M(()=>!L.value&&B.value.length===0),Y=M(()=>h.total||0),ae=M(()=>{if(!h.total)return"";const r=h.from||0,u=h.to||0,F=h.total||0;return`${r}-${u} de ${F}`}),Z=M(()=>P.value.length>0),q=M(()=>z.value&&B.value.every(r=>P.value.includes(r.id))),W=async(r={})=>{var u,F,K;if(!t){console.error("useGenericTable: endpoint is required");return}L.value=!0,Q.value=null;try{const T={...p,...r},w=await H.get(t,{params:T});let v=((u=w.data)==null?void 0:u.data)||w.data;I&&typeof I=="function"&&(v=I(v)),B.value=(v==null?void 0:v.items)||v||[],v!=null&&v.pagination&&Object.assign(h,v.pagination)}catch(T){const w=((K=(F=T.response)==null?void 0:F.data)==null?void 0:K.message)||"Error al cargar los datos";Q.value=w,U&&typeof U=="function"?U(T,w):console.error("Table fetch error:",T)}finally{L.value=!1}},V=async(r={})=>{Object.assign(p,r),await W()},ce=async r=>{await V({page:r})},y=async r=>{await V({per_page:r,page:1})},O=async r=>{d.searchQuery=r,await V({q:r,page:1})},G=async r=>{let u="asc";d.sortColumn===r&&(u=d.sortDirection==="asc"?"desc":"asc"),d.sortColumn=r,d.sortDirection=u,await V({sort_by:r,sort_direction:u,page:1})},de=async()=>{await W()},ue=async()=>{Object.assign(p,{q:"",page:1,per_page:c,sort_by:null,sort_direction:"asc",...n}),d.sortColumn=null,d.sortDirection="asc",d.searchQuery="",await W()},re=r=>{P.value.includes(r)||P.value.push(r)},ee=r=>{const u=P.value.indexOf(r);u>-1&&P.value.splice(u,1)},oe=r=>{P.value.includes(r)?ee(r):re(r)},le=()=>{P.value=B.value.map(r=>r.id)},ne=()=>{P.value=[]},fe=()=>{q.value?ne():le()},o=async(r,u,F=null)=>{var K,T;if(!i[r])return console.error(`Action '${r}' is not defined`),!1;d.processing.add(u);try{const w=await i[r](u,F);if(r==="delete"){const v=B.value.findIndex(ge=>ge.id===u);v>-1&&B.value.splice(v,1),ee(u)}else if(w!=null&&w.data){const v=B.value.findIndex(ge=>ge.id===u);v>-1&&(B.value[v]={...B.value[v],...w.data})}return w}catch(w){const v=((T=(K=w.response)==null?void 0:K.data)==null?void 0:T.message)||`Error en acción ${r}`;throw Q.value=v,w}finally{d.processing.delete(u)}},s=async(r,u,F=null)=>{const K=[],T=[];for(const w of u)try{const v=await o(r,w,F);K.push({id:w,result:v})}catch(v){T.push({id:w,error:v})}return T.length>0&&console.error("Bulk action errors:",T),{results:K,errors:T}},g=r=>d.processing.has(r);let _;const x=r=>{clearTimeout(_),_=setTimeout(()=>{O(r)},b)};return ve(()=>d.searchQuery,(r,u)=>{r!==u&&x(r)}),{loading:L,error:Q,items:B,pagination:h,filters:p,tableState:d,selectedItems:P,hasData:z,isEmpty:C,totalCount:Y,paginationInfo:ae,hasSelectedItems:Z,allItemsSelected:q,fetchData:W,applyFilters:V,changePage:ce,changePerPage:y,handleSearch:O,handleSort:G,refresh:de,reset:ue,selectItem:re,unselectItem:ee,toggleSelection:oe,selectAll:le,unselectAll:ne,toggleSelectAll:fe,performAction:o,bulkAction:s,isProcessing:g,debouncedSearch:x}}class gt{constructor(t){this.baseEndpoint=t}async create(t){try{const l=t instanceof FormData?{headers:{"Content-Type":"multipart/form-data"}}:{};return(await H.post(this.baseEndpoint,t,l)).data}catch(l){throw l}}async update(t,l){var n;try{const i=l instanceof FormData?{headers:{"Content-Type":"multipart/form-data"}}:{};try{return(await H.put(`${this.baseEndpoint}/${t}`,l,i)).data}catch(c){const b=(n=c==null?void 0:c.response)==null?void 0:n.status;if(b===404||b===405)return(await H.patch(`${this.baseEndpoint}/${t}`,l,i)).data;throw c}}catch(i){throw i}}async delete(t){try{return(await H.delete(`${this.baseEndpoint}/${t}`)).data}catch(l){throw l}}async archive(t){try{return(await H.patch(`${this.baseEndpoint}/${t}/archive`)).data}catch(l){throw l}}async restore(t){try{return(await H.patch(`${this.baseEndpoint}/${t}/restore`)).data}catch(l){throw l}}getSweetAlertTheme(){return document.documentElement.classList.contains("dark")?{background:"#0f172a",color:"#f1f5f9",confirmButtonColor:"#ef4444",cancelButtonColor:"#64748b"}:{background:"#ffffff",color:"#1e293b",confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280"}}async confirmDelete(t,l=null){const n=l||`Se eliminará permanentemente "${t}"`,i=this.getSweetAlertTheme();return(await X.fire({title:"¿Eliminar elemento?",text:n,icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:i.confirmButtonColor,cancelButtonColor:i.cancelButtonColor,background:i.background,color:i.color,reverseButtons:!0})).isConfirmed}async confirmArchive(t,l=null){const n=l||`Se archivará "${t}"`,i=this.getSweetAlertTheme();return(await X.fire({title:"¿Archivar elemento?",text:n,icon:"question",showCancelButton:!0,confirmButtonText:"Sí, archivar",cancelButtonText:"Cancelar",confirmButtonColor:"#f59e0b",cancelButtonColor:i.cancelButtonColor,background:i.background,color:i.color,reverseButtons:!0})).isConfirmed}async confirmBulkAction(t,l){const n=this.getSweetAlertTheme(),c={delete:{title:"¿Eliminar elementos?",text:`Se eliminarán ${l} elementos permanentemente`,confirmText:"Sí, eliminar todos",color:"#ef4444"},archive:{title:"¿Archivar elementos?",text:`Se archivarán ${l} elementos`,confirmText:"Sí, archivar todos",color:"#f59e0b"}}[t];return c?(await X.fire({title:c.title,text:c.text,icon:"warning",showCancelButton:!0,confirmButtonText:c.confirmText,cancelButtonText:"Cancelar",confirmButtonColor:c.color,cancelButtonColor:n.cancelButtonColor,background:n.background,color:n.color,reverseButtons:!0})).isConfirmed:!1}showSuccess(t,l="¡Éxito!"){const n=this.getSweetAlertTheme();X.fire({title:l,text:t,icon:"success",timer:2e3,showConfirmButton:!1,background:n.background,color:n.color})}showError(t,l="Error"){const n=this.getSweetAlertTheme();X.fire({title:l,text:t,icon:"error",background:n.background,color:n.color})}async bulkDelete(t){try{const l=t.map(b=>this.delete(b)),n=await Promise.allSettled(l),i=n.filter(b=>b.status==="fulfilled").length,c=n.filter(b=>b.status==="rejected").length;return c===0?this.showSuccess(`${i} elementos eliminados correctamente`):this.showError(`${i} elementos eliminados, ${c} fallaron`),{successful:i,failed:c}}catch(l){throw l}}async bulkArchive(t){try{const l=t.map(b=>this.archive(b)),n=await Promise.allSettled(l),i=n.filter(b=>b.status==="fulfilled").length,c=n.filter(b=>b.status==="rejected").length;return c===0?this.showSuccess(`${i} elementos archivados correctamente`):this.showError(`${i} elementos archivados, ${c} fallaron`),{successful:i,failed:c}}catch(l){throw l}}}function mt(a){return new gt(a)}function pt(a){const t=mt(a);return{actions:t,performAction:async(i,c,b=null,I="")=>{switch(i){case"delete":return await t.confirmDelete(I)?(await t.delete(c),t.showSuccess("Elemento eliminado correctamente"),!0):!1;case"archive":return await t.confirmArchive(I)?(await t.archive(c),t.showSuccess("Elemento archivado correctamente"),!0):!1;case"update":return await t.update(c,b),t.showSuccess("Elemento actualizado correctamente"),!0;case"create":const U=await t.create(b);return t.showSuccess("Elemento creado correctamente"),U;default:throw new Error(`Action '${i}' not supported`)}},performBulkAction:async(i,c)=>{if(!c.length||!await t.confirmBulkAction(i,c.length))return!1;switch(i){case"delete":return await t.bulkDelete(c);case"archive":return await t.bulkArchive(c);default:throw new Error(`Bulk action '${i}' not supported`)}}}}const yt={class:"border-b border-gray-100 bg-white hover:bg-blue-50/40 transition-colors dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800/60"},bt={class:"px-4 py-3 font-medium text-gray-900 dark:text-slate-100"},ht={class:"px-4 py-3"},vt={class:"flex items-center gap-3"},xt={class:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center dark:bg-blue-900"},kt={class:"text-sm font-medium text-blue-600 dark:text-blue-300"},wt={class:"font-medium text-gray-900 dark:text-slate-100"},$t={class:"text-sm text-gray-500 dark:text-slate-400"},Ct={class:"px-4 py-3"},St={class:"flex flex-wrap gap-1"},Bt={class:"px-4 py-3 text-sm text-gray-500 dark:text-slate-400"},At={class:"px-4 py-3"},Pt={class:"flex items-center gap-2"},_t={class:"py-2"},Tt={class:"grid grid-cols-1 gap-5"},Et={class:"space-y-5"},Dt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},It=["value"],jt={class:"space-y-3"},zt={class:"flex items-center gap-4"},Ft={class:"w-16 h-16 rounded-full overflow-hidden bg-gray-100 dark:bg-slate-800 flex items-center justify-center"},Rt=["src"],Mt={key:1,class:"text-sm text-gray-500 dark:text-slate-400"},Ut={class:"flex-1"},qt={key:0,class:"space-y-3"},Vt={class:"flex items-center justify-between pt-4"},Ot={class:"flex items-center gap-3"},Lt={class:"flex items-center justify-center"},Qt={key:0,class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Yt={__name:"UsersTable",setup(a){const t=[{key:"id",label:"ID",sortable:!0},{key:"name",label:"Usuario",sortable:!0},{key:"roles",label:"Roles"},{key:"created_at",label:"Creado",sortable:!0},{key:"actions",label:"Acciones"}],{loading:l,error:n,items:i,pagination:c,filters:b,tableState:I,paginationInfo:U,fetchData:L,changePage:Q,changePerPage:B,handleSearch:P,handleSort:h,isProcessing:p,refresh:d}=ft({endpoint:"/users/data",defaultFilters:{},actions:{},defaultPerPage:25}),{performAction:z}=pt("/users"),C=E(null),Y=E(!1),ae=E(!1),Z=E(null),q=E(["employee"]),W=(()=>{if(typeof window>"u")return!1;const o=window.location.hostname;return o==="localhost"||o==="127.0.0.1"||o==="::1"})();let V=null;const ce=async()=>W?(V||(V=xe(()=>import("./customerModalAutofill.local-CpHl0RE-.js"),[]).catch(()=>null)),V):null,y=E({name:"",email:"",role:"employee",password:""}),O=E(null),G=E(null),de=o=>o?new Date(o).toLocaleString("es-ES"):"",ue=o=>{var _,x;const g=(Array.isArray(o==null?void 0:o.roles)?(_=o.roles[0])==null?void 0:_.name:null)||(o==null?void 0:o.role)||"employee";C.value=o,y.value={name:o.name,email:o.email,role:g,password:""},G.value=o.profile_photo_url||o.profile_photo_path||null,O.value=null,(x=Z.value)==null||x.open()},re=async o=>{await z("delete",o.id,null,o.name)&&d()},ee=async()=>{var o,s,g,_;Y.value=!0;try{const x=y.value.role||"employee";let r=null;if(O.value){const u=new FormData;u.append("name",y.value.name),u.append("email",y.value.email),u.append("role",x),C.value||(u.append("password",y.value.password),u.append("password_confirmation",y.value.password)),u.append("photo",O.value),r=u}else r={...y.value},r.role=x,!C.value&&y.value.password&&(r.password_confirmation=y.value.password);C.value?await z("update",C.value.id,r):await z("create",null,r),oe(),d()}catch(x){console.error("Error saving user:",x);const r=((s=(o=x==null?void 0:x.response)==null?void 0:o.data)==null?void 0:s.message)||"No se pudo guardar el usuario.",u=(_=(g=x==null?void 0:x.response)==null?void 0:g.data)==null?void 0:_.errors;if(u&&typeof u=="object"){const F=Object.values(u).flat().filter(Boolean).join("<br>");X.fire({title:"Validación fallida",html:F||r,icon:"error"})}else X.fire({title:"Error",text:r,icon:"error"})}finally{Y.value=!1}},oe=()=>{var o;C.value=null,y.value={name:"",email:"",role:"employee",password:""},O.value=null,G.value=null,(o=Z.value)==null||o.close(),he(()=>{ae.value=!1})};ve(()=>ae.value,o=>{o&&(y.value={name:"",email:"",role:"employee",password:""},C.value=null,O.value=null,G.value=null,he(()=>{var s;(s=Z.value)==null||s.open()}))});const le=o=>{const s=o.target.files&&o.target.files[0];if(!s)return;O.value=s;const g=new FileReader;g.onload=_=>{G.value=_.target.result},g.readAsDataURL(s)},ne=async()=>{var s;if(C.value)return;const o=await ce();(s=o==null?void 0:o.autofillUserCreateForm)==null||s.call(o,y,q.value)},fe=async()=>{try{const{data:o}=await H.get("/users/role-options"),s=Array.isArray(o==null?void 0:o.data)?o.data.filter(Boolean):[];q.value=s.length>0?s:["employee"],q.value.includes(y.value.role)||(y.value.role=q.value[0])}catch{q.value=["employee"]}};return we(async()=>{await fe(),await L()}),(o,s)=>(f(),m(N,null,[R(dt,{"table-id":"users-table",title:"Usuarios",columns:t,items:k(i),loading:k(l),error:k(n),pagination:k(c),"pagination-info":k(U),"search-query":k(I).searchQuery,"search-placeholder":"Buscar por nombre o email","per-page":k(b).per_page,"per-page-options":[10,25,50,100],sortable:"",onSearch:k(P),onSort:k(h),onPageChange:k(Q),onPerPageChange:k(B)},{headerActions:A(()=>[R(J,{variant:"primary",onClick:s[0]||(s[0]=g=>ae.value=!0)},{default:A(()=>[...s[5]||(s[5]=[D(" Crear Usuario ",-1)])]),_:1})]),row:A(({item:g})=>{var _;return[e("tr",yt,[e("td",bt,$(g.id),1),e("td",ht,[e("div",vt,[e("div",xt,[e("span",kt,$((_=g.name)==null?void 0:_.charAt(0).toUpperCase()),1)]),e("div",null,[e("div",wt,$(g.name),1),e("div",$t,$(g.email),1)])])]),e("td",Ct,[e("div",St,[(f(!0),m(N,null,te(g.roles,x=>(f(),ye(ut,{key:x.id,variant:"primary",size:"xs",rounded:""},{default:A(()=>[D($(x.name),1)]),_:2},1024))),128))])]),e("td",Bt,$(de(g.created_at)),1),e("td",At,[e("div",Pt,[R(J,{variant:"ghost",size:"sm",loading:k(p)(g.id),onClick:x=>ue(g)},{default:A(()=>[...s[6]||(s[6]=[D(" Editar ",-1)])]),_:1},8,["loading","onClick"]),R(J,{variant:"ghost",size:"sm",loading:k(p)(g.id),onClick:x=>re(g)},{default:A(()=>[...s[7]||(s[7]=[D(" Eliminar ",-1)])]),_:1},8,["loading","onClick"])])])])]}),_:1},8,["items","loading","error","pagination","pagination-info","search-query","per-page","onSearch","onSort","onPageChange","onPerPageChange"]),R(Ae,{ref_key:"userModal",ref:Z,title:C.value?"Editar Usuario":"Crear Usuario",subtitle:C.value?`Modificar datos de ${C.value.name}`:"Agregar nuevo usuario al sistema","max-width":"xl","close-on-backdrop":""},{footer:A(()=>[e("div",Vt,[s[20]||(s[20]=e("div",{class:"text-xs text-gray-500 dark:text-slate-400"}," * Campos obligatorios ",-1)),e("div",Ot,[!C.value&&k(W)?(f(),ye(J,{key:0,variant:"secondary",size:"sm",onClick:ne},{default:A(()=>[...s[17]||(s[17]=[D(" Rellenar test ",-1)])]),_:1})):S("",!0),R(J,{variant:"secondary",size:"sm",onClick:oe},{default:A(()=>[...s[18]||(s[18]=[D(" Cancelar ",-1)])]),_:1}),R(J,{variant:"primary",size:"sm",loading:Y.value,disabled:!y.value.name||!y.value.email||!C.value&&!y.value.password,onClick:ee},{default:A(()=>[e("div",Lt,[Y.value?S("",!0):(f(),m("svg",Qt,[...s[19]||(s[19]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),e("span",null,$(C.value?"Actualizar":"Crear"),1)])]),_:1},8,["loading","disabled"])])])]),default:A(()=>[e("div",_t,[e("form",{onSubmit:$e(ee,["prevent"])},[e("div",Tt,[e("div",Et,[s[16]||(s[16]=e("div",{class:"border-b border-gray-200 dark:border-slate-700 pb-3"},[e("h4",{class:"text-base font-semibold text-gray-900 dark:text-slate-100"},"Información Personal"),e("p",{class:"text-sm text-gray-600 dark:text-slate-400"},"Datos básicos del usuario")],-1)),e("div",Dt,[e("div",null,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"}," Nombre completo * ",-1)),se(e("input",{"onUpdate:modelValue":s[1]||(s[1]=g=>y.value.name=g),type:"text",required:"",placeholder:"Ej: Juan Carlos Pérez",class:"block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-sm shadow-sm transition-colors focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 dark:placeholder:text-slate-400 dark:focus:border-blue-500 dark:focus:ring-blue-500/20"},null,512),[[pe,y.value.name]])]),e("div",null,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"}," Correo electrónico * ",-1)),se(e("input",{"onUpdate:modelValue":s[2]||(s[2]=g=>y.value.email=g),type:"email",required:"",placeholder:"usuario@empresa.com",class:"block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-sm shadow-sm transition-colors focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 dark:placeholder:text-slate-400 dark:focus:border-blue-500 dark:focus:ring-blue-500/20"},null,512),[[pe,y.value.email]])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"}," Rol * ",-1)),se(e("select",{"onUpdate:modelValue":s[3]||(s[3]=g=>y.value.role=g),class:"block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-sm shadow-sm transition-colors focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 dark:focus:border-blue-500 dark:focus:ring-blue-500/20"},[(f(!0),m(N,null,te(q.value,g=>(f(),m("option",{key:g,value:g},$(g),9,It))),128))],512),[[Ce,y.value.role]])])]),e("div",jt,[s[12]||(s[12]=e("div",{class:"border-b border-gray-200 dark:border-slate-700 pb-3"},[e("h4",{class:"text-base font-semibold text-gray-900 dark:text-slate-100"},"Foto de perfil"),e("p",{class:"text-sm text-gray-600 dark:text-slate-400"},"Sube una foto para el usuario (opcional)")],-1)),e("div",zt,[e("div",Ft,[G.value?(f(),m("img",{key:0,src:G.value,alt:"Preview",class:"w-full h-full object-cover"},null,8,Rt)):(f(),m("div",Mt,"Sin foto"))]),e("div",Ut,[e("input",{type:"file",accept:"image/*",onChange:le,class:"block w-full text-sm text-gray-500 file:bg-white file:border file:rounded file:px-3 file:py-1 file:mr-3 file:border-gray-300 file:text-sm file:cursor-pointer dark:file:bg-slate-800"},null,32),s[11]||(s[11]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-slate-400"},"Formatos: JPG, PNG. Tamaño recomendado: 300x300px",-1))])])]),C.value?S("",!0):(f(),m("div",qt,[s[15]||(s[15]=e("div",{class:"border-b border-gray-200 dark:border-slate-700 pb-3"},[e("h4",{class:"text-base font-semibold text-gray-900 dark:text-slate-100"},"Configuración de Acceso"),e("p",{class:"text-sm text-gray-600 dark:text-slate-400"},"Contraseña para el nuevo usuario")],-1)),e("div",null,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"}," Contraseña * ",-1)),se(e("input",{"onUpdate:modelValue":s[4]||(s[4]=g=>y.value.password=g),type:"password",required:"",placeholder:"Mínimo 8 caracteres",class:"block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-sm shadow-sm transition-colors focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 dark:placeholder:text-slate-400 dark:focus:border-blue-500 dark:focus:ring-blue-500/20"},null,512),[[pe,y.value.password]]),s[14]||(s[14]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-slate-400"}," La contraseña debe tener al menos 8 caracteres ",-1))])]))])])],32)])]),_:1},8,["title","subtitle"])],64))}};export{Yt as default};
