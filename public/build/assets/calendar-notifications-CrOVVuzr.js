import"./notifications-Dl6xZJx9.js";class d{constructor(){this.events=new Map,this.reminders=new Map,this.defaultReminderTimes=[15,5]}async init(){const e=window.NotificationManager.getStatus();return e.supported?e.permission!=="granted"&&await window.NotificationManager.requestPermission()!=="granted"?(console.warn("Usuario denegÃ³ permisos de notificaciÃ³n"),!1):!0:(console.warn("Notificaciones no soportadas en este navegador"),!1)}scheduleReminders(e){this.cancelReminders(e.id);const i=new Date(e.start_datetime),t=new Date;this.defaultReminderTimes.forEach(n=>{const o=new Date(i.getTime()-n*60*1e3);if(o>t){const a=setTimeout(()=>{this.showEventReminder(e,n)},o.getTime()-t.getTime()),s=`${e.id}-${n}`;this.reminders.set(s,a)}else{const a=i.toLocaleString(),s=t.toLocaleString();console.warn(`âš ï¸  El evento "${e.title}" (${a}) ya pasÃ³ o estÃ¡ muy cerca (ahora: ${s}). Recordatorio no programado.`)}}),this.events.set(e.id,e)}showEventReminder(e,i){const t=`ðŸ“… Recordatorio: ${e.title}`;let n="";i>0?n=`Comienza en ${i} minutos`:n="Comienza ahora",e.description&&(n+=`
ðŸ“ ${e.description}`);const o={tag:`calendar-${e.id}-${i}`,icon:"/favicon.ico",badge:"/favicon.ico",requireInteraction:!0,url:`/calendar?event=${e.id}`,data:{type:"calendar",eventId:e.id,minutesBefore:i,url:`/calendar?event=${e.id}`},vibrate:[200,100,200,100,200]};return window.NotificationManager?window.NotificationManager.showNotification(t,n,o):(console.error("NotificationManager no disponible para mostrar recordatorio"),!1)}cancelReminders(e){this.defaultReminderTimes.forEach(i=>{const t=`${e}-${i}`,n=this.reminders.get(t);n&&(clearTimeout(n),this.reminders.delete(t),console.log(`Recordatorio cancelado para evento ${e} (${i} min)`))})}scheduleMultipleReminders(e){e.forEach(i=>{this.scheduleReminders(i)})}clearAllReminders(){this.reminders.forEach((e,i)=>{clearTimeout(e)}),this.reminders.clear(),this.events.clear(),console.log("Todos los recordatorios cancelados")}setReminderTimes(e){this.defaultReminderTimes=e}getScheduledEvents(){return Array.from(this.events.values())}getActiveReminders(){return Array.from(this.reminders.keys())}}window.CalendarNotifications=new d;window.scheduleCalendarReminder=r=>window.CalendarNotifications.scheduleReminders(r);window.cancelCalendarReminder=r=>window.CalendarNotifications.cancelReminders(r);document.addEventListener("DOMContentLoaded",async()=>{await window.CalendarNotifications.init()});
