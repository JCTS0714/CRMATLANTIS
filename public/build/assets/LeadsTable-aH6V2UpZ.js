import{a as R}from"./vendor-utils-Czy7fllw.js";import{S as O}from"./vendor-ui-DEm6YKEA.js";import{g as u,i as p,j as e,t as o,n as M,z as U,F as G,m as H,r as w,G as z,e as _,H as K,o as Q,B as A,k as T,u as b,q as X}from"./vendor-vue-Db-AqoDh.js";const Y={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Z={class:"flex-1"},ee=["value"],te={class:"flex items-center gap-2"},ae=["disabled"],se=["value"],oe={class:"mb-4 overflow-x-auto"},re={class:"inline-flex rounded-lg border border-gray-200 bg-white p-1 shadow-sm dark:border-slate-800 dark:bg-slate-900"},ne={class:"ml-2 rounded bg-black/5 px-2 py-0.5 text-xs font-semibold text-gray-700 dark:bg-white/10 dark:text-slate-200"},le=["onClick"],de={class:"ml-2 rounded bg-black/5 px-2 py-0.5 text-xs font-semibold text-gray-700 dark:bg-white/10 dark:text-slate-200"},ie={__name:"LeadsTableFilters",props:{modelValue:{type:String,required:!0},stages:{type:Array,required:!0},activeStageId:{type:[Number,null],default:null},totalCount:{type:Number,default:0},perPage:{type:Number,default:25},importing:{type:Boolean,default:!1}},emits:["update:modelValue","update:per-page","stage-filter","import-file"],setup(t){return(n,a)=>(p(),u("section",null,[e("div",Y,[e("div",Z,[a[5]||(a[5]=e("label",{class:"sr-only",for:"leads-search"},"Buscar",-1)),e("input",{id:"leads-search",value:t.modelValue,type:"search",placeholder:"Buscar por nombre, empresa, contacto, email, teléfono, documento…",class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:placeholder:text-slate-500",onInput:a[0]||(a[0]=s=>n.$emit("update:modelValue",s.target.value))},null,40,ee)]),e("div",te,[e("input",{ref:"importInput",type:"file",accept:".csv,text/csv",class:"hidden",onChange:a[1]||(a[1]=s=>n.$emit("import-file",s))},null,544),e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:t.importing,onClick:a[2]||(a[2]=s=>n.$refs.importInput.click())},o(t.importing?"Importando…":"Importar CSV"),9,ae),e("select",{value:t.perPage,class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100",onChange:a[3]||(a[3]=s=>n.$emit("update:per-page",Number(s.target.value)))},[...a[6]||(a[6]=[e("option",{value:10},"10",-1),e("option",{value:15},"15",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1)])],40,se)])]),e("div",oe,[e("div",re,[e("button",{type:"button",class:M(["px-3 py-2 text-sm font-medium rounded-md transition",t.activeStageId===null?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-50 dark:text-slate-200 dark:hover:bg-slate-800"]),onClick:a[4]||(a[4]=s=>n.$emit("stage-filter",null))},[a[7]||(a[7]=U(" Todos ",-1)),e("span",ne,o(t.totalCount),1)],2),(p(!0),u(G,null,H(t.stages,s=>(p(),u("button",{key:s.id,type:"button",class:M(["px-3 py-2 text-sm font-medium rounded-md transition",t.activeStageId===s.id?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-50 dark:text-slate-200 dark:hover:bg-slate-800"]),onClick:f=>n.$emit("stage-filter",s.id)},[U(o(s.name)+" ",1),e("span",de,o(s.count??0),1)],10,le))),128))])])]))}},ce={class:"border-b border-gray-100 bg-white hover:bg-blue-50/40 transition-colors dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800/60"},pe={class:"px-4 py-3 font-medium text-gray-900 dark:text-slate-100"},ue={class:"px-4 py-3"},ge={class:"px-4 py-3 text-right"},me={class:"px-4 py-3"},be={class:"px-4 py-3"},ye={class:"px-4 py-3"},xe={class:"px-4 py-3"},he={class:"px-4 py-3"},fe={class:"px-4 py-3"},ve={class:"px-4 py-3"},ke={class:"px-4 py-3"},$e={class:"px-4 py-3"},we={class:"px-4 py-3"},_e={class:"px-4 py-3"},Pe={class:"px-4 py-3"},Ce={class:"px-4 py-3"},De={__name:"LeadsTableRow",props:{lead:{type:Object,required:!0}},setup(t){const n=(s,f="EUR")=>s?new Intl.NumberFormat("es-ES",{style:"currency",currency:f||"EUR"}).format(s):"",a=s=>s?new Date(s).toLocaleString("es-ES"):"";return(s,f)=>(p(),u("tr",ce,[e("td",pe,o(t.lead.id),1),e("td",ue,o(t.lead.name??""),1),e("td",ge,o(n(t.lead.amount,t.lead.currency)),1),e("td",me,o(t.lead.currency??""),1),e("td",be,o(t.lead.contact_name??""),1),e("td",ye,o(t.lead.contact_phone??""),1),e("td",xe,o(t.lead.contact_email??""),1),e("td",he,o(t.lead.company_name??""),1),e("td",fe,o(t.lead.company_address??""),1),e("td",ve,o(t.lead.document_type??""),1),e("td",ke,o(t.lead.document_number??""),1),e("td",$e,o(t.lead.customer_id??""),1),e("td",we,o(t.lead.created_by??""),1),e("td",_e,o(a(t.lead.won_at)),1),e("td",Pe,o(a(t.lead.created_at)),1),e("td",Ce,o(a(t.lead.updated_at)),1)]))}},Se={class:"p-4 flex items-center justify-between gap-3"},Ie=["disabled"],Te={class:"text-xs text-gray-600 dark:text-slate-300"},Ee=["disabled"],Fe={__name:"LeadsTablePagination",props:{pagination:{type:Object,required:!0,default:()=>({current_page:1,last_page:1})},loading:{type:Boolean,default:!1}},emits:["page-change"],setup(t){return(n,a)=>(p(),u("div",Se,[e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:t.loading||t.pagination.current_page<=1,onClick:a[0]||(a[0]=s=>n.$emit("page-change",t.pagination.current_page-1))}," Anterior ",8,Ie),e("div",Te," Página "+o(t.pagination.current_page)+" / "+o(t.pagination.last_page),1),e("button",{type:"button",class:"inline-flex items-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",disabled:t.loading||t.pagination.current_page>=t.pagination.last_page,onClick:a[1]||(a[1]=s=>n.$emit("page-change",t.pagination.current_page+1))}," Siguiente ",8,Ee)]))}};function Ve(t={}){const{endpoint:n,defaultPerPage:a=25,defaultFilters:s={},searchDebounce:f=300}=t,x=w(!1),C=w(null),v=w([]),D=w([]),y=z({current_page:1,last_page:1,per_page:a,total:0,from:null,to:null}),P=z({q:"",page:1,per_page:a,...s}),E=_(()=>v.value.length>0),F=_(()=>!x.value&&v.value.length===0),V=_(()=>y.total||0),S=_(()=>{if(!y.total)return"";const r=y.from||0,$=y.to||0,g=y.total||0;return`${r}-${$} de ${g}`}),h=async(r={})=>{var $,g,L;if(!n){console.error("useTableData: endpoint is required");return}x.value=!0,C.value=null;try{const l={...P,...r},m=await R.get(n,{params:l}),d=(($=m.data)==null?void 0:$.data)||m.data;v.value=(d==null?void 0:d.items)||(d==null?void 0:d.leads)||[],d!=null&&d.stages&&(D.value=d.stages),d!=null&&d.pagination&&Object.assign(y,d.pagination)}catch(l){C.value=((L=(g=l.response)==null?void 0:g.data)==null?void 0:L.message)||"Error al cargar los datos",console.error("useTableData fetch error:",l)}finally{x.value=!1}},k=async(r={})=>{Object.assign(P,r),await h()},q=async r=>{await k({page:r})},N=async r=>{await k({per_page:r,page:1})},I=async r=>{await k({q:r,page:1})},j=async()=>{await h()},B=async()=>{Object.assign(P,{q:"",page:1,per_page:a,...s}),await h()};let i;return{loading:x,error:C,items:v,stagesData:D,pagination:y,filters:P,hasData:E,isEmpty:F,totalCount:V,paginationInfo:S,fetchData:h,applyFilters:k,changePage:q,changePerPage:N,search:I,debouncedSearch:r=>{clearTimeout(i),i=setTimeout(()=>{I(r)},f)},refresh:j,reset:B}}const qe={key:0,class:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700 dark:border-red-900/40 dark:bg-red-950/30 dark:text-red-200"},Ne={class:"bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-slate-900 dark:border-slate-800"},je={class:"p-4 border-b border-gray-200 dark:border-slate-800 flex items-center justify-between"},Be={class:"mt-1 text-xs text-gray-600 dark:text-slate-300"},Le={key:0},Oe={key:0,class:"text-xs text-gray-600 dark:text-slate-300"},Me={class:"overflow-x-auto"},Ue={class:"min-w-[1400px] w-full text-sm text-left text-gray-700 dark:text-slate-200"},ze={key:0},He={__name:"LeadsTable",setup(t){const{loading:n,error:a,items:s,stagesData:f,pagination:x,isEmpty:C,paginationInfo:v,fetchData:D,applyFilters:y,changePage:P,changePerPage:E,debouncedSearch:F}=Ve({endpoint:"/leads/data",defaultPerPage:25}),V=_(()=>f.value||[]),S=w(!1),h=w(""),k=w(null),q=_(()=>x.per_page),N=_(()=>x.total||0);K(h,i=>{F(i)});const I=i=>{E(i)},j=i=>{k.value=i,y({stage_id:i,page:1})},B=async i=>{var r,$;const c=i.target.files[0];if(c){S.value=!0;try{const g=new FormData;g.append("file",c);const l=(await R.post("/leads/import/prospectos",g,{headers:{"Content-Type":"multipart/form-data"}})).data,m=(l==null?void 0:l.data)??{},d=(l==null?void 0:l.processed)??(m.created||0)+(m.updated||0)+(m.skipped||0)+(m.invalid||0),W=(l==null?void 0:l.imported)??(m.created||0)+(m.updated||0),J=(l==null?void 0:l.errors)??(m.invalid||0);O.fire({title:"¡Importación completada!",html:`
        <div class="text-left">
          <p><strong>Procesados:</strong> ${d}</p>
          <p><strong>Importados:</strong> ${W}</p>
          <p><strong>Errores:</strong> ${J}</p>
        </div>
      `,icon:"success"}),await D()}catch(g){console.error(g),O.fire({title:"Error en la importación",text:(($=(r=g.response)==null?void 0:r.data)==null?void 0:$.message)||"Error desconocido",icon:"error"})}finally{S.value=!1,i.target.value=""}}};return Q(async()=>{await D()}),(i,c)=>(p(),u("section",null,[A(ie,{modelValue:h.value,"onUpdate:modelValue":c[0]||(c[0]=r=>h.value=r),stages:V.value,"active-stage-id":k.value,"total-count":N.value,"per-page":q.value,importing:S.value,"onUpdate:perPage":I,onStageFilter:j,onImportFile:B},null,8,["modelValue","stages","active-stage-id","total-count","per-page","importing"]),b(a)?(p(),u("div",qe,o(b(a)),1)):T("",!0),e("div",Ne,[e("div",je,[e("div",null,[c[1]||(c[1]=e("div",{class:"text-sm font-semibold text-gray-900 dark:text-slate-100"},"Leads",-1)),e("div",Be,[b(v)?(p(),u("span",Le,o(b(v)),1)):T("",!0)])]),b(n)?(p(),u("div",Oe,"Cargando…")):T("",!0)]),e("div",Me,[e("table",Ue,[c[3]||(c[3]=e("thead",{class:"text-xs uppercase bg-gray-50 text-gray-700 dark:bg-slate-800 dark:text-slate-200"},[e("tr",null,[e("th",{class:"px-4 py-3"},"ID"),e("th",{class:"px-4 py-3"},"Nombre"),e("th",{class:"px-4 py-3 text-right"},"Monto"),e("th",{class:"px-4 py-3"},"Moneda"),e("th",{class:"px-4 py-3"},"Contacto"),e("th",{class:"px-4 py-3"},"Teléfono"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Empresa"),e("th",{class:"px-4 py-3"},"Dirección"),e("th",{class:"px-4 py-3"},"Doc. tipo"),e("th",{class:"px-4 py-3"},"Doc. nro"),e("th",{class:"px-4 py-3"},"Customer ID"),e("th",{class:"px-4 py-3"},"Creado por"),e("th",{class:"px-4 py-3"},"Won at"),e("th",{class:"px-4 py-3"},"Creado"),e("th",{class:"px-4 py-3"},"Actualizado")])],-1)),e("tbody",null,[(p(!0),u(G,null,H(b(s),r=>(p(),X(De,{key:r.id,lead:r},null,8,["lead"]))),128)),b(C)?(p(),u("tr",ze,[...c[2]||(c[2]=[e("td",{colspan:"16",class:"px-4 py-10 text-center text-sm text-gray-600 dark:text-slate-300"}," Sin leads. ",-1)])])):T("",!0)])])]),A(Fe,{pagination:b(x),loading:b(n),onPageChange:b(P)},null,8,["pagination","loading","onPageChange"])])]))}};export{He as default};
