[{"file": "docs\\2025-12-25-notas.md", "start": 0, "end": 600, "text": "# CRM ATLANTIS — Notas de trabajo (2025-12-25)\n\n> Actualización: el estado actual consolidado está en `docs/2025-12-26-notas.md`.\n\n## Objetivo del día\n- Dejar el proyecto corriendo en navegador con autenticación.\n- Montar el dashboard en Vue (Blade como shell) con Tailwind v4 + Flowbite.\n- Implementar el primer módulo real: **Usuarios** (CRUD + modales + buscador/paginación server-side).\n- Mejoras de UX: animaciones de modales, footer sticky, modo oscuro/claro.\n\n## Stack actual\n- Backend: Laravel 12 + MySQL (XAMPP)\n- Auth: Laravel Breeze (Blade)\n- Frontend: Vue 3 + Vite 7\n- UI: Tailwind CSS v4"}, {"file": "docs\\2025-12-25-notas.md", "start": 480, "end": 1080, "text": "al\n- Backend: Laravel 12 + MySQL (XAMPP)\n- Auth: Laravel Breeze (Blade)\n- Frontend: Vue 3 + Vite 7\n- UI: Tailwind CSS v4 + Flowbite\n\n## Arquitectura (por qué “funciona” sin una API separada)\n- Laravel sirve las vistas Blade como contenedor (wrapper) y los assets de Vite.\n- Vue se monta dentro del contenedor (div `#app`) y navega por rutas tipo `/dashboard` y `/users`.\n- Los datos se consumen vía endpoints JSON **en el mismo backend** (rutas internas protegidas por `auth`).\n\n## Rutas\n- `GET /` redirige a `login` o `dashboard` según sesión.\n- `GET /dashboard` (auth) muestra el wrapper del dashbo"}, {"file": "docs\\2025-12-25-notas.md", "start": 960, "end": 1560, "text": "# Rutas\n- `GET /` redirige a `login` o `dashboard` según sesión.\n- `GET /dashboard` (auth) muestra el wrapper del dashboard.\n- `GET /users` (auth) también muestra el mismo wrapper (Vue decide qué módulo renderizar por `window.location.pathname`).\n- Endpoints JSON de usuarios (auth):\n  - `GET /users/data` lista con paginación/búsqueda.\n  - `POST /users` crea.\n  - `PUT /users/{user}` actualiza.\n  - `DELETE /users/{user}` elimina.\n\nArchivos:\n- routes/web.php\n- app/Http/Controllers/UserController.php\n\n## Base de datos\n- Configurada para MySQL (XAMPP) con la base `crmatlantis`.\n- Se corrieron migra"}, {"file": "docs\\2025-12-25-notas.md", "start": 1440, "end": 2040, "text": "rs/UserController.php\n\n## Base de datos\n- Configurada para MySQL (XAMPP) con la base `crmatlantis`.\n- Se corrieron migraciones.\n\n### Seeder de usuario interno\n- Existe `Database\\Seeders\\InternalUserSeeder` que crea/actualiza:\n  - Email: `admin@crmatlantis.local`\n  - Password: `Atlantis2025!`\n\nNotas:\n- Recomendada práctica: cambiar esta contraseña en producción.\n- Actualización (2025-12-26): `DatabaseSeeder` ahora sí llama a `InternalUserSeeder` (junto con seeders de permisos y etapas de Leads). Ejecuta:\n  - `php artisan migrate --seed`\n\nArchivos:\n- database/seeders/InternalUserSeeder.php\n- dat"}, {"file": "docs\\2025-12-25-notas.md", "start": 1920, "end": 2520, "text": "y etapas de Leads). Ejecuta:\n  - `php artisan migrate --seed`\n\nArchivos:\n- database/seeders/InternalUserSeeder.php\n- database/seeders/DatabaseSeeder.php\n\n## Frontend (Tailwind / Vite / Flowbite)\n### Tailwind v4 unificado\n- CSS entrypoint: `resources/css/app.css` usa `@import \"tailwindcss\";`.\n- Para que el modo oscuro sea por clase (y no por `prefers-color-scheme`), se agregó:\n  - `@custom-variant dark (&:where(.dark, .dark *));`\n\nArchivo:\n- resources/css/app.css\n\n### Modo oscuro/claro (toggle en header)\n- Helper de tema:\n  - `resources/js/theme.js`\n  - Persiste en `localStorage` (`crmatlantis-"}, {"file": "docs\\2025-12-25-notas.md", "start": 2400, "end": 3000, "text": "uro/claro (toggle en header)\n- Helper de tema:\n  - `resources/js/theme.js`\n  - Persiste en `localStorage` (`crmatlantis-theme`).\n  - Aplica el tema toggling de `document.documentElement.classList` (`html.dark`).\n  - Emite evento `theme:changed`.\n- Se inicializa temprano en:\n  - `resources/js/app.js`\n- Botón en header:\n  - `resources/js/components/Header.vue`\n\n## Dashboard en Vue\n- Componente shell:\n  - `resources/js/components/App.vue`\n- Sidebar colapsable y navegación:\n  - `resources/js/components/Sidebar.vue`\n- Header con dropdown de usuario y toggle de tema:\n  - `resources/js/components/Hea"}, {"file": "docs\\2025-12-25-notas.md", "start": 2880, "end": 3480, "text": "resources/js/components/Sidebar.vue`\n- Header con dropdown de usuario y toggle de tema:\n  - `resources/js/components/Header.vue`\n- Footer:\n  - `resources/js/components/Footer.vue`\n\n### Fix: footer “sticky” y sin padding flotante\n- El layout se ajustó para que:\n  - El contenido tenga padding.\n  - El footer se pegue al fondo y ocupe el ancho completo del área (pegado al sidebar y al borde derecho).\n\nArchivo:\n- resources/js/components/App.vue\n\n## Módulo Usuarios\n### Backend\n- `UserController@index` soporta server-side:\n  - `search` (name/email)\n  - `page`\n  - `per_page` (10/25/50/100)\n  - `sort`"}, {"file": "docs\\2025-12-25-notas.md", "start": 3360, "end": 3960, "text": "serController@index` soporta server-side:\n  - `search` (name/email)\n  - `page`\n  - `per_page` (10/25/50/100)\n  - `sort` (id/name/email/created_at)\n  - `dir` (asc/desc)\n- Respuesta:\n  - `data`: array de usuarios (id, name, email, created_at)\n  - `meta`: paginación (current_page, last_page, per_page, total, from, to)\n\nArchivo:\n- app/Http/Controllers/UserController.php\n\n### Frontend\n- Tabla con:\n  - Buscador (debounce ~300ms)\n  - Selector “por página”\n  - Paginación (Anterior/Siguiente + estado)\n- CRUD:\n  - Crear/Editar en modales.\n  - Eliminar con confirm.\n- Modales con animación:\n  - Transición"}, {"file": "docs\\2025-12-25-notas.md", "start": 3840, "end": 4440, "text": "guiente + estado)\n- CRUD:\n  - Crear/Editar en modales.\n  - Eliminar con confirm.\n- Modales con animación:\n  - Transición fade (overlay) + scale (card) con `<Transition>` de Vue.\n  - Cierre por click fuera y `ESC`.\n\nArchivo:\n- resources/js/components/UsersTable.vue\n\n## Comandos útiles\n### Backend\n- `composer install`\n- `php artisan key:generate`\n- `php artisan migrate`\n- Seeder usuario interno:\n  - `php artisan db:seed --class=Database\\\\Seeders\\\\InternalUserSeeder`\n- Servidor:\n  - `php artisan serve`\n\n### Frontend\n- `npm install`\n- Dev:\n  - `npm run dev`\n- Build:\n  - `npm run build`\n\n## Para co"}, {"file": "docs\\2025-12-25-notas.md", "start": 4320, "end": 4698, "text": "- `php artisan serve`\n\n### Frontend\n- `npm install`\n- Dev:\n  - `npm run dev`\n- Build:\n  - `npm run build`\n\n## Para continuar mañana\n- Añadir ordenamiento por columnas (server-side) desde la UI de tabla.\n- Agregar filtros adicionales (ej. fecha de creación, estado/rol cuando exista).\n- Empezar siguiente módulo (Clientes) replicando patrón: tabla + endpoints JSON + modales."}, {"file": "docs\\2025-12-26-notas.md", "start": 0, "end": 600, "text": "# CRM ATLANTIS — Notas de trabajo (2025-12-26)\n\n## Resumen de lo implementado\n\nHoy se consolidó el CRM con RBAC completo, módulos reales (Usuarios, Roles y Leads/Kanban), y mejoras de UX para que el dashboard sea usable como SPA dentro de Blade.\n\n## Stack actual\n- Backend: Laravel 12 + PHP 8.2\n- DB: MySQL (XAMPP)\n- Auth: Laravel Breeze (registro deshabilitado)\n- Frontend: Vue 3 + Vite 7\n- UI: Tailwind v4 + Flowbite\n- RBAC: spatie/laravel-permission\n\n## Arquitectura\n- Blade actúa como shell: `resources/views/dashboard.blade.php`.\n- Vue se monta en `#app` (`resources/js/app.js`) y cambia de módu"}, {"file": "docs\\2025-12-26-notas.md", "start": 480, "end": 1080, "text": "túa como shell: `resources/views/dashboard.blade.php`.\n- Vue se monta en `#app` (`resources/js/app.js`) y cambia de módulo por `window.location.pathname` (`resources/js/components/App.vue`).\n- Endpoints JSON internos protegidos por `auth` + permisos (no hay API separada).\n\n## RBAC / Seguridad\n\n### Middleware Spatie en Laravel 12\n- Se registraron aliases en `bootstrap/app.php`:\n  - `permission`, `role`, `role_or_permission`\n\n### Permisos base creados por seeder\n- `users.view|create|update|delete`\n- `roles.view|create|update|delete`\n- `leads.view|create|update|delete`\n- `menu.users|menu.roles|me"}, {"file": "docs\\2025-12-26-notas.md", "start": 960, "end": 1560, "text": "reate|update|delete`\n- `roles.view|create|update|delete`\n- `leads.view|create|update|delete`\n- `menu.users|menu.roles|menu.leads` (control de visibilidad del sidebar)\n\n### Roles base\n- `admin`: acceso total.\n- `dev`: acceso total.\n- `employee`: rol base sin permisos (para asignar granularmente).\n\n> Importante: para ver un módulo debes dar permisos de ruta (`*.view`) y también el permiso de menú `menu.*` para que aparezca el link en el sidebar.\n\n## Módulo Usuarios\n\n### Backend\n- `GET /users/data`: paginación + búsqueda server-side.\n- Se añadió `GET /users/role-options`: retorna roles existentes"}, {"file": "docs\\2025-12-26-notas.md", "start": 1440, "end": 2040, "text": "- `GET /users/data`: paginación + búsqueda server-side.\n- Se añadió `GET /users/role-options`: retorna roles existentes para que el select sea dinámico.\n- Crear/editar usuario asigna roles usando Spatie (`syncRoles`).\n\n### Frontend\n- Tabla con buscador (debounce), paginación server-side, modales animados.\n- Select de rol cargado dinámicamente desde `/users/role-options`.\n\n## Módulo Roles\n\n### Backend\n- CRUD de roles vía JSON y catálogo de permisos:\n  - `GET /roles/data`\n  - `GET /roles/permissions`\n  - `POST /roles`, `PUT /roles/{role}`, `DELETE /roles/{role}`\n\n### Frontend\n- CRUD de roles.\n-"}, {"file": "docs\\2025-12-26-notas.md", "start": 1920, "end": 2520, "text": "`GET /roles/permissions`\n  - `POST /roles`, `PUT /roles/{role}`, `DELETE /roles/{role}`\n\n### Frontend\n- CRUD de roles.\n- Asignación de permisos por checkbox.\n- Sección “Módulos del menú” para togglear `menu.users`, `menu.roles`, `menu.leads`.\n\n## Módulo Leads (Kanban)\n\n### Modelo de datos\n- `lead_stages`: columnas del kanban. Seeder crea: follow_up, qualified, proposed, won.\n- `leads`: oportunidad.\n- `customers`: entidad separada.\n\nReglas:\n- `document_type` + `document_number` son opcionales en lead.\n- Validación condicional: si envías `document_type`, el `document_number` debe tener 8 dígitos"}, {"file": "docs\\2025-12-26-notas.md", "start": 2400, "end": 3000, "text": "` son opcionales en lead.\n- Validación condicional: si envías `document_type`, el `document_number` debe tener 8 dígitos (dni) o 11 (ruc).\n- Al mover a etapa `won` se crea/relaciona un `customer` automáticamente.\n\n### Backend\n- `GET /leads/board-data`: stages + leads agrupados.\n- `POST /leads`: crea lead (usa primera etapa por defecto si no se envía `stage_id`).\n- `PATCH /leads/{lead}/move-stage`: mueve lead y convierte a customer si la etapa es ganada.\n\n### Frontend\n- Kanban con drag & drop.\n- Movimiento “optimista” para evitar parpadeo: se actualiza UI sin recargar todo el tablero.\n- Modal “"}, {"file": "docs\\2025-12-26-notas.md", "start": 2880, "end": 3361, "text": "con drag & drop.\n- Movimiento “optimista” para evitar parpadeo: se actualiza UI sin recargar todo el tablero.\n- Modal “Lead rápido” tipo Kommo, adaptado a los campos actuales.\n\n## Seeders y credenciales\n- `DatabaseSeeder` ejecuta:\n  - `RolesAndPermissionsSeeder`\n  - `LeadStagesSeeder`\n  - `InternalUserSeeder`\n\nUsuario admin interno (dev/local):\n- Email: `admin@crmatlantis.local`\n- Password: `Atlantis2025!`\n\n## Validaciones\n- `php artisan test`: 24/24 OK\n- `npm run build`: OK"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 0, "end": 600, "text": "# 2025-12-28 — CRM Atlantis (Parte 2: Postventa + Dashboard)\n\nFecha: 2025-12-28\n\n## Objetivo general\n- Migrar/replicar el módulo **Postventa** del sistema anterior dentro del CRM (Laravel + Vue), reutilizando el patrón de Leads (pipeline + lista) para Incidencias/Backlog.\n- Terminar los módulos “tablas simples” (Contadores y Certificados) e integrarlos a navegación/permisos.\n- Dejar un **Dashboard real** con métricas relevantes y listas accionables.\n\n---\n\n## 1) Postventa — Incidencias/Backlog (pipeline + lista)\n**Decisión de diseño**\n- Incidencias y Backlog se implementaron como una sola entid"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 480, "end": 1080, "text": "cidencias/Backlog (pipeline + lista)\n**Decisión de diseño**\n- Incidencias y Backlog se implementaron como una sola entidad (`incidences`) con etapas (`incidence_stages`), igual al pipeline de Leads.\n- La UX queda como Leads: **2 vistas** (Backlog/Pipeline y Lista), alternando por URL.\n\n**Base de datos**\n- Migraciones:\n  - `database/migrations/*create_incidence_stages_table.php`\n  - `database/migrations/*create_incidences_table.php`\n- Campos relevantes:\n  - Correlativo (`INC-000001`), `stage_id`, `customer_id`, `title`, `date`, `priority`, `notes`, `archived_at`.\n\n**Backend**\n- `app/Models/Inci"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 960, "end": 1560, "text": "00001`), `stage_id`, `customer_id`, `title`, `date`, `priority`, `notes`, `archived_at`.\n\n**Backend**\n- `app/Models/Incidence.php`, `app/Models/IncidenceStage.php`\n- `app/Http/Controllers/IncidenceController.php`\n  - `tableData()` lista\n  - `boardData()` backlog/pipeline\n  - `store()` crea incidencia y genera correlativo\n  - `moveStage()` mueve de etapa\n  - `archive()` archiva (usa `archived_at`)\n\n**Frontend (Vue)**\n- `resources/js/components/BacklogBoard.vue` (Kanban/pipeline)\n- `resources/js/components/IncidenciasTable.vue` (Tabla/lista)\n- `resources/js/components/IncidenceQuickModal.vue`"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 1440, "end": 2040, "text": "e)\n- `resources/js/components/IncidenciasTable.vue` (Tabla/lista)\n- `resources/js/components/IncidenceQuickModal.vue`\n  - Modal global para “Nueva incidencia” usando `CustomEvent`.\n\n**Rutas**\n- `routes/web.php`\n  - `GET /backlog` (vista backlog/pipeline)\n  - `GET /incidencias` (vista lista)\n  - `GET /backlog/board-data`\n  - `GET /incidencias/data`\n  - `POST /incidencias`\n  - `PATCH /incidencias/{incidence}/move-stage`\n  - `PATCH /incidencias/{incidence}/archive`\n\n---\n\n## 2) Postventa — Clientes (tabla + acción de relación con incidencia)\n**Qué se hizo**\n- Se agregó un listado “Clientes (postve"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 1920, "end": 2520, "text": "ostventa — Clientes (tabla + acción de relación con incidencia)\n**Qué se hizo**\n- Se agregó un listado “Clientes (postventa)” que permite enlazar rápidamente un cliente a una incidencia (flujo de trabajo).\n\n**Frontend**\n- `resources/js/components/PostventaCustomersTable.vue`\n\n**Rutas**\n- `GET /postventa/clientes` (renderiza la SPA)\n\n---\n\n## 3) Postventa — Contadores (tabla simple + relación con cliente)\n**Decisión de datos**\n- Se modeló `contadores` como tabla principal.\n- Se agregó una tabla intermedia `contador_customer` para asignación a cliente.\n- Se mantiene restricción práctica: **un con"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 2400, "end": 3000, "text": "agregó una tabla intermedia `contador_customer` para asignación a cliente.\n- Se mantiene restricción práctica: **un contador solo puede estar asignado a un cliente** (`unique(contador_id)` en pivot).\n\n**Migraciones**\n- `database/migrations/2025_12_28_000300_create_contadores_table.php`\n- `database/migrations/2025_12_28_000301_create_contador_customer_table.php`\n\n**Backend**\n- `app/Models/Contador.php` + relación a customers.\n- `app/Models/Customer.php` se amplió con `contadores()`.\n- `app/Http/Controllers/ContadorController.php`\n  - `data()` (incluye cliente asignado si existe)\n  - `store()`,"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 2880, "end": 3480, "text": "res()`.\n- `app/Http/Controllers/ContadorController.php`\n  - `data()` (incluye cliente asignado si existe)\n  - `store()`, `update()`, `destroy()`\n\n**Frontend**\n- `resources/js/components/ContadoresTable.vue`\n- SweetAlert prompts:\n  - `resources/js/ui/alerts.js` (`promptContadorCreate`, `promptContadorEdit`)\n\n**Rutas**\n- `GET /postventa/contadores`\n- `GET /postventa/contadores/data`\n- `POST /postventa/contadores`\n- `PUT /postventa/contadores/{contador}`\n- `DELETE /postventa/contadores/{contador}`\n\n---\n\n## 4) Postventa — Certificados (tabla simple + imagen con upload)\n**Aclaración funcional**\n- E"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 3360, "end": 3960, "text": "tadores/{contador}`\n\n---\n\n## 4) Postventa — Certificados (tabla simple + imagen con upload)\n**Aclaración funcional**\n- Es válido que Certificados sea una tabla sin relaciones (no todas las tablas deben tener FKs).\n\n**Migración**\n- `database/migrations/2025_12_28_000302_create_certificados_table.php`\n  - Incluye `imagen` (string path), fechas y `created_by/updated_by`.\n\n**Backend**\n- `app/Models/Certificado.php`\n- `app/Http/Controllers/CertificadoController.php`\n  - CRUD + paginación/búsqueda.\n  - **Upload de imagen**:\n    - Acepta `imagen` tipo file (`image`, max 4MB).\n    - Guarda en `storage"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 3840, "end": 4440, "text": "inación/búsqueda.\n  - **Upload de imagen**:\n    - Acepta `imagen` tipo file (`image`, max 4MB).\n    - Guarda en `storage/app/public/certificados` y persiste la ruta en `certificados.imagen`.\n    - En update, si suben nueva imagen, elimina la anterior del disco.\n    - En delete, también elimina la imagen.\n\n**Frontend**\n- `resources/js/components/CertificadosTable.vue`\n- SweetAlert prompts:\n  - `resources/js/ui/alerts.js` (`promptCertificadoCreate`, `promptCertificadoEdit`)\n  - Se cambió el campo Imagen a `type=\"file\"`.\n  - Al editar: si el usuario no selecciona archivo, no se sobrescribe la ima"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 4320, "end": 4920, "text": "Se cambió el campo Imagen a `type=\"file\"`.\n  - Al editar: si el usuario no selecciona archivo, no se sobrescribe la imagen actual.\n- Envío `multipart/form-data`:\n  - Create: usa `FormData` cuando hay archivo.\n  - Update: usa `POST + _method=PUT` cuando hay archivo para que PHP reciba `$_FILES`.\n\n**Rutas**\n- `GET /postventa/certificados`\n- `GET /postventa/certificados/data`\n- `POST /postventa/certificados`\n- `PUT /postventa/certificados/{certificado}`\n- `DELETE /postventa/certificados/{certificado}`\n\n**Nota**\n- Si se requiere servir imágenes públicamente: `php artisan storage:link`.\n\n---\n\n## 5"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 4800, "end": 5400, "text": "tificados/{certificado}`\n\n**Nota**\n- Si se requiere servir imágenes públicamente: `php artisan storage:link`.\n\n---\n\n## 5) Navegación — Sidebar Postventa + hover en modo colapsado\n**Problemas corregidos**\n- Dropdown Postventa no desplegaba.\n- El hover-flyout en sidebar colapsado se veía “detrás” del contenido.\n\n**Solución**\n- Dropdown Postventa corregido.\n- Hover-flyout:\n  - Se renderiza fuera del sidebar usando `Teleport to=\"body\"`.\n  - Se posiciona por `getBoundingClientRect()`.\n  - Z-index alto para evitar problemas de stacking context.\n\n**Archivo clave**\n- `resources/js/components/Sidebar.v"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 5280, "end": 5880, "text": "()`.\n  - Z-index alto para evitar problemas de stacking context.\n\n**Archivo clave**\n- `resources/js/components/Sidebar.vue`\n\n**Menú Postventa**\n- Incidencias\n- Clientes\n- Contadores\n- Certificados\n\n---\n\n## 6) Permisos y roles (Spatie)\n**Qué se hizo**\n- Se agregaron permisos y se validó que “Roles” no acepte permisos inexistentes.\n- Se asignaron permisos a roles `admin` y `dev`.\n\n**Seeder**\n- `database/seeders/RolesAndPermissionsSeeder.php`\n  - `menu.postventa`\n  - `incidencias.*`, `contadores.*`, `certificados.*`\n\n**Comandos típicos**\n- `php artisan db:seed --class=RolesAndPermissionsSeeder`\n-"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 5760, "end": 6360, "text": "s.*`, `contadores.*`, `certificados.*`\n\n**Comandos típicos**\n- `php artisan db:seed --class=RolesAndPermissionsSeeder`\n- `php artisan optimize:clear`\n\n---\n\n## 7) Dashboard real (métricas + listas)\n**Qué se hizo**\n- Se implementó un dashboard con datos reales (no placeholders) y secciones enfocadas a operación diaria:\n  - KPIs por módulo (según permisos)\n  - Certificados por vencer\n  - Próximos eventos (asignados al usuario)\n  - Últimos leads / últimas incidencias\n\n**Backend**\n- `app/Http/Controllers/DashboardController.php`\n  - `GET /dashboard/summary`\n  - Filtra contenido por permisos (`user-"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 6240, "end": 6840, "text": "- `app/Http/Controllers/DashboardController.php`\n  - `GET /dashboard/summary`\n  - Filtra contenido por permisos (`user->can(...)`).\n\n**Frontend**\n- `resources/js/components/DashboardView.vue`\n  - Consume `/dashboard/summary`.\n  - Tarjetas clicables hacia los módulos.\n\n**Integración en SPA**\n- `resources/js/components/App.vue`\n  - Renderiza `DashboardView` para `/dashboard`.\n\n---\n\n## 8) Checklist rápido (postventa + dashboard)\n1) Ir a `/dashboard` y verificar tarjetas + listas (según permisos).\n2) Entrar a Postventa:\n   - `/backlog` (pipeline)\n   - `/incidencias` (lista)\n   - `/postventa/clien"}, {"file": "docs\\2025-12-28-notas-parte-2.md", "start": 6720, "end": 7024, "text": "s (según permisos).\n2) Entrar a Postventa:\n   - `/backlog` (pipeline)\n   - `/incidencias` (lista)\n   - `/postventa/clientes`\n   - `/postventa/contadores`\n   - `/postventa/certificados`\n3) Certificados:\n   - Crear/editar y subir imagen.\n   - Validar `storage:link` si se necesita acceder por URL pública."}, {"file": "docs\\2025-12-28-notas.md", "start": 0, "end": 600, "text": "# 2025-12-28 — CRM Atlantis (resumen de avances)\n\nFecha: 2025-12-28\n\n## Objetivo general\n- Consolidar el CRM (Leads/Clientes) con UX consistente (modo oscuro + SweetAlert2).\n- Implementar módulo de Calendario (Opción A: agenda por usuario, privada) y recordatorios con notificaciones in-app (DB).\n\n---\n\n## 1) Modo oscuro (UI)\n**Qué se hizo**\n- Se ajustaron vistas Blade del perfil y navegación/header para que soporten `dark:` de Tailwind.\n\n**Archivos clave**\n- `resources/views/profile/*`\n- `resources/views/layouts/navigation.blade.php`\n- `resources/views/components/*` relacionados con navegación/"}, {"file": "docs\\2025-12-28-notas.md", "start": 480, "end": 1080, "text": "rofile/*`\n- `resources/views/layouts/navigation.blade.php`\n- `resources/views/components/*` relacionados con navegación/dropdowns\n\n---\n\n## 2) Leads (CRM): pipeline + lista, bloqueo “Ganado” y archivado\n**Qué se hizo**\n- Se implementaron 2 vistas para Leads:\n  - Pipeline/Kanban\n  - Lista/tabla (con tabs por etapa + select por fila para cambiar etapa)\n- Se agregó confirmación (SweetAlert2) antes de pasar a la etapa ganadora (`is_won`).\n- Una vez Ganado:\n  - Se bloquean movimientos (drag/select) para evitar cambios.\n  - Se habilita solo “Archivar” para ocultar del Kanban sin perder historial.\n- S"}, {"file": "docs\\2025-12-28-notas.md", "start": 960, "end": 1560, "text": "tos (drag/select) para evitar cambios.\n  - Se habilita solo “Archivar” para ocultar del Kanban sin perder historial.\n- Se agregó `archived_at` para marcar leads archivados.\n\n**Backend**\n- `app/Http/Controllers/LeadController.php`\n  - Endpoints para data de tabla y board.\n  - Movimiento de etapa.\n  - Archivado (`archived_at`).\n- Migración:\n  - `database/migrations/2025_12_27_000200_add_archived_at_to_leads_table.php`\n- Modelo:\n  - `app/Models/Lead.php` con casts/fillable para `archived_at`.\n\n**Frontend**\n- `resources/js/components/LeadsBoard.vue`\n  - Confirmación antes de “Ganado”.\n  - Bloqueo"}, {"file": "docs\\2025-12-28-notas.md", "start": 1440, "end": 2040, "text": "`archived_at`.\n\n**Frontend**\n- `resources/js/components/LeadsBoard.vue`\n  - Confirmación antes de “Ganado”.\n  - Bloqueo de drag para Ganados/Archivados.\n  - Botón “Archivar” (visible en columna ganadora).\n- `resources/js/components/LeadsTable.vue`\n  - Select deshabilitado para Ganados/Archivados.\n  - Acción “Archivar” desde tabla.\n  - Columna “Archivado” mostrando `archived_at`.\n\n**Rutas**\n- `routes/web.php`\n  - `GET /leads` (pipeline)\n  - `GET /leads/list` (tabla)\n  - `GET /leads/data` (data tabla)\n  - `GET /leads/board-data` (data kanban)\n  - `PATCH /leads/{lead}/move-stage`\n  - `PATCH /lead"}, {"file": "docs\\2025-12-28-notas.md", "start": 1920, "end": 2520, "text": "leads/data` (data tabla)\n  - `GET /leads/board-data` (data kanban)\n  - `PATCH /leads/{lead}/move-stage`\n  - `PATCH /leads/{lead}/archive`\n\n---\n\n## 3) SweetAlert2 (confirmaciones/toasts) + compatibilidad dark\n**Qué se hizo**\n- Se reemplazaron `window.confirm` por modales SweetAlert2.\n- Se creó helper para confirmaciones y toasts.\n- Se ajustó el estilo del modal para que en dark mode no quede blanco.\n\n**Archivos clave**\n- `resources/js/ui/alerts.js`\n- (Usos) `LeadsBoard.vue`, `LeadsTable.vue`, `CustomersTable.vue`, `Header.vue`, `CalendarView.vue`\n\n---\n\n## 4) Clientes (módulo + acciones)\n**Qué s"}, {"file": "docs\\2025-12-28-notas.md", "start": 2400, "end": 3000, "text": "LeadsTable.vue`, `CustomersTable.vue`, `Header.vue`, `CalendarView.vue`\n\n---\n\n## 4) Clientes (módulo + acciones)\n**Qué se hizo**\n- Se agregó módulo Clientes (vista, rutas, controlador).\n- Se corrigieron campos consultados (ej. `contact_email`, `contact_phone`, `company_name`).\n- Se agregaron acciones Editar/Eliminar desde la UI (con SweetAlert2).\n\n**Backend**\n- `app/Http/Controllers/CustomerController.php`\n  - `data()` listado\n  - `update()` editar\n  - `destroy()` eliminar\n\n**Frontend**\n- `resources/js/components/CustomersTable.vue`\n  - Buscar/paginación\n  - “Ver leads” (link por documento o n"}, {"file": "docs\\2025-12-28-notas.md", "start": 2880, "end": 3480, "text": "*Frontend**\n- `resources/js/components/CustomersTable.vue`\n  - Buscar/paginación\n  - “Ver leads” (link por documento o nombre)\n  - Editar/Eliminar\n\n**Rutas**\n- `routes/web.php`\n  - `GET /customers`\n  - `GET /customers/data`\n  - `PUT /customers/{customer}`\n  - `DELETE /customers/{customer}`\n\n---\n\n## 5) Branding/layout\n**Qué se hizo**\n- Branding integrado al sidebar:\n  - Sidebar colapsado: isotipo\n  - Sidebar expandido: logotipo\n- Header alineado/pegado a la derecha del sidebar.\n\n**Archivos clave**\n- `resources/js/components/Sidebar.vue`\n- `resources/js/components/Header.vue`\n- `resources/images"}, {"file": "docs\\2025-12-28-notas.md", "start": 3360, "end": 3960, "text": ".\n\n**Archivos clave**\n- `resources/js/components/Sidebar.vue`\n- `resources/js/components/Header.vue`\n- `resources/images/LOGO.png`\n- `resources/images/LOGO_TEXTO.png`\n\n---\n\n## 6) Calendario (Opción A: agenda por usuario)\n**Decisión**\n- Opción A: cada usuario ve su propio calendario (scoping por `assigned_to = auth()->id()`).\n\n### 6.1 Base de datos\n**Migraciones**\n- `database/migrations/2025_12_28_000100_create_notifications_table.php`\n- `database/migrations/2025_12_28_000101_create_calendar_events_table.php`\n\n**Tabla calendar_events** (resumen)\n- `title`, `description`, `location`\n- `start_at`"}, {"file": "docs\\2025-12-28-notas.md", "start": 3840, "end": 4440, "text": "create_calendar_events_table.php`\n\n**Tabla calendar_events** (resumen)\n- `title`, `description`, `location`\n- `start_at`, `end_at`, `all_day`\n- recordatorios: `reminder_minutes`, `reminder_at`, `reminded_at`\n- relación polimórfica opcional: `related_type`, `related_id`\n- control de acceso: `created_by`, `assigned_to`\n\n### 6.2 Modelo\n- `app/Models/CalendarEvent.php`\n  - casts de fechas\n  - relaciones `creator()`, `assignee()` y `related()` (morph)\n\n### 6.3 API\n- `app/Http/Controllers/CalendarEventController.php`\n  - `GET /calendar/events` por rango (`start`, `end`) y filtrado por `assigned_to`"}, {"file": "docs\\2025-12-28-notas.md", "start": 4320, "end": 4920, "text": "rollers/CalendarEventController.php`\n  - `GET /calendar/events` por rango (`start`, `end`) y filtrado por `assigned_to`\n  - `POST /calendar/events` crea evento (assigned_to=usuario actual)\n  - `PUT /calendar/events/{event}` actualiza solo si el evento es del usuario\n  - `DELETE /calendar/events/{event}` elimina solo si el evento es del usuario\n\n### 6.4 UI (FullCalendar)\n- `resources/js/components/CalendarView.vue`\n  - FullCalendar month/week/day\n  - Crear evento (click fecha)\n  - Editar evento (click evento)\n  - Drag & drop / resize\n  - Formulario de evento con SweetAlert2\n  - Soporte para “pr"}, {"file": "docs\\2025-12-28-notas.md", "start": 4800, "end": 5400, "text": "- Editar evento (click evento)\n  - Drag & drop / resize\n  - Formulario de evento con SweetAlert2\n  - Soporte para “prefill” vía querystring:\n    - `/calendar?related_type=lead&related_id=123&title=Seguimiento...`\n  - Refetch correcto mediante `calendarRef.getApi().refetchEvents()`\n\n**Dependencias**\n- `@fullcalendar/core`\n- `@fullcalendar/vue3`\n- `@fullcalendar/daygrid`\n- `@fullcalendar/timegrid`\n- `@fullcalendar/interaction`\n\n### 6.5 Rutas (vista)\n- `routes/web.php`\n  - `GET /calendar` (renderiza dashboard SPA)\n\n---\n\n## 7) Notificaciones in-app (fase 1)\n**Qué se hizo**\n- Notificaciones pers"}, {"file": "docs\\2025-12-28-notas.md", "start": 5280, "end": 5880, "text": "ET /calendar` (renderiza dashboard SPA)\n\n---\n\n## 7) Notificaciones in-app (fase 1)\n**Qué se hizo**\n- Notificaciones persistidas en DB (channel `database`).\n- Scheduler cada minuto revisa eventos vencidos para recordatorio y genera notificación.\n\n**Backend**\n- `app/Notifications/CalendarEventReminderNotification.php`\n- `app/Http/Controllers/NotificationController.php`\n  - `GET /notifications` (últimas no leídas + count)\n  - `POST /notifications/{id}/read` (marcar leída)\n- `bootstrap/app.php`\n  - `withSchedule`: cada minuto\n    - busca eventos con `reminder_at <= now` y `reminded_at IS NULL`"}, {"file": "docs\\2025-12-28-notas.md", "start": 5760, "end": 6360, "text": "tstrap/app.php`\n  - `withSchedule`: cada minuto\n    - busca eventos con `reminder_at <= now` y `reminded_at IS NULL`\n    - marca `reminded_at`\n    - envía notificación al usuario `assigned_to`\n\n**Frontend**\n- `resources/js/components/Header.vue`\n  - Campana con badge y dropdown\n  - Polling cada 30s a `/notifications`\n  - Toast al detectar nuevas (máximo 2 por ciclo)\n  - Click: marca como leída y redirige a `notification.data.url` si existe\n\n---\n\n## 8) Permisos (Spatie) y visibilidad del menú\n**Seeder**\n- `database/seeders/RolesAndPermissionsSeeder.php`\n  - permisos `calendar.*` y `menu.calenda"}, {"file": "docs\\2025-12-28-notas.md", "start": 6240, "end": 6840, "text": "bilidad del menú\n**Seeder**\n- `database/seeders/RolesAndPermissionsSeeder.php`\n  - permisos `calendar.*` y `menu.calendar`\n  - rol `admin` y `dev` con permisos completos\n\n**Sidebar**\n- `resources/js/components/Sidebar.vue`\n  - Se muestra Calendario si el usuario tiene `menu.calendar` o `calendar.view`.\n\n**Nota**\n- Si no aparece el menú: el usuario debe tener el permiso en BD.\n- Comandos útiles:\n  - `php artisan db:seed --class=RolesAndPermissionsSeeder`\n  - `php artisan permission:cache-reset`\n\n---\n\n## 9) Cómo probar mañana (checklist)\n### Calendario\n1) Ver menú: ingresar a `/dashboard` y conf"}, {"file": "docs\\2025-12-28-notas.md", "start": 6720, "end": 7320, "text": "ssion:cache-reset`\n\n---\n\n## 9) Cómo probar mañana (checklist)\n### Calendario\n1) Ver menú: ingresar a `/dashboard` y confirmar que aparece “Calendario” en sidebar.\n2) Abrir `/calendar`.\n3) Crear evento:\n   - click en una fecha\n   - título requerido, inicio requerido\n4) Editar evento: click en evento.\n5) Mover evento: drag & drop.\n6) Resize evento: estirar fin.\n7) Probar recordatorio:\n   - crear evento con inicio cercano\n   - `reminder_minutes` pequeño (ej. 1)\n   - esperar el scheduler (cada minuto)\n   - ver campana (badge) y dropdown.\n\n### Notificaciones\n- Confirmar que `/notifications` retorna"}, {"file": "docs\\2025-12-28-notas.md", "start": 7200, "end": 7800, "text": "cheduler (cada minuto)\n   - ver campana (badge) y dropdown.\n\n### Notificaciones\n- Confirmar que `/notifications` retorna datos.\n- Confirmar que al click se marca leída (`/notifications/{id}/read`) y baja el contador.\n\n---\n\n## 10) Pendientes/Recomendaciones (para decidir)\n### Relación Lead/Cliente con calendario (recomendación funcional)\n- Leads:\n  - **Seguimiento** (llamada, reunión, demo, cotización)\n  - **Recordatorio de propuesta** (cuando está en etapa de negociación)\n  - **Fecha tentativa de cierre**\n- Clientes:\n  - **Reunión de onboarding** (post-venta)\n  - **Visita periódica / check-in"}, {"file": "docs\\2025-12-28-notas.md", "start": 7680, "end": 8280, "text": "**Fecha tentativa de cierre**\n- Clientes:\n  - **Reunión de onboarding** (post-venta)\n  - **Visita periódica / check-in mensual**\n  - **Renovación / vencimientos** (si luego se agrega contratos)\n\n### Mejora UX recomendada (cuando quieras)\n- Evitar “related_id manual” en el formulario del calendario:\n  - Opción 1: desde Lead/Cliente agregar botón “Agendar” que prellena `related_type`/`related_id` (ya soportado por querystring)\n  - Opción 2: autocompletar (buscador) para seleccionar Lead/Cliente.\n\n---\n\n## Notas de implementación\n- SPA sigue siendo “por path” (sin vue-router): `resources/js/compo"}, {"file": "docs\\2025-12-28-notas.md", "start": 8160, "end": 8760, "text": "ionar Lead/Cliente.\n\n---\n\n## Notas de implementación\n- SPA sigue siendo “por path” (sin vue-router): `resources/js/components/App.vue` decide qué componente renderizar según `window.location.pathname`.\n- Datos de usuario/permisos se inyectan en `resources/views/dashboard.blade.php` via `window.__AUTH_USER__`.\n\n---\n\n## 11) Cambios de las últimas horas (post-resumen)\n\n### 11.1 Login: colores + fondo con imagen\n**Qué se hizo**\n- Se corrigieron estilos (dark/light) del formulario de login y se agregó un fondo con imagen desde `resources/images`.\n- Se ajustaron clases de Tailwind v4 para el gradien"}, {"file": "docs\\2025-12-28-notas.md", "start": 8640, "end": 9240, "text": "de login y se agregó un fondo con imagen desde `resources/images`.\n- Se ajustaron clases de Tailwind v4 para el gradiente (cambio de utilidades).\n\n**Archivos clave**\n- `resources/views/layouts/guest.blade.php`\n  - Fondo con `Vite::asset('resources/images/fondo_login.jpg')`.\n  - Overlay para legibilidad del formulario.\n  - Ajustes dark/light del card.\n- `resources/views/auth/login.blade.php`\n  - Ajustes de clases en checkbox/link en modo oscuro.\n\n### 11.2 Calendario: “Relacionado” con buscador (sin escribir IDs)\n**Problema**\n- El campo `related_id` obligaba a escribir IDs manualmente.\n\n**Qué s"}, {"file": "docs\\2025-12-28-notas.md", "start": 9120, "end": 9720, "text": "nado” con buscador (sin escribir IDs)\n**Problema**\n- El campo `related_id` obligaba a escribir IDs manualmente.\n\n**Qué se hizo**\n- Se reemplazó el input por un buscador/autocomplete que cambia según el tipo:\n  - Si `related_type = lead` busca leads.\n  - Si `related_type = customer` busca clientes.\n- Se soporta precarga del label cuando se edita un evento ya existente.\n\n**Reglas aplicadas**\n- En búsqueda de leads:\n  - No aparecen leads archivados.\n  - No aparecen leads ganados.\n\n**Backend**\n- `app/Http/Controllers/RelatedLookupController.php`\n  - Endpoint `GET /related-lookup` con `type=lead|cu"}, {"file": "docs\\2025-12-28-notas.md", "start": 9600, "end": 10200, "text": ".\n\n**Backend**\n- `app/Http/Controllers/RelatedLookupController.php`\n  - Endpoint `GET /related-lookup` con `type=lead|customer`, `q`, `limit`.\n  - Búsqueda y validaciones por permisos (`leads.view` / `customers.view`).\n- `routes/web.php`\n  - Registro de ruta `GET /related-lookup` dentro del scope autenticado/permisos.\n\n**Frontend**\n- `resources/js/components/CalendarView.vue`\n  - Select `related_type` + input de búsqueda + lista de resultados.\n  - Setea `related_id` al seleccionar.\n\n### 11.3 Calendario: mejor visibilidad de eventos + eliminar eventos\n**Qué se hizo**\n- Se mejoró la visibilidad"}, {"file": "docs\\2025-12-28-notas.md", "start": 10080, "end": 10680, "text": "ionar.\n\n### 11.3 Calendario: mejor visibilidad de eventos + eliminar eventos\n**Qué se hizo**\n- Se mejoró la visibilidad de los eventos en el calendario (píldora/bloque más notorio).\n- Se agregó la opción de eliminar eventos desde el modal de edición.\n\n**Detalles**\n- `resources/js/components/CalendarView.vue`\n  - Estilos/clases para “event pill” (mejor contraste y truncado).\n  - Acción “Eliminar” visible solo si el usuario tiene permiso `calendar.delete`.\n  - Llama `DELETE /calendar/events/{id}` y refresca con `refetchEvents()`.\n\n### 11.4 Notificaciones/recordatorios: por qué no aparecían en lo"}, {"file": "docs\\2025-12-28-notas.md", "start": 10560, "end": 11160, "text": "lendar/events/{id}` y refresca con `refetchEvents()`.\n\n### 11.4 Notificaciones/recordatorios: por qué no aparecían en local\n**Causa**\n- Los recordatorios dependen del Scheduler. Si el Scheduler no está corriendo, no se generan notificaciones.\n\n**Qué se hizo**\n- Se ajustó el flujo de desarrollo para que el Scheduler esté activo durante `composer run dev`.\n\n**Archivos clave**\n- `composer.json`\n  - Se agregó `php artisan schedule:work` al script de desarrollo.\n\n**Nota Windows**\n- En `storage/logs/laravel.log` apareció el error: `The [pcntl] extension is required to run Pail.`\n  - Esto es esperado"}, {"file": "docs\\2025-12-28-notas.md", "start": 11040, "end": 11640, "text": "- En `storage/logs/laravel.log` apareció el error: `The [pcntl] extension is required to run Pail.`\n  - Esto es esperado en Windows; no bloquea el CRM, pero evita usar Pail.\n\n### 11.5 Diagnóstico: pantalla en blanco (SPA)\n**Causa típica detectada**\n- Desajuste entre Vite dev server y el archivo `public/hot` (URL/host/puerto). Si el JS no carga, la SPA queda en blanco.\n\n**Señal**\n- `public/hot` apuntando a un host/puerto no accesible (ej. IPv6 `http://[::1]:5174`).\n\n### 11.6 Leads → Clientes: “no aparecen clientes al pasar a Ganado”\n**Hallazgo (importante)**\n- La conversión a cliente sí se ejec"}, {"file": "docs\\2025-12-28-notas.md", "start": 11520, "end": 12120, "text": "eads → Clientes: “no aparecen clientes al pasar a Ganado”\n**Hallazgo (importante)**\n- La conversión a cliente sí se ejecutaba, pero varios leads estaban usando el mismo documento (ej. DNI `12345678`).\n- Como `customers` tiene `unique(document_type, document_number)`, esos leads terminaban vinculándose al mismo cliente (en vez de crear uno nuevo).\n\n**Mejora mínima solicitada**\n- Mostrar un aviso y bloquear la creación de un lead si el documento ya existe.\n\n**Qué se implementó**\n- Validación adicional en `LeadController@store`:\n  - Si ya existe un `Customer` con el mismo `document_type + documen"}, {"file": "docs\\2025-12-28-notas.md", "start": 12000, "end": 12597, "text": "*\n- Validación adicional en `LeadController@store`:\n  - Si ya existe un `Customer` con el mismo `document_type + document_number`, se rechaza con mensaje claro.\n  - También se rechaza si ya existe un `Lead` activo (no archivado) con ese documento.\n\n**Archivo clave**\n- `app/Http/Controllers/LeadController.php`\n\n### 11.7 Nota de consola (PowerShell): comandos PHP y variables\n**Problema encontrado**\n- En PowerShell, usar `php -r \"... $var ...\"` con comillas dobles expande `$var` y rompe el snippet de PHP.\n\n**Solución práctica**\n- Usar comillas simples para el snippet: `php -r '... $var ...'`."}, {"file": "docs\\2026-01-12-notas.md", "start": 0, "end": 600, "text": "# 2026-01-12 — Notas (WhatsApp masivo + UX + fixes)\n\n## Objetivo del día\n\n- Mejorar UX/UI en modo oscuro (filtros de Leads).\n- Diseñar e implementar un MVP de **campañas de WhatsApp “manual asistido”** dentro del CRM (sin API de WhatsApp).\n- Resolver issues de navegación y UX.\n- Separar claramente **Leads** vs **Clientes** en la selección de destinatarios.\n\n> \"Manual asistido\" = el sistema **no envía** mensajes; solo **genera texto personalizado**, abre WhatsApp (`wa.me`) y el usuario marca el estado (enviado/abierto).\n\n---\n\n## 1) UI: filtros de Leads (modo oscuro)\n\n**Archivo:** `resources/js/"}, {"file": "docs\\2026-01-12-notas.md", "start": 480, "end": 1080, "text": "l usuario marca el estado (enviado/abierto).\n\n---\n\n## 1) UI: filtros de Leads (modo oscuro)\n\n**Archivo:** `resources/js/components/LeadsBoard.vue`\n\n- Ajustes de estilos para inputs de filtros (select / date / botones) en dark mode:\n  - colores de texto / placeholder\n  - bordes y focus rings\n  - `color-scheme` para date inputs para icono/datepicker consistente en dark mode\n\nSe reconstruyeron assets con Vite.\n\n---\n\n## 2) MVP: Campañas WhatsApp “manual asistido”\n\n### 2.1 Migración y tablas\n\n**Migración:** `database/migrations/2026_01_12_120000_create_whatsapp_campaigns_tables.php`\n\n- Tabla `whats"}, {"file": "docs\\2026-01-12-notas.md", "start": 960, "end": 1560, "text": "ón y tablas\n\n**Migración:** `database/migrations/2026_01_12_120000_create_whatsapp_campaigns_tables.php`\n\n- Tabla `whatsapp_campaigns`\n- Tabla `whatsapp_campaign_recipients`\n  - Recipients con relación polimórfica (`contactable_type`, `contactable_id`) para soportar Lead/Customer.\n\n> Se ejecutó `php artisan migrate` con éxito.\n\n### 2.2 Modelos\n\n- `app/Models/WhatsAppCampaign.php`\n- `app/Models/WhatsAppCampaignRecipient.php`\n\n### 2.3 Controller / API\n\n**Controlador:** `app/Http/Controllers/WhatsAppCampaignController.php`\n\nEndpoints:\n\n- `GET /leads/whatsapp/recipients`\n  - Devuelve candidatos un"}, {"file": "docs\\2026-01-12-notas.md", "start": 1440, "end": 2040, "text": "p/Controllers/WhatsAppCampaignController.php`\n\nEndpoints:\n\n- `GET /leads/whatsapp/recipients`\n  - Devuelve candidatos unificados en `contacts[]`.\n  - Soporta:\n    - `source`: `leads|customers`\n    - `stage_id` (solo para leads)\n    - `q` (búsqueda)\n    - `limit`\n    - `only_with_phone` (filtro de teléfono)\n  - Devuelve `counts` para UX:\n    - `total`\n    - `with_phone`\n    - `without_phone`\n    - `returned`\n\n- `POST /leads/whatsapp-campaigns`\n  - Crea campaña con:\n    - `source` + `ids[]` (genérico: leads o customers)\n    - `message_template`\n\n- `GET /leads/whatsapp-campaigns`\n  - Lista última"}, {"file": "docs\\2026-01-12-notas.md", "start": 1920, "end": 2520, "text": "ce` + `ids[]` (genérico: leads o customers)\n    - `message_template`\n\n- `GET /leads/whatsapp-campaigns`\n  - Lista últimas campañas.\n\n- `GET /leads/whatsapp-campaigns/{campaign}`\n  - Detalle de campaña con recipients.\n\n- `PATCH /leads/whatsapp-campaign-recipients/{recipient}`\n  - Actualiza estado por destinatario (ej: `opened`, `sent`).\n\nPermisos:\n\n- Para `source=customers`, se valida `customers.view`.\n\n### 2.4 Rutas\n\n**Archivo:** `routes/web.php`\n\n- Ruta UI shell:\n  - `GET /leads/whatsapp` (renderiza el dashboard SPA)\n- Rutas API (ver endpoints arriba).\n\n---\n\n## 3) Frontend: pantalla de campañ"}, {"file": "docs\\2026-01-12-notas.md", "start": 2400, "end": 3000, "text": "eads/whatsapp` (renderiza el dashboard SPA)\n- Rutas API (ver endpoints arriba).\n\n---\n\n## 3) Frontend: pantalla de campañas\n\n**Componente:** `resources/js/components/LeadsWhatsAppCampaign.vue`\n\nFuncionalidad:\n\n- Crear campaña:\n  - nombre opcional\n  - plantilla de mensaje con variables:\n    - `{{first_name}}`\n    - `{{company_name}}`\n- Cargar destinatarios con filtros:\n  - Tabs: **Leads / Clientes** (`source`)\n  - Etapa (solo en Leads)\n  - Búsqueda `q`\n  - Límite\n  - Checkbox `Solo con teléfono`\n- Selección:\n  - seleccionar todos\n  - selección individual\n- Ejecución:\n  - abrir WhatsApp con `http"}, {"file": "docs\\2026-01-12-notas.md", "start": 2880, "end": 3480, "text": "Solo con teléfono`\n- Selección:\n  - seleccionar todos\n  - selección individual\n- Ejecución:\n  - abrir WhatsApp con `https://wa.me/<phone>?text=<message>`\n  - marcar estado (abierto/enviado)\n- Historial:\n  - lista de últimas campañas\n\nMejoras UX agregadas hoy:\n\n- Conteos de destinatarios (total/con teléfono/sin teléfono) para entender por qué queda vacío.\n- Ajuste de envío de `only_with_phone` a `1/0` (evita validación fallida en backend).\n- Auto-ajuste del checkbox cuando no existen registros con teléfono (evita “0 resultados” confuso).\n\n---\n\n## 4) Integración SPA + navegación\n\n**SPA:** `resou"}, {"file": "docs\\2026-01-12-notas.md", "start": 3360, "end": 3960, "text": "existen registros con teléfono (evita “0 resultados” confuso).\n\n---\n\n## 4) Integración SPA + navegación\n\n**SPA:** `resources/js/components/App.vue`\n\n- Se agregó la vista `/leads/whatsapp` al switch de pantallas.\n\n**Sidebar:** `resources/js/components/Sidebar.vue`\n\n- Se añadió el item de menú “WhatsApp masivo” dentro de Pipeline.\n- Fix: el sidebar en modo colapsado usa un menú “flyout” distinto; se agregó el link también ahí.\n- Fix de active state para que `/leads` no quede resaltado cuando estás en `/leads/whatsapp`.\n\n---\n\n## 5) Fixes importantes de hoy\n\n### 5.1 Error de validación (rojo en in"}, {"file": "docs\\2026-01-12-notas.md", "start": 3840, "end": 4440, "text": "saltado cuando estás en `/leads/whatsapp`.\n\n---\n\n## 5) Fixes importantes de hoy\n\n### 5.1 Error de validación (rojo en inglés) `only_with_phone`\n\nProblema:\n\n- Laravel valida querystring boolean como `0/1`.\n- El frontend enviaba `true/false` (string), lo que disparaba el error.\n\nSolución:\n\n- Frontend manda `only_with_phone: 1|0`.\n- Backend acepta `0/1/true/false` y castea con `$request->boolean(...)`.\n\n### 5.2 “Todos” en Leads no debe incluir Ganado\n\nRequisito:\n\n- La etapa “Ganado” (is_won) corresponde a leads convertidos, que deben tratarse como Customers.\n\nSolución:\n\n- En `recipients()` para l"}, {"file": "docs\\2026-01-12-notas.md", "start": 4320, "end": 4920, "text": "ado” (is_won) corresponde a leads convertidos, que deben tratarse como Customers.\n\nSolución:\n\n- En `recipients()` para leads:\n  - `LeadStage` filtrado por `is_won = false`.\n  - “Todas” trae solo etapas no ganadas.\n  - Si se intenta pedir una etapa no válida (Ganado), responde 422 con mensaje.\n\n### 5.3 Por qué no salían Leads\n\nHallazgo en la BD (al momento del ajuste):\n\n- Existen leads no-ganados, pero no hay ninguno con `contact_phone`.\n- Si “Solo con teléfono” estaba activado, el resultado era 0.\n\nMitigación UX:\n\n- Mostrar conteos y sugerir desmarcar.\n- Auto-desactivar el filtro cuando `with_"}, {"file": "docs\\2026-01-12-notas.md", "start": 4800, "end": 5375, "text": "o, el resultado era 0.\n\nMitigación UX:\n\n- Mostrar conteos y sugerir desmarcar.\n- Auto-desactivar el filtro cuando `with_phone = 0`.\n\n---\n\n## 6) Comandos usados (resumen)\n\n- `php artisan migrate`\n- `npm run build`\n\n---\n\n## 7) Pendientes sugeridos (para mañana)\n\n- No permitir seleccionar destinatarios “Sin teléfono” (o marcarlos como no-elegibles).\n- Acciones masivas en ejecución (marcar enviados/omitidos en batch).\n- Vista previa del mensaje para un destinatario antes de crear campaña.\n- Opcional: registro de actividad por Lead/Customer (timeline) cuando se abre/envía."}, {"file": "docs\\2026-01-13-email-campanas.md", "start": 0, "end": 600, "text": "# 2026-01-13 — Campañas de Email (plan + implementación inicial)\n\n## Qué es una campaña de email\n\n- **Campaña** = un “lote” de envío informativo.\n- Tiene:\n  - `name` (opcional)\n  - `subject_template` + `body_template`\n  - lista de destinatarios (Leads o Customers)\n  - estados por destinatario (`pending/queued/sent/failed/skipped`).\n\nA diferencia de WhatsApp manual asistido, aquí el sistema **sí envía** (via SMTP/mail provider), ideal para informativos.\n\n---\n\n## Implementación (MVP)\n\n### Base de datos\n\nMigración:\n- `database/migrations/2026_01_13_090000_create_email_campaigns_tables.php`\n\nTabla"}, {"file": "docs\\2026-01-13-email-campanas.md", "start": 480, "end": 1080, "text": "(MVP)\n\n### Base de datos\n\nMigración:\n- `database/migrations/2026_01_13_090000_create_email_campaigns_tables.php`\n\nTablas:\n- `email_campaigns`\n- `email_campaign_recipients`\n- `email_unsubscribes`\n\n### Backend\n\nControladores:\n- `app/Http/Controllers/EmailCampaignController.php`\n  - `GET /leads/email/recipients` (Leads/Customers, filtros, conteos)\n  - `POST /leads/email-campaigns` (crear campaña + recipients)\n  - `GET /leads/email-campaigns` (historial)\n  - `GET /leads/email-campaigns/{campaign}` (detalle)\n  - `POST /leads/email-campaigns/{campaign}/send` (encola envío)\n\n- `app/Http/Controllers/"}, {"file": "docs\\2026-01-13-email-campanas.md", "start": 960, "end": 1560, "text": "mpaigns/{campaign}` (detalle)\n  - `POST /leads/email-campaigns/{campaign}/send` (encola envío)\n\n- `app/Http/Controllers/EmailUnsubscribeController.php`\n  - `GET /email/unsubscribe?email=...&token=...` (baja)\n\nJobs/Mail:\n- `app/Jobs/SendEmailCampaignRecipientJob.php`\n- `app/Mail/EmailCampaignRecipientMailable.php`\n\nNotas:\n- Los envíos se encolan en `queue=mail`.\n- Se agrega automáticamente un footer con enlace de baja (token HMAC con `APP_KEY`).\n- Se excluye la etapa **Ganado** en Leads (se maneja como Customer).\n\n### Frontend\n\nPantalla:\n- `resources/js/components/LeadsEmailCampaign.vue`\n\nInteg"}, {"file": "docs\\2026-01-13-email-campanas.md", "start": 1440, "end": 2040, "text": "* en Leads (se maneja como Customer).\n\n### Frontend\n\nPantalla:\n- `resources/js/components/LeadsEmailCampaign.vue`\n\nIntegración:\n- `resources/js/components/App.vue` (ruta SPA `/leads/email`)\n- `resources/js/components/Sidebar.vue` (link “Email masivo” en Pipeline)\n\n---\n\n## Configuración para enviar por Gmail (Google Workspace recomendado)\n\n### Para desarrollo (sin enviar de verdad)\n\n- En `.env`:\n  - `MAIL_MAILER=log`\n\nEsto escribe el contenido del email en logs en vez de enviarlo.\n\n### Para enviar con Gmail/Workspace (SMTP)\n\n- En `.env`:\n  - `MAIL_MAILER=smtp`\n  - `MAIL_HOST=smtp.gmail.com`\n  -"}, {"file": "docs\\2026-01-13-email-campanas.md", "start": 1920, "end": 2520, "text": "rlo.\n\n### Para enviar con Gmail/Workspace (SMTP)\n\n- En `.env`:\n  - `MAIL_MAILER=smtp`\n  - `MAIL_HOST=smtp.gmail.com`\n  - `MAIL_PORT=587`\n  - `MAIL_ENCRYPTION=tls`\n  - `MAIL_USERNAME=tu_correo@tudominio.com`\n  - `MAIL_PASSWORD=APP_PASSWORD` (recomendado con 2FA)\n  - `MAIL_FROM_ADDRESS=tu_correo@tudominio.com`\n  - `MAIL_FROM_NAME=\"CRM Atlantis\"`\n\n> Recomendación: usar **Google Workspace** (correo del dominio) y App Password.\n\n### Cola (queue)\n\nPara que el envío ocurra en background:\n- configurar `QUEUE_CONNECTION` (por ejemplo `database` o `redis`)\n- ejecutar worker:\n  - `php artisan queue:work"}, {"file": "docs\\2026-01-13-email-campanas.md", "start": 2400, "end": 3000, "text": "ound:\n- configurar `QUEUE_CONNECTION` (por ejemplo `database` o `redis`)\n- ejecutar worker:\n  - `php artisan queue:work --queue=mail`\n\nSi `QUEUE_CONNECTION=sync`, se enviará inmediatamente al llamar “Enviar”.\n\n---\n\n## SPF / DKIM (entrega y reputación)\n\nCuando se use un correo del dominio (`@tudominio.com`) es clave configurar DNS:\n\n- **SPF**: autoriza a Google a enviar por tu dominio.\n- **DKIM**: firma los correos para que no se marquen como falsificados.\n\nSe configura desde el panel de Google Admin + el DNS del dominio.\n\n---\n\n## Desuscripción (unsubscribe)\n\n- En campañas informativas se inclu"}, {"file": "docs\\2026-01-13-email-campanas.md", "start": 2880, "end": 3432, "text": "el panel de Google Admin + el DNS del dominio.\n\n---\n\n## Desuscripción (unsubscribe)\n\n- En campañas informativas se incluye un enlace de baja.\n- Al darse de baja, se registra el email en `email_unsubscribes`.\n- Los siguientes envíos omiten ese email con estado `skipped`.\n\n---\n\n## Pendientes sugeridos\n\n- Botón para “Preview” (renderizar en UI con un destinatario de ejemplo).\n- Indicador de progreso en campaña (sent/failed/pending).\n- Plantillas HTML (opcional) + branding.\n- Configuración de correo por empresa (si se vende el sistema multi-tenant)."}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 0, "end": 600, "text": "# Resumen general — WhatsApp + Email (hasta ahora)\n\n> Alcance: mejoras UI en Leads, módulo de WhatsApp masivo (manual asistido) y módulo de Email masivo (informativo, automatizado por cola), con separación Leads/Clientes y flujo de desuscripción.\n\n---\n\n## 1) Conceptos clave\n\n### 1.1 “Campaña”\n\n- Una **campaña** es un “lote” de comunicación:\n  - Plantilla (mensaje/subject/body)\n  - Selección de destinatarios (Leads o Clientes)\n  - Seguimiento por destinatario (estado + timestamps + errores)\n\n### 1.2 WhatsApp vs Email\n\n- **WhatsApp (manual asistido)**\n  - El CRM NO envía mensajes.\n  - Abre `wa.m"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 480, "end": 1080, "text": "mps + errores)\n\n### 1.2 WhatsApp vs Email\n\n- **WhatsApp (manual asistido)**\n  - El CRM NO envía mensajes.\n  - Abre `wa.me` con texto prellenado y se marca estado manualmente.\n\n- **Email (informativo, automatizado)**\n  - El CRM SÍ envía emails.\n  - Se encola por destinatario (jobs) para no bloquear la UI.\n  - Incluye enlace de **darse de baja** (unsubscribe) para campañas informativas.\n\n---\n\n## 2) UI/UX: mejoras en Leads\n\n### 2.1 Dark mode en filtros\n\nArchivo:\n- `resources/js/components/LeadsBoard.vue`\n\nCambios:\n- Ajustes de estilos (texto/placeholder/bordes/focus) en inputs del filtro.\n- Mejor"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 960, "end": 1560, "text": "components/LeadsBoard.vue`\n\nCambios:\n- Ajustes de estilos (texto/placeholder/bordes/focus) en inputs del filtro.\n- Mejora visual de date inputs en dark mode.\n\n---\n\n## 3) WhatsApp masivo (manual asistido)\n\n### 3.1 Base de datos\n\nMigración:\n- `database/migrations/2026_01_12_120000_create_whatsapp_campaigns_tables.php`\n\nTablas:\n- `whatsapp_campaigns`\n- `whatsapp_campaign_recipients`\n\n### 3.2 Modelos\n\n- `app/Models/WhatsAppCampaign.php`\n- `app/Models/WhatsAppCampaignRecipient.php`\n\n### 3.3 Backend (API)\n\nControlador:\n- `app/Http/Controllers/WhatsAppCampaignController.php`\n\nEndpoints:\n- `GET /leads"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 1440, "end": 2040, "text": "`\n\n### 3.3 Backend (API)\n\nControlador:\n- `app/Http/Controllers/WhatsAppCampaignController.php`\n\nEndpoints:\n- `GET /leads/whatsapp/recipients`\n  - Params: `source=leads|customers`, `stage_id` (leads), `q`, `limit`, `only_with_phone`\n  - Respuesta: `contacts[]`, `stages[]`, `counts{total,with_phone,without_phone,returned}`\n  - Nota: **Ganado** se excluye (se maneja como Cliente).\n\n- `POST /leads/whatsapp-campaigns`\n  - Crea campaña con `source` + `ids[]` + `message_template`.\n\n- `GET /leads/whatsapp-campaigns`\n- `GET /leads/whatsapp-campaigns/{campaign}`\n- `PATCH /leads/whatsapp-campaign-recipie"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 1920, "end": 2520, "text": "- `GET /leads/whatsapp-campaigns`\n- `GET /leads/whatsapp-campaigns/{campaign}`\n- `PATCH /leads/whatsapp-campaign-recipients/{recipient}`\n\nPermisos:\n- Para `source=customers` se requiere `customers.view`.\n\n### 3.4 Frontend\n\nPantalla:\n- `resources/js/components/LeadsWhatsAppCampaign.vue`\n\nIntegración:\n- `resources/js/components/App.vue` (ruta `/leads/whatsapp`)\n- `resources/js/components/Sidebar.vue` (link en Pipeline, expandido y colapsado)\n\nFixes relevantes:\n- Validación del querystring: `only_with_phone` ahora se envía como `1/0`.\n- Conteos reales: se muestran totales y “sin teléfono” para ex"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 2400, "end": 3000, "text": "querystring: `only_with_phone` ahora se envía como `1/0`.\n- Conteos reales: se muestran totales y “sin teléfono” para explicar listas vacías.\n\n---\n\n## 4) Email masivo (informativo + unsubscribe)\n\n### 4.1 Base de datos\n\nMigración:\n- `database/migrations/2026_01_13_090000_create_email_campaigns_tables.php`\n\nTablas:\n- `email_campaigns`\n- `email_campaign_recipients`\n- `email_unsubscribes`\n\n### 4.2 Modelos\n\n- `app/Models/EmailCampaign.php`\n- `app/Models/EmailCampaignRecipient.php`\n- `app/Models/EmailUnsubscribe.php`\n\n### 4.3 Backend (API + envío por cola)\n\nControlador:\n- `app/Http/Controllers/Email"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 2880, "end": 3480, "text": "- `app/Models/EmailUnsubscribe.php`\n\n### 4.3 Backend (API + envío por cola)\n\nControlador:\n- `app/Http/Controllers/EmailCampaignController.php`\n\nEndpoints:\n- `GET /leads/email/recipients`\n  - Params: `source=leads|customers`, `stage_id` (leads), `q`, `limit`, `only_with_email`\n  - Respuesta: `contacts[]`, `stages[]`, `counts{total,with_email,without_email,returned}`\n  - Nota: **Ganado** se excluye para Leads.\n\n- `POST /leads/email-campaigns`\n  - Crea campaña con `source` + `ids[]` + `subject_template` + `body_template`.\n\n- `GET /leads/email-campaigns`\n- `GET /leads/email-campaigns/{campaign}`"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 3360, "end": 3960, "text": "ds[]` + `subject_template` + `body_template`.\n\n- `GET /leads/email-campaigns`\n- `GET /leads/email-campaigns/{campaign}`\n\n- `POST /leads/email-campaigns/{campaign}/send`\n  - Encola el envío por destinatario.\n  - Param opcional: `include_failed` para reintentar fallidos.\n\nPermisos:\n- Para `source=customers` se requiere `customers.view`.\n\nJob y Mailable:\n- `app/Jobs/SendEmailCampaignRecipientJob.php`\n- `app/Mail/EmailCampaignRecipientMailable.php`\n\n### 4.4 Unsubscribe (público)\n\nControlador:\n- `app/Http/Controllers/EmailUnsubscribeController.php`\n\nRuta pública:\n- `GET /email/unsubscribe?email=..."}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 3840, "end": 4440, "text": "Controlador:\n- `app/Http/Controllers/EmailUnsubscribeController.php`\n\nRuta pública:\n- `GET /email/unsubscribe?email=...&token=...`\n\nVistas:\n- `resources/views/email/unsubscribed.blade.php`\n- `resources/views/email/unsubscribe_invalid.blade.php`\n\nDetalles:\n- El token se genera con HMAC (`hash_hmac('sha256', email, APP_KEY)`), para evitar bajas “forjadas”.\n- Los emails desuscritos se guardan en `email_unsubscribes`.\n- Los envíos posteriores los omiten y marcan `skipped`.\n\n### 4.5 Frontend\n\nPantalla:\n- `resources/js/components/LeadsEmailCampaign.vue`\n\nIntegración:\n- `resources/js/components/App."}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 4320, "end": 4920, "text": "4.5 Frontend\n\nPantalla:\n- `resources/js/components/LeadsEmailCampaign.vue`\n\nIntegración:\n- `resources/js/components/App.vue` (ruta `/leads/email`)\n- `resources/js/components/Sidebar.vue` (link “Email masivo” en Pipeline)\n\n---\n\n## 5) Rutas agregadas\n\nArchivo:\n- `routes/web.php`\n\n- UI shell:\n  - `GET /leads/whatsapp`\n  - `GET /leads/email`\n\n- APIs WhatsApp:\n  - `GET /leads/whatsapp/recipients`\n  - `GET /leads/whatsapp-campaigns`\n  - `GET /leads/whatsapp-campaigns/{campaign}`\n  - `POST /leads/whatsapp-campaigns`\n  - `PATCH /leads/whatsapp-campaign-recipients/{recipient}`\n\n- APIs Email:\n  - `GET /"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 4800, "end": 5400, "text": "- `POST /leads/whatsapp-campaigns`\n  - `PATCH /leads/whatsapp-campaign-recipients/{recipient}`\n\n- APIs Email:\n  - `GET /leads/email/recipients`\n  - `GET /leads/email-campaigns`\n  - `GET /leads/email-campaigns/{campaign}`\n  - `POST /leads/email-campaigns`\n  - `POST /leads/email-campaigns/{campaign}/send`\n\n- Público:\n  - `GET /email/unsubscribe`\n\n---\n\n## 6) Configuración de correo (Gmail / Google Workspace)\n\n### 6.1 Desarrollo (sin enviar)\n\n- En `.env`:\n  - `MAIL_MAILER=log`\n\n### 6.2 Envío real por Gmail SMTP\n\nRecomendado: correo del dominio con Google Workspace.\n\n- En `.env`:\n  - `MAIL_MAILER=s"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 5280, "end": 5880, "text": "## 6.2 Envío real por Gmail SMTP\n\nRecomendado: correo del dominio con Google Workspace.\n\n- En `.env`:\n  - `MAIL_MAILER=smtp`\n  - `MAIL_HOST=smtp.gmail.com`\n  - `MAIL_PORT=587`\n  - `MAIL_ENCRYPTION=tls`\n  - `MAIL_USERNAME=tu_correo@tudominio.com`\n  - `MAIL_PASSWORD=APP_PASSWORD`\n  - `MAIL_FROM_ADDRESS=tu_correo@tudominio.com`\n  - `MAIL_FROM_NAME=\"CRM Atlantis\"`\n\n### 6.3 Cola (recomendado)\n\n- Configurar `QUEUE_CONNECTION` (ej: `database`)\n- Ejecutar worker:\n  - `php artisan queue:work --queue=mail`\n\n> Si `QUEUE_CONNECTION=sync`, el envío ocurre en la request.\n\n---\n\n## 7) Documentos relacionados"}, {"file": "docs\\2026-01-13-resumen-general.md", "start": 5760, "end": 6360, "text": "ue:work --queue=mail`\n\n> Si `QUEUE_CONNECTION=sync`, el envío ocurre en la request.\n\n---\n\n## 7) Documentos relacionados\n\n- `docs/2026-01-12-notas.md` (WhatsApp + fixes de UI y navegación)\n- `docs/2026-01-13-email-campanas.md` (Email masivo + configuración)\n\n---\n\n## 8) Próximos pasos sugeridos\n\n- Preview de email (render con destinatario ejemplo antes de crear/enviar).\n- Resumen de progreso en campaña (sent/failed/queued/pending).\n- Mejor UX para contactos sin teléfono/email (no seleccionables, etiquetas claras).\n- Panel de “configuración de correo” (pensando en vender el sistema por empresa)."}, {"file": "docs\\2026-01-16-notas.md", "start": 0, "end": 600, "text": "# 2026-01-16 — Notas / Avance\n\n## Objetivo\n- Hacer visible y asignable la UI de campañas de correo masivo y ordenar las opciones de mensajería masiva en el menú.\n\n## Hecho hoy\n- Permisos:\n  - Se aseguró la existencia del permiso `menu.email` en seeders (Spatie Permissions).\n  - Se ajustó la UI de Roles para que los permisos `menu.*` (módulos del menú) no dependan de una lista fija, sino que se construyan desde los permisos disponibles.\n\n- Menú (Sidebar):\n  - Se creó una nueva opción **“Bandeja de entrada”** con dropdown/flyout (hover cuando está colapsado), similar al comportamiento del menú d"}, {"file": "docs\\2026-01-16-notas.md", "start": 480, "end": 1080, "text": "opción **“Bandeja de entrada”** con dropdown/flyout (hover cuando está colapsado), similar al comportamiento del menú de Leads/Pipeline.\n  - Se movieron las opciones de mensajería masiva al nuevo menú:\n    - **WhatsApp masivo** → `/leads/whatsapp`\n    - **Email masivo** → `/leads/email`\n  - Se corrigió el resaltado del ícono de Leads/Pipeline para que NO se marque cuando el usuario está dentro de “Bandeja de entrada” (rutas `/leads/whatsapp` y `/leads/email`).\n\n## Archivos tocados (principales)\n- `resources/js/components/RolesTable.vue`\n  - Módulos del menú ahora se derivan dinámicamente desd"}, {"file": "docs\\2026-01-16-notas.md", "start": 960, "end": 1560, "text": "ocados (principales)\n- `resources/js/components/RolesTable.vue`\n  - Módulos del menú ahora se derivan dinámicamente desde los permisos `menu.*`.\n\n- `database/seeders/RolesAndPermissionsSeeder.php`\n  - Incluye `menu.email` dentro del set estándar de permisos.\n\n- `resources/js/components/Sidebar.vue`\n  - Nuevo menú: “Bandeja de entrada” (expandido + flyout colapsado).\n  - Removidas las entradas de WhatsApp/Email del dropdown de Leads/Pipeline.\n  - Fix de estado “active” para Pipeline/Leads usando match exacto en `/leads`.\n\n## Comandos usados / verificación\n- Seed permisos: `php artisan db:seed -"}, {"file": "docs\\2026-01-16-notas.md", "start": 1440, "end": 2040, "text": "peline/Leads usando match exacto en `/leads`.\n\n## Comandos usados / verificación\n- Seed permisos: `php artisan db:seed --class=RolesAndPermissionsSeeder`\n- Build assets: `npm run build`\n\n## Commits locales relevantes\n- `bd38116` Add menu.email permission to roles UI\n- `ef236c2` Derive menu modules from permissions\n- `6f0fb65` Show Email masivo in collapsed Pipeline dropdown\n- `150c769` Add Bandeja de entrada menu for mass messaging\n- `fb1a955` Fix Leads highlight when using Bandeja de entrada\n\n## Notas\n- El repo remoto sigue en `origin/main` con commit base `a0aac2a` (no se hizo push hoy).\n- Q"}, {"file": "docs\\2026-01-16-notas.md", "start": 1920, "end": 2168, "text": "andeja de entrada\n\n## Notas\n- El repo remoto sigue en `origin/main` con commit base `a0aac2a` (no se hizo push hoy).\n- Queda pendiente revisar por qué `npm run dev` estuvo fallando en este entorno (no bloquea producción si se usa `npm run build`)."}, {"file": "docs\\2026-01-23-calendario-cron.md", "start": 0, "end": 600, "text": "# Calendario: Scheduler + Cron (Hostinger)\n\nFecha: 2026-01-23\n\n## Objetivo\nHabilitar el envío automático de recordatorios del calendario según `reminder_minutes`.\n\n## Estado actual (funcionando)\n- Comando de recordatorios en `calendar:send-reminders`.\n- Scheduler ejecuta el comando cada minuto.\n- Cron en Hostinger dispara `schedule:run` cada minuto.\n- Notificaciones llegan correctamente al usuario asignado.\n\n## Archivos clave\n- app/Console/Kernel.php\n- app/Console/Commands/SendCalendarReminders.php\n- app/Notifications/CalendarEventReminderNotification.php\n- app/Http/Controllers/CalendarEventCo"}, {"file": "docs\\2026-01-23-calendario-cron.md", "start": 480, "end": 1080, "text": "ndCalendarReminders.php\n- app/Notifications/CalendarEventReminderNotification.php\n- app/Http/Controllers/CalendarEventController.php\n\n## Cron en Hostinger\nRuta final usada:\n\n`/usr/bin/php /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new/artisan schedule:run >> /dev/null 2>&1`\n\nNota: en el panel, si ya agrega `/usr/bin/php /home/u652153415/`, entonces solo se escribe:\n\n`domains/grupoatlantiscrm.eu/public_html/new/artisan schedule:run >> /dev/null 2>&1`\n\n## Cómo validar\n1. Crear un evento con `reminder_minutes` corto (1–2 min).\n2. Esperar 1–2 minutos.\n3. Verificar notificación en la"}, {"file": "docs\\2026-01-23-calendario-cron.md", "start": 960, "end": 1560, "text": "idar\n1. Crear un evento con `reminder_minutes` corto (1–2 min).\n2. Esperar 1–2 minutos.\n3. Verificar notificación en la app.\n4. Verificar resultado en “Cron Jobs” (Hostinger).\n\n## Nota de despliegue (UI calendario)\n- Los cambios visuales del calendario requieren **build** y subir los assets en `public/build/`.\n- Si el título del mes no se actualiza, ejecutar `npm run build` y desplegar los cambios.\n\n## Recomendaciones de mejora a futuro\n1. **Colas + Worker persistente**\n   - Mover el envío a cola para mayor escalabilidad.\n   - Configurar un worker persistente (Supervisor/systemd o Horizon si s"}, {"file": "docs\\2026-01-23-calendario-cron.md", "start": 1440, "end": 2040, "text": "Mover el envío a cola para mayor escalabilidad.\n   - Configurar un worker persistente (Supervisor/systemd o Horizon si se usa Redis).\n\n2. **Canales de notificación adicionales**\n   - Email o WhatsApp con preferencia por usuario.\n\n3. **Reintentos y fallback**\n   - Reintentos automáticos si falla el envío.\n   - Registro de fallos en tabla o log dedicado.\n\n4. **Optimización de consultas**\n   - Índice en `reminder_at` y `reminded_at` para acelerar el comando.\n\n5. **Zona horaria por usuario**\n   - Convertir `reminder_at` a la zona horaria del usuario si se requiere multi‑zona.\n\n6. **Panel de contro"}, {"file": "docs\\2026-01-23-calendario-cron.md", "start": 1920, "end": 2229, "text": "or usuario**\n   - Convertir `reminder_at` a la zona horaria del usuario si se requiere multi‑zona.\n\n6. **Panel de control**\n   - Vista administrativa para monitorear recordatorios enviados/pendientes.\n\n7. **Seguridad y control**\n   - Evitar duplicados usando `reminded_at` y bloqueo adicional si se requiere."}, {"file": "docs\\2026-01-24-fix-storage-and-cloudflare.md", "start": 0, "end": 600, "text": "# 2026-01-24 — Corrección: vendor, storage symlink y redirecciones Cloudflare\n\nResumen breve\n- Reproduje y resolví dos problemas principales mientras se intentaba levantar y usar el proyecto:\n  1. Error al ejecutar `php artisan serve` por dependencias faltantes (PHPUnit / sebastian/version).\n  2. En producción, las imágenes subidas (ícono/logo) no se mostraban en la web: faltaba exponer `storage/app/public` mediante `public/storage`, y además Cloudflare tenía reglas que redirigían el dominio a `vsbet.help` / `vsbet146.com`.\n\nAcciones realizadas (comandos y resultados)\n\n1) Restaurar dependencia"}, {"file": "docs\\2026-01-24-fix-storage-and-cloudflare.md", "start": 480, "end": 1080, "text": "igían el dominio a `vsbet.help` / `vsbet146.com`.\n\nAcciones realizadas (comandos y resultados)\n\n1) Restaurar dependencias en local\n\n  - `composer install --no-interaction --prefer-dist`\n  - Resultado: se instaló `sebastian/version` y otras dependencias; autoload regenerado. Con esto `php artisan serve` dejó de fallar por la clase faltante.\n\n2) Revisar flujo de subida de iconos (código)\n\n  - Archivo inspeccionado: `app/Http/Controllers/SettingsController.php`.\n  - Comportamiento: guarda en `storage/app/public/settings` y devuelve `asset('storage/settings/...')`.\n\n3) Diagnóstico en producción"}, {"file": "docs\\2026-01-24-fix-storage-and-cloudflare.md", "start": 960, "end": 1560, "text": "to: guarda en `storage/app/public/settings` y devuelve `asset('storage/settings/...')`.\n\n3) Diagnóstico en producción\n\n  - Verifiqué que el archivo existe en el origen:\n    - `ls -la storage/app/public/settings` → `logo_mark.png` presente.\n  - Verifiqué la presencia del enlace público:\n    - `ls -la public` inicialmente no mostraba `storage`.\n    - `readlink -f public/storage` devolvía una ruta, pero `stat public/storage` indicaba \"No such file or directory\" → symlink ausente/roto.\n\n4) Crear/rehacer el symlink público\n\n  - Comando recomendado (desde la raíz del proyecto):\n    - `php artisan st"}, {"file": "docs\\2026-01-24-fix-storage-and-cloudflare.md", "start": 1440, "end": 2040, "text": "/roto.\n\n4) Crear/rehacer el symlink público\n\n  - Comando recomendado (desde la raíz del proyecto):\n    - `php artisan storage:link`\n  - Alternativa manual:\n    - `rm -rf public/storage`\n    - `ln -s \"$(pwd)/storage/app/public\" public/storage`\n  - Verificación:\n    - `ls -la public/storage/settings` mostró `logo_mark.png`.\n\n5) Detectar redirección 301 (Cloudflare)\n\n  - `curl -I -L -v https://tu-dominio.com/storage/settings/logo_mark.png` devolvió un `301` que redirigía a `https://vsbet.help/...` y luego a `https://vsbet146.com/`.\n  - Cabeceras mostraron `server: cloudflare` — la redirección ven"}, {"file": "docs\\2026-01-24-fix-storage-and-cloudflare.md", "start": 1920, "end": 2520, "text": "s://vsbet.help/...` y luego a `https://vsbet146.com/`.\n  - Cabeceras mostraron `server: cloudflare` — la redirección venía del CDN/Cloudflare y no del origen.\n\n6) Solución de redirección\n\n  - Revisar y corregir en Cloudflare:\n    - Cloudflare → DNS: poner el registro A en `DNS only` (gris) para probar.\n    - Cloudflare → Page Rules: eliminar cualquier Forwarding URL / Redirect hacia `vsbet.*`.\n  - Alternativa de diagnóstico directo al origen (sin Cloudflare):\n    - `curl -I --resolve tu-dominio.com:443:YOUR_SERVER_IP https://tu-dominio.com/storage/settings/logo_mark.png`\n    - Si este comando"}, {"file": "docs\\2026-01-24-fix-storage-and-cloudflare.md", "start": 2400, "end": 3000, "text": "-resolve tu-dominio.com:443:YOUR_SERVER_IP https://tu-dominio.com/storage/settings/logo_mark.png`\n    - Si este comando devuelve `200`, el origen está bien y la causa era Cloudflare.\n\n7) Permisos (si devuelve 403)\n\n  - Cambiar propietario/permiso (ejemplo):\n    - `sudo chown -R www-data:www-data storage public/storage`\n    - `sudo chmod -R 775 storage public/storage`\n  - En hosting compartido sin `sudo`, probar `chmod -R 775 storage public/storage`.\n\n8) Parche temporal para cache del navegador (opcional)\n\n  - Para forzar que el cliente recargue tras subir una nueva imagen, se puede añadir cach"}, {"file": "docs\\2026-01-24-fix-storage-and-cloudflare.md", "start": 2880, "end": 3480, "text": "ache del navegador (opcional)\n\n  - Para forzar que el cliente recargue tras subir una nueva imagen, se puede añadir cache-busting en la respuesta JSON:\n    ```php\n    'path' => asset('storage/settings/logo_mark.png') . '?v=' . time(),\n    ```\n  - Archivo a modificar (opcional): `app/Http/Controllers/SettingsController.php` en `uploadLogoMark` y `uploadLogoFull`.\n\nNotas finales\n- Resultado final: se restauraron dependencias en local; en producción se creó/rehízo el `public/storage` y se eliminó la causa de redirección en Cloudflare, tras lo cual la URL pública devolvió `200 OK` y la imagen fue"}, {"file": "docs\\2026-01-24-fix-storage-and-cloudflare.md", "start": 3360, "end": 3821, "text": "rage` y se eliminó la causa de redirección en Cloudflare, tras lo cual la URL pública devolvió `200 OK` y la imagen fue visible.\n- Si vuelve a aparecer comportamiento extraño, revisar (1) Cloudflare Page Rules y modo proxy del registro DNS, (2) `.htaccess` / vhost, y (3) logs de Laravel en `storage/logs/laravel.log`.\n\nSi quieres, aplico el parche de cache-busting en el repo ahora o genero un pequeño script de verificación que puedas ejecutar en producción."}, {"file": "docs\\2026-01-24-resumen-sesion-logo.md", "start": 0, "end": 600, "text": "# 2026-01-24 — Resumen de sesión (logos, storage y caché)\n\n## Objetivo\nResolver problemas de subida/visualización de logos (ícono y logo largo), corregir cacheo, mejorar tamaño/claridad en el menú y asegurar despliegue correcto.\n\n---\n\n## 1) Error inicial al levantar local\n**Síntoma:** `php artisan serve` fallaba por clase faltante (`SebastianBergmann\\Version`).\n**Acción:** `composer install --no-interaction --prefer-dist`.\n**Resultado:** dependencias restauradas y autoload regenerado.\n\n---\n\n## 2) Subida de logos en producción no se veía\n**Hallazgos:**\n- El archivo sí se guardaba en `storage/ap"}, {"file": "docs\\2026-01-24-resumen-sesion-logo.md", "start": 480, "end": 1080, "text": "generado.\n\n---\n\n## 2) Subida de logos en producción no se veía\n**Hallazgos:**\n- El archivo sí se guardaba en `storage/app/public/settings`.\n- Faltaba o estaba roto `public/storage` (symlink), o el CDN/Cloudflare redirigía a dominios extraños.\n\n**Acciones:**\n- Verificación de symlink y creación con `php artisan storage:link` o `ln -s`.\n- Diagnóstico de redirecciones con `curl -I -L -v`.\n- Ajustes en Cloudflare (Page Rules/DNS) para quitar redirects externos.\n\n---\n\n## 3) Cache (cambios no se reflejaban)\n**Causa:** cache del navegador/Cloudflare. El archivo se actualizaba, pero la URL era la mism"}, {"file": "docs\\2026-01-24-resumen-sesion-logo.md", "start": 960, "end": 1560, "text": "(cambios no se reflejaban)\n**Causa:** cache del navegador/Cloudflare. El archivo se actualizaba, pero la URL era la misma.\n\n**Solución aplicada (la más estable):**\n- Guardar logos con nombre único por subida (timestamp) y mantener un **manifest** JSON para saber cuál es el actual.\n- Backend y vistas leen el manifest y sirven la URL nueva.\n\n**Resultado:** los cambios se reflejan con recarga simple (sin Ctrl+F5).\n\n---\n\n## 4) Calidad y tamaño en el menú\n**Problema:** el logo se veía pequeño o borroso.\n\n**Ajustes hechos:**\n- Aumentamos tamaño de render en sidebar.\n- Aumentamos resolución de imagen"}, {"file": "docs\\2026-01-24-resumen-sesion-logo.md", "start": 1440, "end": 2040, "text": "veía pequeño o borroso.\n\n**Ajustes hechos:**\n- Aumentamos tamaño de render en sidebar.\n- Aumentamos resolución de imagen procesada.\n- Añadimos **recorte automático de transparencia** para eliminar padding y que el logo “llene” mejor la caja.\n\n---\n\n## Cambios principales en código\n\n### Backend\n- [app/Http/Controllers/SettingsController.php](app/Http/Controllers/SettingsController.php)\n  - Resize del logo mark y logo full.\n  - Fallback seguro si falla el procesamiento.\n  - **Archivos versionados** (nombres únicos).\n  - **Manifest JSON** con el path actual.\n  - **Recorte de transparencia** antes"}, {"file": "docs\\2026-01-24-resumen-sesion-logo.md", "start": 1920, "end": 2520, "text": "chivos versionados** (nombres únicos).\n  - **Manifest JSON** con el path actual.\n  - **Recorte de transparencia** antes de redimensionar.\n\n### Vistas\n- [resources/views/dashboard.blade.php](resources/views/dashboard.blade.php)\n- [resources/views/layouts/guest.blade.php](resources/views/layouts/guest.blade.php)\n- [resources/views/components/application-logo.blade.php](resources/views/components/application-logo.blade.php)\n- [resources/views/settings/personalizacion.blade.php](resources/views/settings/personalizacion.blade.php)\n\nTodas leen el manifest para usar la URL actual y evitar caché.\n\n###"}, {"file": "docs\\2026-01-24-resumen-sesion-logo.md", "start": 2400, "end": 3000, "text": "resources/views/settings/personalizacion.blade.php)\n\nTodas leen el manifest para usar la URL actual y evitar caché.\n\n### UI (Vue)\n- [resources/js/components/Sidebar.vue](resources/js/components/Sidebar.vue)\n  - Se ajustó el tamaño de render para ocupar mejor la caja del header.\n- [resources/js/components/SettingsView.vue](resources/js/components/SettingsView.vue)\n  - Recomendaciones de tamaños actualizadas.\n\n---\n\n## Imágenes recomendadas\n- Ícono (mark): **PNG transparente 1:1** (256×256 o 512×512, sin padding).\n- Logo largo (full): **PNG transparente 4:1** (640×160 o 800×200, sin padding).\n\n--"}, {"file": "docs\\2026-01-24-resumen-sesion-logo.md", "start": 2880, "end": 3480, "text": "** (256×256 o 512×512, sin padding).\n- Logo largo (full): **PNG transparente 4:1** (640×160 o 800×200, sin padding).\n\n---\n\n## Flujo de despliegue usado\n1) `git push` en local.\n2) En servidor: `git pull`.\n3) Limpiar cachés (`php artisan view:clear`, `config:clear`, `cache:clear`, `route:clear`).\n4) Subir logo nuevamente para regenerar el archivo en nueva resolución.\n\n---\n\n## Estado final\n- Subida funciona.\n- Cambios visibles con recarga simple.\n- Logos ocupan mejor su espacio y con mejor calidad.\n\n---\n\nSi mañana hay que afinar más el tamaño del logo, bastará con ajustar los tamaños de render en"}, {"file": "docs\\2026-01-24-resumen-sesion-logo.md", "start": 3360, "end": 3557, "text": "y con mejor calidad.\n\n---\n\nSi mañana hay que afinar más el tamaño del logo, bastará con ajustar los tamaños de render en `Sidebar.vue` y la resolución de procesamiento en `SettingsController.php`."}, {"file": "docs\\chatbot-poc.md", "start": 0, "end": 600, "text": "# Chatbot POC (búsqueda de documentación)\n\nEste POC proporciona un endpoint simple que busca en la carpeta `docs/` los archivos que coinciden con la consulta del usuario y devuelve extractos relevantes. Objetivo: validar flujo RAG básico sin capacidades de LLM ni embeddings todavía.\n\nEndpoint\n- `POST /api/chatbot/query` (POC)\n- Body JSON: `{ \"q\": \"texto de la pregunta\" }`\n\nQué devuelve\n- JSON con `data` => array de up to 5 items: `{ file, score, snippet }`.\n\nLimitaciones del POC\n- Búsqueda textual simple (conteo de tokens), sin embeddings ni semántica.\n- No autenticado — proteger en producción"}, {"file": "docs\\chatbot-poc.md", "start": 480, "end": 1080, "text": "POC\n- Búsqueda textual simple (conteo de tokens), sin embeddings ni semántica.\n- No autenticado — proteger en producción.\n- Latencia proporcional al número de archivos en `docs/` (este POC lee archivos en cada request).\n\nPasos siguientes recomendados (mejoras)\n1. Indexar e insertar en vector DB local (FAISS) y usar embeddings (`sentence-transformers`) para búsqueda semántica.\n2. Añadir pipeline que precompute embeddings y actualice índice cuando se agreguen documentos.\n3. Implementar RAG: recuperar top-k + opcional generación con LLM (o plantillas) para mejorar respuestas.\n4. Proteger el endpo"}, {"file": "docs\\chatbot-poc.md", "start": 960, "end": 1560, "text": "lementar RAG: recuperar top-k + opcional generación con LLM (o plantillas) para mejorar respuestas.\n4. Proteger el endpoint con autenticación y cuota, y agregar caché para respuestas frecuentes.\n\nCómo probar localmente\n1. Arranca servidor Laravel:\n```bash\nphp artisan serve\n```\n2. Llamada ejemplo (curl):\n```bash\ncurl -X POST http://127.0.0.1:8000/api/chatbot/query \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"q\": \"¿cómo sincronizo permisos?\"}'\n```\n\nIntegración futura con interfaz\n- Podemos exponer un modal/chat en el dashboard que consuma este endpoint y muestre las coincidencias y recomend"}, {"file": "docs\\chatbot-poc.md", "start": 1440, "end": 1585, "text": "nterfaz\n- Podemos exponer un modal/chat en el dashboard que consuma este endpoint y muestre las coincidencias y recomendaciones de acción.\n\nFin."}, {"file": "docs\\cron-endpoint.md", "start": 0, "end": 600, "text": "**Cron Endpoint (Fallback) — Setup and usage**\n\n- **Purpose:** provide a protected HTTP endpoint that triggers `php artisan schedule:run` and a single `queue:work --once` run. Use an external cron service (cron-job.org, easycron) to call it every minute when Hostinger's cron panel or `crontab` is unreliable.\n\n- **Files changed:** `routes/web.php` — added POST `/_internal/cron/{token}`.\n\n- **Add to `.env`:**\n\n  CRON_TOKEN=replace_with_a_long_random_string\n\n- **How to test locally / from your machine:**\n\n```bash\n# Example (replace <TOKEN> and domain)\ncurl -X POST https://grupoatlantiscrm.eu/new/"}, {"file": "docs\\cron-endpoint.md", "start": 480, "end": 1080, "text": "lly / from your machine:**\n\n```bash\n# Example (replace <TOKEN> and domain)\ncurl -X POST https://grupoatlantiscrm.eu/new/_internal/cron/<TOKEN>\n```\n\nExpected response: `OK` (HTTP 200). Check Laravel logs and queue behavior to confirm jobs ran.\n\n- **Configure cron-job.org (example):**\n  - Create a free account.\n  - Add a new job:\n    - URL: `https://grupoatlantiscrm.eu/new/_internal/cron/<TOKEN>`\n    - Method: POST\n    - Interval: 1 minute\n\n- **Security notes:**\n  - Keep `CRON_TOKEN` secret and long (32+ chars).\n  - Use HTTPS only. Consider IP allowlisting or short-lived tokens if needed.\n\n- **D"}, {"file": "docs\\cron-endpoint.md", "start": 960, "end": 1302, "text": "TOKEN` secret and long (32+ chars).\n  - Use HTTPS only. Consider IP allowlisting or short-lived tokens if needed.\n\n- **Deploy:**\n  - Commit and deploy the code change to production (or paste the route snippet into `routes/web.php`).\n  - Add `CRON_TOKEN` to the production `.env`.\n  - Configure the external cron to POST the URL every minute."}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 0, "end": 600, "text": "# Deploy en Hostinger (hPanel) a subdominio — CRMATLANTIS (Laravel)\n\nEsta guía documenta el proceso real usado para subir este proyecto Laravel a un **subdominio** en Hostinger usando **Auto Deploy (Git)**, y cómo resolvimos los errores típicos (500 por cachés de bootstrap, APP_KEY, Vite manifest, etc.).\n\n## Objetivo\n\n- Subir el proyecto a un subdominio (ej. `new.grupoatlantiscrm.eu`) **sin interferir** con el dominio principal.\n- Mantener la estructura correcta de Laravel:\n  - Código completo en una carpeta privada del sitio (ej. `.../public_html/new`)\n  - Servir públicamente solo `public/` ("}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 480, "end": 1080, "text": "- Código completo en una carpeta privada del sitio (ej. `.../public_html/new`)\n  - Servir públicamente solo `public/` (ej. `.../public_html/new/public`)\n\n## 1) Rutas correctas (lo más importante)\n\n### Carpeta donde se despliega el repo (Auto Deploy)\n\n- **Repo →** `/home/u652153415/domains/grupoatlantiscrm.eu/public_html/new`\n\nAhí deben existir `artisan`, `composer.json`, `app/`, `routes/`, `public/`, etc.\n\n### Carpeta raíz del subdominio (\"Document Root\" en concepto)\n\nEn Hostinger no suele llamarse “DocumentRoot”; es el campo de **Carpeta/Directorio/Ruta** del subdominio.\n\n- **Subdominio →**"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 960, "end": 1560, "text": "tinger no suele llamarse “DocumentRoot”; es el campo de **Carpeta/Directorio/Ruta** del subdominio.\n\n- **Subdominio →** `/home/u652153415/domains/grupoatlantiscrm.eu/public_html/new/public`\n\nEsto evita exponer `.env`, `storage/`, etc.\n\n## 2) Preparación de `.env` (servidor)\n\nEn el servidor, dentro de la carpeta del proyecto:\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\n```\n\nCrear `.env` desde el ejemplo:\n\n```bash\ncp .env.example .env\n```\n\nEditar `.env` (ej. con `nano`):\n\n```bash\nnano .env\n```\n\nSalir guardando en nano:\n- `Ctrl+O` → Enter → `Ctrl+X`\n\nValores mínimos:"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 1440, "end": 2040, "text": "env` (ej. con `nano`):\n\n```bash\nnano .env\n```\n\nSalir guardando en nano:\n- `Ctrl+O` → Enter → `Ctrl+X`\n\nValores mínimos:\n- `APP_ENV=production`\n- `APP_DEBUG=false`\n- `APP_URL=https://new.grupoatlantiscrm.eu`\n- `DB_CONNECTION=mysql`\n- `DB_HOST=localhost` (en Hostinger suele funcionar si la BD es local)\n- `DB_PORT=3306`\n- `DB_DATABASE=...`\n- `DB_USERNAME=...`\n- `DB_PASSWORD=...`\n\nNotas:\n- Si `DB_CONNECTION=sqlite`, Laravel ignorará `DB_HOST/DB_USERNAME/...`.\n\n## 3) Composer (servidor)\n\n### Instalación limpia (recomendado si hubo errores previos)\n\nSi `composer install --no-dev` falla con mensajes"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 1920, "end": 2520, "text": "vidor)\n\n### Instalación limpia (recomendado si hubo errores previos)\n\nSi `composer install --no-dev` falla con mensajes tipo “Could not scan for classes…” es señal de que `vendor/` quedó inconsistente.\n\nSolución:\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\nrm -rf vendor\ncomposer install --no-dev --prefer-dist --no-interaction --optimize-autoloader\n```\n\nSi por scripts fallara (plan B):\n\n```bash\nrm -rf vendor\ncomposer install --no-dev --prefer-dist --no-interaction --optimize-autoloader --no-scripts\nphp artisan package:discover --ansi\n```\n\n## 4) APP_KEY (obligatorio)"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 2400, "end": 3000, "text": "--no-interaction --optimize-autoloader --no-scripts\nphp artisan package:discover --ansi\n```\n\n## 4) APP_KEY (obligatorio)\n\nSi aparece en logs:\n> `No application encryption key has been specified.`\n\nEjecutar:\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\nphp artisan key:generate\nphp artisan optimize:clear\nphp artisan config:cache\n```\n\nVerificar que existe:\n\n```bash\ngrep -n \"APP_KEY\" .env\n```\n\n## 5) Cachés de bootstrap (PailServiceProvider / providers cache)\n\nSíntoma:\n> `Class \"Laravel\\Pail\\PailServiceProvider\" not found`\n\nCausa:\n- Se desplegaron archivos generados de `"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 2880, "end": 3480, "text": "cache)\n\nSíntoma:\n> `Class \"Laravel\\Pail\\PailServiceProvider\" not found`\n\nCausa:\n- Se desplegaron archivos generados de `bootstrap/cache/*.php` que referencian paquetes dev.\n\nSolución inmediata en servidor:\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\nrm -f bootstrap/cache/services.php bootstrap/cache/packages.php bootstrap/cache/config.php bootstrap/cache/events.php bootstrap/cache/routes.php bootstrap/cache/routes-v7.php\nphp artisan optimize:clear\n```\n\nSolución permanente (repo):\n- Ignorar `bootstrap/cache/*.php` en git (no se deben versionar).\n\n## 6) Permisos de e"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 3360, "end": 3960, "text": "```\n\nSolución permanente (repo):\n- Ignorar `bootstrap/cache/*.php` en git (no se deben versionar).\n\n## 6) Permisos de escritura (storage/cache)\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\nchmod -R 775 storage bootstrap/cache\n```\n\n## 7) BD y migraciones\n\nSi al limpiar cachés aparece:\n> `SQLSTATE[HY000] [1045] Access denied ...`\n\nCausa:\n- Credenciales incorrectas o usuario sin permisos en la BD.\n\nLuego de corregir `.env` en Hostinger (y asignar permisos al usuario en la base), correr:\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\nphp artis"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 3840, "end": 4440, "text": "misos al usuario en la base), correr:\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\nphp artisan migrate --force\n```\n\n## 8) Vite / assets (Hostinger sin node/npm)\n\n### Problema\nEn Hostinger (según este caso) **no hay** `node`/`npm`:\n\n- `node -v` → `command not found`\n- `npm -v` → `command not found`\n\nEntonces no se puede hacer `npm run build` en el servidor.\n\nEl error típico en Laravel:\n- `Vite manifest not found at: public/build/manifest.json`\n\n### Solución usada\n- Compilar assets **en local** y subir `public/build` al repo para que el autodeploy lo despliegue.\n\nEn l"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 4320, "end": 4920, "text": "Solución usada\n- Compilar assets **en local** y subir `public/build` al repo para que el autodeploy lo despliegue.\n\nEn local:\n\n```bash\ncd C:\\xampp\\htdocs\\CRMATLANTIS\nnpm install\nnpm run build\n```\n\nLuego:\n- Asegurar que `public/build` NO esté ignorado por git.\n- Commit/push incluyendo `public/build`.\n\n## 9) Imagen de fondo del login y manifest\n\nProblema:\n- `Unable to locate file in Vite manifest: resources/images/fondo_login.jpg`\n\nSolución usada:\n- Servir esa imagen desde `public/images` y usar `asset('images/...')` en vez de `Vite::asset(...)`.\n\n## 10) Admin sin restricciones (backend + menú d"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 4800, "end": 5400, "text": "lic/images` y usar `asset('images/...')` en vez de `Vite::asset(...)`.\n\n## 10) Admin sin restricciones (backend + menú del SPA)\n\nProblema observado:\n- El rol `admin` existía, pero la UI mostraba solo Dashboard.\n\nCausa:\n- El menú del SPA se decide por `permissions` enviadas en `window.__AUTH_USER__`.\n\nSolución usada:\n- Backend: `Gate::before(...)` para que `admin` pase cualquier check.\n- Frontend payload: si el usuario es `admin`, enviarle todas las permissions para que el sidebar muestre todo.\n\n## 11) Seeder de admin\n\nExiste un seeder llamado `InternalUserSeeder` que crea/asegura el usuario ad"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 5280, "end": 5880, "text": "ebar muestre todo.\n\n## 11) Seeder de admin\n\nExiste un seeder llamado `InternalUserSeeder` que crea/asegura el usuario admin y le asigna rol `admin`.\n\nFue mejorado para:\n- No hardcodear credenciales.\n- Solo cambiar password si `SEED_ADMIN_PASSWORD` está definido.\n\nEjemplo de variables en `.env` (servidor):\n\n- `SEED_ADMIN_NAME=Administrador`\n- `SEED_ADMIN_EMAIL=admin@tudominio.com`\n- `SEED_ADMIN_PASSWORD=TuPasswordSegura123!`\n\nEjecutar:\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\nphp artisan db:seed --class='Database\\\\Seeders\\\\InternalUserSeeder' --force\n```\n\n## 12)"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 5760, "end": 6360, "text": "oatlantiscrm.eu/public_html/new\nphp artisan db:seed --class='Database\\\\Seeders\\\\InternalUserSeeder' --force\n```\n\n## 12) Checklist final (producción)\n\nEn servidor:\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\nphp artisan optimize:clear\nphp artisan config:cache\nphp artisan route:cache\nphp artisan view:cache\nphp artisan migrate --force\nphp artisan storage:link\n```\n\nVerificar:\n- `public/build/manifest.json` existe\n- Login carga y el admin ve el menú completo\n\n## 13) Diagnóstico rápido de errores\n\nVer los últimos errores de Laravel:\n\n```bash\ncd /home/u652153415/domains/g"}, {"file": "docs\\deploy-hostinger-subdominio.md", "start": 6240, "end": 6537, "text": "mpleto\n\n## 13) Diagnóstico rápido de errores\n\nVer los últimos errores de Laravel:\n\n```bash\ncd /home/u652153415/domains/grupoatlantiscrm.eu/public_html/new\ngrep -n \"production.ERROR\" storage/logs/laravel.log | tail -n 10\n```\n\nVer el final del log:\n\n```bash\ntail -n 200 storage/logs/laravel.log\n```"}, {"file": "docs\\deploy-process.md", "start": 0, "end": 600, "text": "# Proceso de despliegue (CRM ATLANTIS)\n\nEste documento captura el flujo de despliegue recomendado y los comandos exactos para no olvidar pasos críticos relacionados con permisos, migraciones y caches.\n\nResumen rápido\n- El pipeline/CI ejecuta verificaciones, migraciones de prueba y sincroniza permisos (`permissions:sync`).\n- En el servidor de producción seguir el orden: actualizar código → migrar → sincronizar permisos → (opcional) ejecutar seeders → limpiar caches → reiniciar workers.\n\n1) Preparación local / PR\n- Commit y push del branch:\n\n```bash\ngit add .\ngit commit -m \"feat: ...\"\ngit push o"}, {"file": "docs\\deploy-process.md", "start": 480, "end": 1080, "text": "workers.\n\n1) Preparación local / PR\n- Commit y push del branch:\n\n```bash\ngit add .\ngit commit -m \"feat: ...\"\ngit push origin feature/x\n```\n\n- Abrir PR y revisar cambios de rutas/permisos.\n\n2) Qué hace CI (recomendado)\n- Checkout, instalar dependencias.\n- Ejecuta migraciones sobre DB de prueba.\n- Ejecuta `php artisan permissions:sync` (detecta y crea permisos desde middleware `permission:`).\n- Ejecuta opcionalmente `php artisan db:seed --class=RolesAndPermissionsSeeder` (en CI es seguro; en prod evaluar antes).\n- Limpia caches.\n\n3) Deploy en servidor (pasos detallados)\n\n- (Opcional) Poner la a"}, {"file": "docs\\deploy-process.md", "start": 960, "end": 1560, "text": "I es seguro; en prod evaluar antes).\n- Limpia caches.\n\n3) Deploy en servidor (pasos detallados)\n\n- (Opcional) Poner la app en mantenimiento:\n\n```bash\nphp artisan down\n```\n\n- Actualizar código y dependencias:\n\n```bash\ngit pull origin main\ncomposer install --no-interaction --no-dev --prefer-dist\nnpm ci && npm run build  # si se modificó frontend\n```\n\n- Ejecutar migraciones y sincronizar permisos (orden recomendado):\n\nSi tus seeders dependen de permisos existentes:\n```bash\nphp artisan migrate --force\nphp artisan permissions:sync\nphp artisan db:seed --class=RolesAndPermissionsSeeder   # opcional,"}, {"file": "docs\\deploy-process.md", "start": 1440, "end": 2040, "text": "rtisan migrate --force\nphp artisan permissions:sync\nphp artisan db:seed --class=RolesAndPermissionsSeeder   # opcional, revisar efecto\n```\n\nSi no ejecutas seeders globales en prod y prefieres crear permisos antes:\n```bash\nphp artisan permissions:sync\nphp artisan migrate --force\n```\n\n- Limpiar caches y reiniciar workers:\n\n```bash\nphp artisan cache:clear\nphp artisan config:clear\nphp artisan route:clear\nphp artisan view:clear\nphp artisan optimize:clear\nphp artisan queue:restart\n```\n\n- Sacar la app de mantenimiento:\n\n```bash\nphp artisan up\n```\n\n4) Consideraciones y avisos\n- `php artisan permission"}, {"file": "docs\\deploy-process.md", "start": 1920, "end": 2520, "text": "```\n\n- Sacar la app de mantenimiento:\n\n```bash\nphp artisan up\n```\n\n4) Consideraciones y avisos\n- `php artisan permissions:sync` usa `updateOrCreate` — es idempotente.\n- `RolesAndPermissionsSeeder` reasigna permisos a `admin` y `dev`; no ejecutarlo en producción sin querer esa reasignación. Para agregar sólo permisos de un módulo, ejecutar el seeder del módulo generado (ej. `PermissionModuleXSeeder`).\n- Hacer backup de la BD antes de migraciones en producción.\n- En despliegues con múltiples instancias, ejecutar los comandos de limpieza de cache y `queue:restart` en cada instancia o coordinar me"}, {"file": "docs\\deploy-process.md", "start": 2400, "end": 3000, "text": "con múltiples instancias, ejecutar los comandos de limpieza de cache y `queue:restart` en cada instancia o coordinar mediante orquestador.\n- Si hay cambios en rutas o permisos, ejecutar `php artisan permissions:sync` en CI y en producción para mantener consistencia.\n\n5) Checklist rápido (copiar/pegar durante deploy)\n- [ ] Hacer backup DB\n- [ ] git pull origin main\n- [ ] composer install\n- [ ] npm build (si aplica)\n- [ ] php artisan migrate --force\n- [ ] php artisan permissions:sync\n- [ ] (opcional) php artisan db:seed --class=RolesAndPermissionsSeeder\n- [ ] php artisan cache:clear && config:c"}, {"file": "docs\\deploy-process.md", "start": 2880, "end": 3319, "text": "ns:sync\n- [ ] (opcional) php artisan db:seed --class=RolesAndPermissionsSeeder\n- [ ] php artisan cache:clear && config:clear && route:clear && view:clear\n- [ ] php artisan queue:restart\n- [ ] php artisan up\n\n6) Ubicación de referencia\n- Archivo CI ejemplo: `.github/workflows/permissions-sync.yml`\n- Comando para generar módulo: `php artisan make:module {name} [--prefix]`\n- Documentación de permisos: `docs/permissions-workflow.md`\n\nFin."}, {"file": "docs\\manual_usuario.txt", "start": 0, "end": 600, "text": "MANUAL DE USUARIO — CRM ATLANTIS\nFecha: 2026-01-23\n\nObjetivo\nEste manual explica de forma simple las funciones del sistema y cómo usar cada sección.\n\n1) Acceso y navegación\n- Iniciar sesión con tu usuario y contraseña.\n- Usa el menú lateral para ir a cada módulo.\n- El título superior muestra la sección actual.\n\n2) Dashboard (Inicio)\nQué ves:\n- KPIs y métricas resumidas según tus permisos.\n- Listas rápidas de trabajo: próximos eventos, certificados por vencer, últimos leads e incidencias.\nPara qué sirve:\n- Tener un panorama rápido del trabajo pendiente.\n\n3) Leads (Pipeline)\n3.1 Pipeline (Vista"}, {"file": "docs\\manual_usuario.txt", "start": 480, "end": 1080, "text": "incidencias.\nPara qué sirve:\n- Tener un panorama rápido del trabajo pendiente.\n\n3) Leads (Pipeline)\n3.1 Pipeline (Vista Kanban)\n- Muestra oportunidades por etapas.\n- Arrastra tarjetas entre etapas para actualizar el estado.\n- Ideal para seguimiento diario del embudo.\n\n3.2 Leads (Vista Lista)\n- Lista completa con filtros y búsqueda.\n- Permite editar, actualizar estado y datos del lead.\n\n3.3 Desistidos\n- Lista de leads marcados como desistidos.\n- Sirve para mantener histórico y reportes.\n\n3.4 Zona de espera\n- Leads en pausa temporal.\n- Útil para reactivar en el futuro.\n\n4) Clientes\n- Listado gen"}, {"file": "docs\\manual_usuario.txt", "start": 960, "end": 1560, "text": "reportes.\n\n3.4 Zona de espera\n- Leads en pausa temporal.\n- Útil para reactivar en el futuro.\n\n4) Clientes\n- Listado general de clientes.\n- Acceso a datos principales y seguimiento.\n\n5) Agenda y recordatorios (Calendario)\n- Crea eventos y recordatorios.\n- Visualiza próximos compromisos.\n- Recibes notificaciones de eventos asignados.\n\n6) Incidencias (Postventa)\n6.1 Incidencias (Vista Lista)\n- Registro y seguimiento de incidencias.\n- Estado, responsable y fechas.\n\n6.2 Backlog (Vista tablero)\n- Vista tipo tablero para priorizar y mover incidencias por etapas.\n\n7) Postventa\n7.1 Clientes (Postventa"}, {"file": "docs\\manual_usuario.txt", "start": 1440, "end": 2040, "text": "Vista tablero)\n- Vista tipo tablero para priorizar y mover incidencias por etapas.\n\n7) Postventa\n7.1 Clientes (Postventa)\n- Clientes en fase postventa.\n\n7.2 Contadores\n- Gestión de contadores relacionados a clientes.\n\n7.3 Certificados\n- Gestión de certificados y fechas importantes.\n- Alertas/recordatorios por vencimiento.\n\n8) Bandeja de entrada (Comunicaciones)\n8.1 WhatsApp masivo (manual asistido)\nQué hace:\n- El sistema NO envía mensajes.\n- Genera mensajes personalizados y abre WhatsApp con el texto listo.\n\nCómo usarlo:\n1) Selecciona origen: Leads o Clientes.\n2) Filtra por etapa (solo leads),"}, {"file": "docs\\manual_usuario.txt", "start": 1920, "end": 2520, "text": "bre WhatsApp con el texto listo.\n\nCómo usarlo:\n1) Selecciona origen: Leads o Clientes.\n2) Filtra por etapa (solo leads), busca por nombre o limita cantidad.\n3) Opcional: “Solo con teléfono”.\n4) Escribe el mensaje y usa variables:\n   - {{first_name}}  (nombre)\n   - {{company_name}} (empresa)\n5) Selecciona destinatarios y crea la campaña.\n6) Abre WhatsApp y marca el estado (abierto/enviado).\n\n8.2 Email masivo (informativo, con envío automático)\nQué hace:\n- El sistema SÍ envía correos (cola de envío).\n- Incluye enlace de baja automática (unsubscribe).\n\nCómo usarlo:\n1) Selecciona origen: Leads o C"}, {"file": "docs\\manual_usuario.txt", "start": 2400, "end": 3000, "text": "orreos (cola de envío).\n- Incluye enlace de baja automática (unsubscribe).\n\nCómo usarlo:\n1) Selecciona origen: Leads o Clientes.\n2) Define asunto y cuerpo con variables (si están disponibles).\n3) Selecciona destinatarios y crea la campaña.\n4) Ejecuta el envío. El sistema procesa en segundo plano.\n5) Revisa el historial y estados (enviado, fallido, omitido).\n\n9) Usuarios\n- Gestión de usuarios del sistema.\n- Crear, editar o desactivar usuarios.\n\n10) Roles y permisos\n- Crear roles y asignar permisos.\n- Los permisos controlan qué módulos se ven en el menú.\n\n11) Configuración\n- Personalización gene"}, {"file": "docs\\manual_usuario.txt", "start": 2880, "end": 3480, "text": "es y asignar permisos.\n- Los permisos controlan qué módulos se ven en el menú.\n\n11) Configuración\n- Personalización general del sistema.\n- Ajustes visibles solo para perfiles con permiso.\n\n12) Buenas prácticas\n- Mantén datos actualizados en Leads y Clientes.\n- Usa el Pipeline para el trabajo diario.\n- Registra incidencias apenas ocurran.\n- En campañas, revisa primero los destinatarios antes de enviar.\n- Si faltan opciones de menú, consulta a un administrador de permisos.\n\n13) Soporte rápido\n- Si no ves una sección, es probable que te falte permiso.\n- Para errores de envío de email, valida que"}, {"file": "docs\\manual_usuario.txt", "start": 3360, "end": 3579, "text": "Soporte rápido\n- Si no ves una sección, es probable que te falte permiso.\n- Para errores de envío de email, valida que el correo del sistema esté configurado.\n- Para WhatsApp, recuerda que el envío es manual asistido."}, {"file": "docs\\mapping_old_to_new.md", "start": 0, "end": 600, "text": "# Mapeo de campos — Sistema antiguo -> Nuevo sistema\n\nEste documento contiene el mapeo inicial de las tablas y atributos del sistema antiguo (ver `docs/tablas_y_atributos.txt`) hacia las tablas/modelos del nuevo proyecto Laravel.\n\n## Notas generales\n- Campos no existentes en el modelo nuevo se marcan como `--` y requieren decisión: crear columna, guardar en `observacion`/`notes`, o descartar.\n- Relacionar `cliente_id` normalmente a `customer_id` en `Customer` model.\n- Para imports: exportar CSV con los encabezados indicados en la columna `old_field`.\n\n---\n\n### clientes -> `Customer` (app/Model"}, {"file": "docs\\mapping_old_to_new.md", "start": 480, "end": 1080, "text": "ports: exportar CSV con los encabezados indicados en la columna `old_field`.\n\n---\n\n### clientes -> `Customer` (app/Models/Customer.php)\n\nold_field -> new_field (nota)\n- id -> id\n- nombre -> name\n- empresa -> company_name\n- tipo -> document_type? (revisar significado)\n- documento -> document_number\n- telefono -> contact_phone\n- correo -> contact_email\n- motivo -> -- (mover a `observacion`/notes en Lead/Customer)\n- ciudad -> company_address? (o `observacion`)\n- migracion -> migracion (Lead model tiene migracion; Customer no) -> guardar en `observacion` o crear columna\n- referencia -> -- (observa"}, {"file": "docs\\mapping_old_to_new.md", "start": 960, "end": 1560, "text": "racion (Lead model tiene migracion; Customer no) -> guardar en `observacion` o crear columna\n- referencia -> -- (observacion)\n- fecha_contacto -> -- (no hay campo directo) -> guardar en `observacion` o crear campo\n- fecha_creacion -> created_at\n- estado -> -- (mapear a estado/active si aplica)\n- post_precio -> -- (no equivalente)\n- post_rubro -> --\n- post_ano -> --\n- post_mes -> --\n- post_link -> --\n- post_usuario -> -- (sensible)\n- post_contrasena -> -- (NO subir credenciales; descartar)\n\nRecomendación: exportar estos campos y decidir por cada uno si crear columna en `customers` o guardarlos"}, {"file": "docs\\mapping_old_to_new.md", "start": 1440, "end": 2040, "text": "s; descartar)\n\nRecomendación: exportar estos campos y decidir por cada uno si crear columna en `customers` o guardarlos en `observacion`/metadatos.\n\n---\n\n### actividades -> `CalendarEvent` (app/Models/CalendarEvent.php)\n\nold_field -> new_field (nota)\n- id -> id\n- cliente_id -> related_id (set `related_type` = `App\\\\Models\\\\Customer`)\n- usuario_id -> assigned_to (o created_by según origen)\n- tipo -> -- (guardar en `description` o crear `type`)\n- asunto -> title\n- fecha_hora -> start_at (usar `start_at`; `end_at` puede quedar null)\n- resultado -> description (concatenar al final)\n\nRecomendación:"}, {"file": "docs\\mapping_old_to_new.md", "start": 1920, "end": 2520, "text": "start_at (usar `start_at`; `end_at` puede quedar null)\n- resultado -> description (concatenar al final)\n\nRecomendación: durante import set `related_type` y `related_id` para vincular al cliente.\n\n---\n\n### clientes_backup\nSemejante a `clientes`. Tratar como respaldo; importar solo si es necesario.\n\n---\n\n### contador -> `Contador` (app/Models/Contador.php -> tabla `contadores`)\n\nold_field -> new_field\n- id -> id\n- nro -> nro\n- comercio -> comercio\n- nom_contador -> nom_contador\n- titular_tlf -> titular_tlf\n- telefono -> telefono\n- telefono_actu -> telefono_actu\n- link -> link\n- usuario -> usuar"}, {"file": "docs\\mapping_old_to_new.md", "start": 2400, "end": 3000, "text": "r\n- titular_tlf -> titular_tlf\n- telefono -> telefono\n- telefono_actu -> telefono_actu\n- link -> link\n- usuario -> usuario\n- contrasena -> contrasena (sensible)\n- created_at -> created_at\n\nNota: tabla nueva se llama `contadores`. Pivot `contadores_clientes` -> `contador_customer`.\n\n---\n\n### contadores_clientes -> pivot `contador_customer`\n\n- id -> -- (pivot)\n- contador_id -> contador_id\n- cliente_id -> customer_id\n- fecha_asignacion -> pivot `fecha_asignacion`\n\n---\n\n### evento -> (posible catálogo) -> `CalendarEvent` o tabla de tipos\n\n- id -> id\n- titulo -> title\n- color -> -- (si el calendari"}, {"file": "docs\\mapping_old_to_new.md", "start": 2880, "end": 3480, "text": "o -> (posible catálogo) -> `CalendarEvent` o tabla de tipos\n\n- id -> id\n- titulo -> title\n- color -> -- (si el calendario usa colores, mapear)\n\n---\n\n### incidencias -> `Incidence` (app/Models/Incidence.php)\n\nold_field -> new_field\n- id -> id\n- correlativo -> correlative\n- nombre_incidencia -> title\n- cliente_id -> customer_id\n- usuario_id -> created_by\n- fecha -> date\n- prioridad -> priority\n- observaciones -> notes\n- fecha_creacion -> created_at\n- columna_backlog -> stage_id? (mapear al `IncidenceStage` según valor)\n\nNota: convertir `columna_backlog` a `stage_id` haciendo una tabla de traducc"}, {"file": "docs\\mapping_old_to_new.md", "start": 3360, "end": 3960, "text": "? (mapear al `IncidenceStage` según valor)\n\nNota: convertir `columna_backlog` a `stage_id` haciendo una tabla de traducción entre nombres/posiciones.\n\n---\n\n### oportunidades -> `Lead` (app/Models/Lead.php)\n\nold_field -> new_field\n- id -> id\n- cliente_id -> customer_id\n- usuario_id -> created_by\n- titulo -> name\n- descripcion -> observacion\n- valor_estimado -> amount\n- probabilidad -> -- (mapear a stage/probabilidad en LeadStage)\n- estado -> archived_at / stage? (revisar workflow)\n- fecha_apertura -> created_at or migracion? (revisar)\n- fecha_cierre_estimada -> won_at? (revisar meaning)\n- fecha"}, {"file": "docs\\mapping_old_to_new.md", "start": 3840, "end": 4440, "text": "low)\n- fecha_apertura -> created_at or migracion? (revisar)\n- fecha_cierre_estimada -> won_at? (revisar meaning)\n- fecha_modificacion -> updated_at\n- alta_prioridad -> -- (guardar en observacion)\n- actividad -> -- (link to activity/CalendarEvent)\n- fecha_actividad -> --\n\nRecomendación: mapear `probabilidad` y `estado` a `stage_id` en `lead_stages`.\n\n---\n\n### reuniones -> `CalendarEvent`\n\nold_field -> new_field\n- id -> id\n- cliente_id -> related_id (set `related_type`)\n- usuario_id -> created_by/assigned_to\n- evento_id -> related_type or event type\n- ultima_notificacion -> reminder_at / reminde"}, {"file": "docs\\mapping_old_to_new.md", "start": 4320, "end": 4920, "text": "io_id -> created_by/assigned_to\n- evento_id -> related_type or event type\n- ultima_notificacion -> reminder_at / reminded_at\n- titulo -> title\n- descripcion -> description\n- fecha -> start_at\n- hora_inicio -> start_at (combine fecha+hora_inicio)\n- hora_fin -> end_at\n- ubicacion -> location\n- estado -> --\n- archivado, archivado_por, archivado_en -> archived flags (map to `archived_at` and pivot fields)\n- recordatorio -> reminder_minutes\n- observaciones -> description/notes\n\n---\n\n### usuarios -> `User` (app/Models/User.php)\n\nold_field -> new_field\n- id -> id\n- nombre -> name\n- usuario -> -- (use"}, {"file": "docs\\mapping_old_to_new.md", "start": 4800, "end": 5400, "text": "-\n\n### usuarios -> `User` (app/Models/User.php)\n\nold_field -> new_field\n- id -> id\n- nombre -> name\n- usuario -> -- (username not present; can be stored in `email` if fits, or create `username` column)\n- password -> password (hashing required)\n- perfil -> -- (roles via spatie permissions)\n- foto -> -- (store path in user profile)\n- estado -> -- (activate/deactivate via `is_active` custom column)\n- ultimo_login -> last_login_at (if exists)\n- fecha -> created_at\n- sesion_token, sesion_expira, remember_token, remember_expires -> remember_token / personal tokens\n\nNota: passwords deben importarse s"}, {"file": "docs\\mapping_old_to_new.md", "start": 5280, "end": 5880, "text": "sesion_expira, remember_token, remember_expires -> remember_token / personal tokens\n\nNota: passwords deben importarse solo si están ya hasheados; de lo contrario exigir reset.\n\n---\n\n### tenants, tenant_db, admin_users, audit_log\n- Revisar si la app nueva usa multi-tenant. Si no, crear scripts personalizados para migrar tenants y conexiones.\n- `admin_users` -> si hay `users` con roles admin, mapear.\n- `audit_log` -> si existe tabla `audit_logs` en nueva app, mapear campos; de lo contrario, exportar como histórico.\n\n---\n\n### notificaciones_certificados -> `certificados` / `Certificado` (app/Mod"}, {"file": "docs\\mapping_old_to_new.md", "start": 5760, "end": 6360, "text": "lo contrario, exportar como histórico.\n\n---\n\n### notificaciones_certificados -> `certificados` / `Certificado` (app/Models/Certificado.php)\n\n- id -> id\n- certificado_id -> id (relacion)\n- tipo -> tipo\n- fecha_envio -> ultima_notificacion (o tabla de logs)\n- usuario_id -> updated_by / created_by\n\n---\n\n### whatsapp_plantillas, programados_whatsapp, programados_whatsapp_logs\n- No hay modelos directos; crear tablas nuevas o guardar plantillas en `settings`/`templates`.\n\n---\n\n## Próximos pasos sugeridos\n1. Revisar y validar este mapeo con el equipo para campos marcados `--`.\n2. Crear CSV templates"}, {"file": "docs\\mapping_old_to_new.md", "start": 6240, "end": 6840, "text": "Próximos pasos sugeridos\n1. Revisar y validar este mapeo con el equipo para campos marcados `--`.\n2. Crear CSV templates para `clientes`, `actividades`, `incidencias`, `oportunidades`, `reuniones`, `usuarios`, `contador`, `contadores_clientes`.\n3. Implementar un `php artisan` command por tabla que lea CSV y use los modelos para insertar con validación y logging.\n\n---\n\n## Avance 2026-01-05 — Import CSV Contadores (end-to-end)\n\nSe dejó implementado el flujo completo para importar contadores desde un CSV legado (tipo “Post Venta - Contadores”).\n\n### Backend\n- Ruta HTTP (protegida por permisos):"}, {"file": "docs\\mapping_old_to_new.md", "start": 6720, "end": 7320, "text": "ar contadores desde un CSV legado (tipo “Post Venta - Contadores”).\n\n### Backend\n- Ruta HTTP (protegida por permisos):\n\t- `POST /postventa/contadores/import` (middleware `permission:contadores.create`)\n\t- Implementación: `ContadorController::importCsv()`\n\t- Espera multipart con el archivo en el campo `csv`.\n\t- Soporta `dry` (boolean) para ejecutar como dry-run (`--dry-run`).\n- Controller:\n\t- Guarda el archivo en `storage/app/imports/` y llama al comando Artisan `import:contadores`.\n\t- Si el comando falla “duro” (archivo no existe/no se puede leer), responde 422 con el output.\n\n### Comando Arti"}, {"file": "docs\\mapping_old_to_new.md", "start": 7200, "end": 7800, "text": "ores`.\n\t- Si el comando falla “duro” (archivo no existe/no se puede leer), responde 422 con el output.\n\n### Comando Artisan\n- Comando: `php artisan import:contadores {file} {--dry-run}`\n- Ubicación: `routes/console.php`\n- Características:\n\t- Lectura CSV con `fgetcsv`.\n\t- Normaliza encabezados (minúsculas, sin acentos, soporta BOM UTF-8) para tolerar variaciones:\n\t\t- `N°/Nº/No/Nro/#` -> `nro`\n\t\t- `Comercio(s)` -> `comercio`\n\t\t- `Nombre Contador` -> `nom_contador`\n\t\t- `Nombre en Celular` -> `titular_tlf`\n\t\t- `Teléfono` -> `telefono`\n\t\t- `Link` -> `link`\n\t\t- `Usuario` -> `usuario`\n\t\t- `Contraseña"}, {"file": "docs\\mapping_old_to_new.md", "start": 7680, "end": 8280, "text": "n Celular` -> `titular_tlf`\n\t\t- `Teléfono` -> `telefono`\n\t\t- `Link` -> `link`\n\t\t- `Usuario` -> `usuario`\n\t\t- `Contraseña` -> `contrasena`\n\t\t- `Servidor` -> `servidor`\n\t- Limpieza básica:\n\t\t- Convierte valores tipo `NO TIENE`, `N/A` a `null`.\n\t\t- Si `usuario` parece email, se guarda en minúsculas.\n\t\t- Filas “vacías” (sin campos relevantes) se saltan.\n\t- Errores por fila:\n\t\t- Se loguean en `storage/logs/import_contadores.log`.\n\t\t- No rompen el proceso ni devuelven exit-code distinto de 0.\n\n### Frontend (Vue)\n- Componente: `resources/js/components/ContadoresTable.vue`\n- Se agregó un botón/selecto"}, {"file": "docs\\mapping_old_to_new.md", "start": 8160, "end": 8760, "text": "tinto de 0.\n\n### Frontend (Vue)\n- Componente: `resources/js/components/ContadoresTable.vue`\n- Se agregó un botón/selector “Importar CSV”:\n\t- Sube el archivo a `/postventa/contadores/import`.\n\t- Muestra estado simple (importando / output) y dispara refresh de la tabla al finalizar.\n\n### Cómo usar\n- Desde UI: Postventa → Contadores → “Importar CSV”.\n- Desde consola (opcional):\n\t- Dry-run: `php artisan import:contadores C:\\\\ruta\\\\archivo.csv --dry-run`\n\t- Real: `php artisan import:contadores C:\\\\ruta\\\\archivo.csv`\n\n### Pendiente / notas\n- Definir si se debe evitar duplicados (por `nro` + `usuario"}, {"file": "docs\\mapping_old_to_new.md", "start": 8640, "end": 8948, "text": "rt:contadores C:\\\\ruta\\\\archivo.csv`\n\n### Pendiente / notas\n- Definir si se debe evitar duplicados (por `nro` + `usuario` + `servidor`, etc.) o si se importará “tal cual”.\n- (Opcional) Agregar toggle de `dry-run` en UI, si se necesita.\n\n---\n\nArchivo generado automáticamente por el proceso de mapeo inicial."}, {"file": "docs\\permissions-workflow.md", "start": 0, "end": 600, "text": "# Permisos y flujo de creación de módulos (CRM ATLANTIS)\n\nEste documento resume la solución implementada para gestionar permisos y la creación de módulos de forma segura y reproducible.\n\nResumen rápido\n- `php artisan permissions:sync` — detecta permisos desde las rutas (middleware `permission:`) y crea en la BD los permisos encontrados; además genera permisos estándar `view/create/update/delete` por recurso y `menu.<recurso>` para control del sidebar. Limpia la caché de Spatie al finalizar.\n- `php artisan make:module {name} [--prefix=...]` — genera un controlador stub en `app/Http/Controllers`"}, {"file": "docs\\permissions-workflow.md", "start": 480, "end": 1080, "text": "e al finalizar.\n- `php artisan make:module {name} [--prefix=...]` — genera un controlador stub en `app/Http/Controllers`, un archivo de rutas en `routes/modules/{resource}.php` (protegido por permisos) y un seeder en `database/seeders` con permisos básicos del módulo.\n- Seeder `RolesAndPermissionsSeeder` — ahora invoca `permissions:sync` y asegura roles base (`admin`, `dev`, `employee`) y asigna permisos existentes a `admin` y `dev`.\n- Workflow CI: añadida la acción GitHub `.github/workflows/permissions-sync.yml` que ejecuta migraciones y `permissions:sync` en PRs/push a `main`.\n\nPor qué este"}, {"file": "docs\\permissions-workflow.md", "start": 960, "end": 1560, "text": "github/workflows/permissions-sync.yml` que ejecuta migraciones y `permissions:sync` en PRs/push a `main`.\n\nPor qué este enfoque\n- Automatiza la creación de permisos para evitar olvidos humanos al añadir módulos.\n- Mantiene reproducibilidad: los seeders y migrations permiten versionar cambios.\n- Añade un punto de control (revisión en PR / UI) antes de exponer menús o asignar permisos en producción.\n\nUso del comando `permissions:sync`\n- Ejecutar localmente después de añadir nuevas rutas o cambios de middleware:\n```bash\nphp artisan permissions:sync\n```\n- Qué hace: escanea todas las rutas registra"}, {"file": "docs\\permissions-workflow.md", "start": 1440, "end": 2040, "text": "vas rutas o cambios de middleware:\n```bash\nphp artisan permissions:sync\n```\n- Qué hace: escanea todas las rutas registradas, extrae las cadenas del middleware `permission:...`, crea esos permisos si faltan y añade permisos estándar y `menu.*` por recurso.\n\nUso del generador `make:module`\n- Ejemplo:\n```bash\nphp artisan make:module certificado --prefix=postventa/certificados\n```\n- Resultado:\n  - `app/Http/Controllers/CertificadoController.php` (stub)\n  - `routes/modules/certificados.php` (rutas protegidas por `certificados.view|create|update|delete`)\n  - `database/seeders/PermissionModuleCertifi"}, {"file": "docs\\permissions-workflow.md", "start": 1920, "end": 2520, "text": "cados.php` (rutas protegidas por `certificados.view|create|update|delete`)\n  - `database/seeders/PermissionModuleCertificadosSeeder.php` (asegura `certificados.*` y `menu.certificados`)\n- Pasos sugeridos tras generar: revisar `routes/modules/{resource}.php` y adaptar endpoints; ejecutar el seeder del módulo si quieres crear los permisos inmediatamente:\n```bash\nphp artisan db:seed --class=PermissionModuleCertificadosSeeder\n```\n\nIntegración en CI / deploy\n- Recomendación mínima: ejecutar `php artisan permissions:sync` antes de `php artisan migrate` durante el deploy.\n- Ejemplo: se añadió `.githu"}, {"file": "docs\\permissions-workflow.md", "start": 2400, "end": 3000, "text": ": ejecutar `php artisan permissions:sync` antes de `php artisan migrate` durante el deploy.\n- Ejemplo: se añadió `.github/workflows/permissions-sync.yml` que prepara DB SQLite, ejecuta `php artisan migrate` y `php artisan permissions:sync` en PRs/push a `main`.\n\nBuenas prácticas operacionales\n- Flujo de feature/PR: el desarrollador crea el módulo (o llama al generator), ejecuta `permissions:sync` local, añade el seeder (si aplica) y abre PR. Revisar permisos nuevos en la PR. CI vuelve a ejecutar `permissions:sync` y valida.\n- Versiona cambios sensibles en migrations/seeders con mensajes claros"}, {"file": "docs\\permissions-workflow.md", "start": 2880, "end": 3480, "text": "CI vuelve a ejecutar `permissions:sync` y valida.\n- Versiona cambios sensibles en migrations/seeders con mensajes claros para mantener histórico.\n- Evita ejecutar el seeder global en producción sin revisión, porque reasigna permisos a roles (`admin`/`dev`) según la política del seeder.\n\nConsideraciones y alternativas\n- Actualmente el `permissions:sync` crea permisos estándar para cualquier recurso detectado. Si prefieres más control, se puede cambiar para crear sólo permisos explícitos (los que aparezcan en middleware o en stubs del generador), dejando al seeder del módulo la responsabilidad d"}, {"file": "docs\\permissions-workflow.md", "start": 3360, "end": 3960, "text": "explícitos (los que aparezcan en middleware o en stubs del generador), dejando al seeder del módulo la responsabilidad de crear los permisos adicionales.\n- Añadir UI de revisión: una mejora práctica es exponer en un panel admin los permisos detectados pero no asignados, permitiendo aprobar antes de mostrar el menú en producción.\n\nArchivos clave\n- `app/Console/Commands/SyncPermissions.php` — comando de sincronización automático.\n- `app/Console/Commands/MakeModule.php` — generador `make:module`.\n- `database/seeders/RolesAndPermissionsSeeder.php` — seeder principal ahora usa `permissions:sync`.\n-"}, {"file": "docs\\permissions-workflow.md", "start": 3840, "end": 4440, "text": "dor `make:module`.\n- `database/seeders/RolesAndPermissionsSeeder.php` — seeder principal ahora usa `permissions:sync`.\n- `routes/modules/*` — rutas generadas para módulos.\n- `.github/workflows/permissions-sync.yml` — ejemplo de integración CI.\n\nProblemas comunes y soluciones\n- \"No veo el menú después de dar permisos\": asegúrate de que el permiso `menu.<resource>` está asignado al rol y que el frontend carga permisos actualizados (refrescar sesión o token). Ejecuta `php artisan permissions:sync` y limpias caché con `php artisan cache:clear`.\n- \"Se crean permisos que no quiero\": ejecuta `permiss"}, {"file": "docs\\permissions-workflow.md", "start": 4320, "end": 4751, "text": "n permissions:sync` y limpias caché con `php artisan cache:clear`.\n- \"Se crean permisos que no quiero\": ejecuta `permissions:sync` en modo controlado y considera eliminar los permisos no deseados manualmente o ajustar el generador para no crear permisos implícitos.\n\n¿Quieres que documente también la UI de revisión o genere una PR con estos cambios listos para merge? Responde con preferencia y lo hago.\n\n*** Fin de documento ***"}, {"file": "docs\\tablas_y_atributos.txt", "start": 0, "end": 600, "text": "actividades\n- id\n- cliente_id\n- usuario_id\n- tipo\n- asunto\n- fecha_hora\n- resultado\n\nclientes\n- id\n- nombre\n- empresa\n- tipo\n- documento\n- telefono\n- correo\n- motivo\n- ciudad\n- migracion\n- referencia\n- fecha_contacto\n- fecha_creacion\n- estado\n- post_precio\n- post_rubro\n- post_ano\n- post_mes\n- post_link\n- post_usuario\n- post_contrasena\n\nclientes_backup\n- id\n- nombre\n- empresa\n- tipo\n- documento\n- telefono\n- correo\n- motivo\n- ciudad\n- migracion\n- referencia\n- fecha_contacto\n- fecha_creacion\n- estado\n\ncontador\n- id\n- nro\n- comercio\n- nom_contador\n- titular_tlf\n- telefono\n- telefono_actu\n- link\n-"}, {"file": "docs\\tablas_y_atributos.txt", "start": 480, "end": 1080, "text": "echa_creacion\n- estado\n\ncontador\n- id\n- nro\n- comercio\n- nom_contador\n- titular_tlf\n- telefono\n- telefono_actu\n- link\n- usuario\n- contrasena\n- created_at\n\ncontadores_clientes\n- id\n- contador_id\n- cliente_id\n- fecha_asignacion\n\nevento\n- id\n- titulo\n- color\n\nincidencias\n- id\n- correlativo\n- nombre_incidencia\n- cliente_id\n- usuario_id\n- fecha\n- prioridad\n- observaciones\n- fecha_creacion\n- columna_backlog\n\noportunidades\n- id\n- cliente_id\n- usuario_id\n- titulo\n- descripcion\n- valor_estimado\n- probabilidad\n- estado\n- fecha_apertura\n- fecha_cierre_estimada\n- fecha_modificacion\n- alta_prioridad\n- acti"}, {"file": "docs\\tablas_y_atributos.txt", "start": 960, "end": 1560, "text": "r_estimado\n- probabilidad\n- estado\n- fecha_apertura\n- fecha_cierre_estimada\n- fecha_modificacion\n- alta_prioridad\n- actividad\n- fecha_actividad\n\nreuniones\n- id\n- cliente_id\n- usuario_id\n- evento_id\n- ultima_notificacion\n- titulo\n- descripcion\n- fecha\n- hora_inicio\n- hora_fin\n- ubicacion\n- estado\n- archivado\n- archivado_por\n- archivado_en\n- recordatorio\n- observaciones\n\nusuarios\n- id\n- nombre\n- usuario\n- password\n- perfil\n- foto\n- estado\n- ultimo_login\n- fecha\n- sesion_token\n- sesion_expira\n- remember_token\n- remember_expires\n\ntenants\n- id\n- ruc\n- subdomain\n- status\n- created_at\n- updated_at\n\nt"}, {"file": "docs\\tablas_y_atributos.txt", "start": 1440, "end": 2040, "text": "sesion_expira\n- remember_token\n- remember_expires\n\ntenants\n- id\n- ruc\n- subdomain\n- status\n- created_at\n- updated_at\n\ntenant_db\n- tenant_id\n- db_host\n- db_name\n- db_user\n- db_pass\n- db_charset\n- created_at\n- updated_at\n\nadmin_users\n- id\n- username\n- password_hash\n- is_active\n- last_login_at\n- created_at\n- updated_at\n\naudit_log\n- id\n- admin_user_id\n- tenant_id\n- action\n- details\n- ip\n- created_at\n\nnotificaciones_certificados\n- id\n- certificado_id\n- tipo\n- fecha_envio\n- usuario_id\n\nwhatsapp_plantillas\n- id\n- nombre\n- contenido\n- tipo\n- creado_por\n- creado_en\n\nprogramados_whatsapp\n- id\n- cliente"}, {"file": "docs\\tablas_y_atributos.txt", "start": 1920, "end": 2308, "text": "o_id\n\nwhatsapp_plantillas\n- id\n- nombre\n- contenido\n- tipo\n- creado_por\n- creado_en\n\nprogramados_whatsapp\n- id\n- cliente_id\n- telefono\n- plantilla_id\n- mensaje\n- datos_personalizacion\n- programado_para\n- estado\n- intentos\n- proveedor\n- proveedor_id\n- creado_en\n- creado_por\n- actualizado_en\n\nprogramados_whatsapp_logs\n- id\n- programado_id\n- respuesta_proveedor\n- codigo_error\n- creado_en"}]