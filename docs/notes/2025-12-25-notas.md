# CRM ATLANTIS — Notas de trabajo (2025-12-25)

> Actualización: el estado actual consolidado está en `docs/2025-12-26-notas.md`.

## Objetivo del día
- Dejar el proyecto corriendo en navegador con autenticación.
- Montar el dashboard en Vue (Blade como shell) con Tailwind v4 + Flowbite.
- Implementar el primer módulo real: **Usuarios** (CRUD + modales + buscador/paginación server-side).
- Mejoras de UX: animaciones de modales, footer sticky, modo oscuro/claro.

## Stack actual
- Backend: Laravel 12 + MySQL (XAMPP)
- Auth: Laravel Breeze (Blade)
- Frontend: Vue 3 + Vite 7
- UI: Tailwind CSS v4 + Flowbite

## Arquitectura (por qué “funciona” sin una API separada)
- Laravel sirve las vistas Blade como contenedor (wrapper) y los assets de Vite.
- Vue se monta dentro del contenedor (div `#app`) y navega por rutas tipo `/dashboard` y `/users`.
- Los datos se consumen vía endpoints JSON **en el mismo backend** (rutas internas protegidas por `auth`).

## Rutas
- `GET /` redirige a `login` o `dashboard` según sesión.
- `GET /dashboard` (auth) muestra el wrapper del dashboard.
- `GET /users` (auth) también muestra el mismo wrapper (Vue decide qué módulo renderizar por `window.location.pathname`).
- Endpoints JSON de usuarios (auth):
  - `GET /users/data` lista con paginación/búsqueda.
  - `POST /users` crea.
  - `PUT /users/{user}` actualiza.
  - `DELETE /users/{user}` elimina.

Archivos:
- routes/web.php
- app/Http/Controllers/UserController.php

## Base de datos
- Configurada para MySQL (XAMPP) con la base `crmatlantis`.
- Se corrieron migraciones.

### Seeder de usuario interno
- Existe `Database\Seeders\InternalUserSeeder` que crea/actualiza:
  - Email: `admin@crmatlantis.local`
  - Password: `Atlantis2025!`

Notas:
- Recomendada práctica: cambiar esta contraseña en producción.
- Actualización (2025-12-26): `DatabaseSeeder` ahora sí llama a `InternalUserSeeder` (junto con seeders de permisos y etapas de Leads). Ejecuta:
  - `php artisan migrate --seed`

Archivos:
- database/seeders/InternalUserSeeder.php
- database/seeders/DatabaseSeeder.php

## Frontend (Tailwind / Vite / Flowbite)
### Tailwind v4 unificado
- CSS entrypoint: `resources/css/app.css` usa `@import "tailwindcss";`.
- Para que el modo oscuro sea por clase (y no por `prefers-color-scheme`), se agregó:
  - `@custom-variant dark (&:where(.dark, .dark *));`

Archivo:
- resources/css/app.css

### Modo oscuro/claro (toggle en header)
- Helper de tema:
  - `resources/js/theme.js`
  - Persiste en `localStorage` (`crmatlantis-theme`).
  - Aplica el tema toggling de `document.documentElement.classList` (`html.dark`).
  - Emite evento `theme:changed`.
- Se inicializa temprano en:
  - `resources/js/app.js`
- Botón en header:
  - `resources/js/components/Header.vue`

## Dashboard en Vue
- Componente shell:
  - `resources/js/components/App.vue`
- Sidebar colapsable y navegación:
  - `resources/js/components/Sidebar.vue`
- Header con dropdown de usuario y toggle de tema:
  - `resources/js/components/Header.vue`
- Footer:
  - `resources/js/components/Footer.vue`

### Fix: footer “sticky” y sin padding flotante
- El layout se ajustó para que:
  - El contenido tenga padding.
  - El footer se pegue al fondo y ocupe el ancho completo del área (pegado al sidebar y al borde derecho).

Archivo:
- resources/js/components/App.vue

## Módulo Usuarios
### Backend
- `UserController@index` soporta server-side:
  - `search` (name/email)
  - `page`
  - `per_page` (10/25/50/100)
  - `sort` (id/name/email/created_at)
  - `dir` (asc/desc)
- Respuesta:
  - `data`: array de usuarios (id, name, email, created_at)
  - `meta`: paginación (current_page, last_page, per_page, total, from, to)

Archivo:
- app/Http/Controllers/UserController.php

### Frontend
- Tabla con:
  - Buscador (debounce ~300ms)
  - Selector “por página”
  - Paginación (Anterior/Siguiente + estado)
- CRUD:
  - Crear/Editar en modales.
  - Eliminar con confirm.
- Modales con animación:
  - Transición fade (overlay) + scale (card) con `<Transition>` de Vue.
  - Cierre por click fuera y `ESC`.

Archivo:
- resources/js/components/UsersTable.vue

## Comandos útiles
### Backend
- `composer install`
- `php artisan key:generate`
- `php artisan migrate`
- Seeder usuario interno:
  - `php artisan db:seed --class=Database\\Seeders\\InternalUserSeeder`
- Servidor:
  - `php artisan serve`

### Frontend
- `npm install`
- Dev:
  - `npm run dev`
- Build:
  - `npm run build`

## Para continuar mañana
- Añadir ordenamiento por columnas (server-side) desde la UI de tabla.
- Agregar filtros adicionales (ej. fecha de creación, estado/rol cuando exista).
- Empezar siguiente módulo (Clientes) replicando patrón: tabla + endpoints JSON + modales.
